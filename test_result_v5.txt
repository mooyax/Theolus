
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/mooya/develop/test[39m

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Building.ts loaded

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Terrain.ts top-level load

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Actor.ts loaded

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Goblin.ts loaded

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[Import Debug] Raid: function, Combat: function, Wander: function

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Game.ts top-level load

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Game] Init SphereGeometry
[Game] Minimal/Override Init Start
[Game] Minimal: Init Clock
[Game FORCE CONST 1] Creating mock terrain
[Game] Minimal: Init Managers
[Game] Minimal: Init GoblinManager
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.457269, 0.391824) -> Grid(73, 62) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.406024, 0.704833) -> Grid(64, 112) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.183615, 0.236017) -> Grid(29, 37) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)
[Game] Minimal: Init EnemyAI
[Game] Minimal: Done. Returning.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39mStarting persistence test...
[Entity 0] CONSTRUCTOR START: type=unit at 10,10
[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[DIAG] Actor Created ID: 0
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0
[Entity 1] CONSTRUCTOR START: type=unit at 20,20
[Entity 1] Calling registerEntity...
[Entity 1] registerEntity returned.
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[DIAG] Actor Created ID: 1
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:1 Role:knight Pos:20,20 Special:false
[UnitCore.js] Unit Created ID:1 Role:knight Pos:20,20
[UnitCore.js] Unit Construction Finished ID:1
Units: PlayerID=0 EnemyID=1
Farms: PlayerFaction=undefined EnemyFaction=undefined

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould only add food to player pool from player farms
[22m[39mDisposing detached game instance
[Game] Dispose called for Game Instance.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould only add food to player pool from player farms
[22m[39m[Game] Init SphereGeometry
[Game] Minimal/Override Init Start
[Game] Minimal: Init Clock
[Game FORCE CONST 2] Creating mock terrain
[Game] Minimal: Init Managers
[Game] Minimal: Init GoblinManager
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.557482, 0.331875) -> Grid(89, 53) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.906918, 0.396536) -> Grid(145, 63) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.093423, 0.215359) -> Grid(14, 34) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)
[Game] Minimal: Init EnemyAI
[Game] Minimal: Done. Returning.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould only add food to player pool from player farms
[22m[39mStarting resource test...
Initial resources: grain=0

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould allow workers and knights to target enemy human buildings
[22m[39mDisposing detached game instance
[Game] Dispose called for Game Instance.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould allow workers and knights to target enemy human buildings
[22m[39m[Game] Init SphereGeometry
[Game] Minimal/Override Init Start
[Game] Minimal: Init Clock
[Game FORCE CONST 3] Creating mock terrain
[Game] Minimal: Init Managers
[Game] Minimal: Init GoblinManager
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.380221, 0.616955) -> Grid(60, 98) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.164012, 0.677634) -> Grid(26, 108) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.598303, 0.168725) -> Grid(95, 26) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)
[Game] Minimal: Init EnemyAI
[Game] Minimal: Done. Returning.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould allow workers and knights to target enemy human buildings
[22m[39mStarting enemy building targeting test...
[Entity 2] CONSTRUCTOR START: type=unit at 10,10
[Entity 2] Calling registerEntity...
[Entity 2] registerEntity returned.
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[DIAG] Actor Created ID: 2
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:2
Worker Faction: player, Tower Faction: undefined

 [31mç¬¶ï½¯[39m src/tests/FactionPersistence.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 36[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should persist unit and building faction across save/load[39m[32m 20[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should only add food to player pool from player farms[39m[32m 9[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should allow workers and knights to target enemy human buildings[39m[32m 5[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[90m (3)[39m
[2m   Start at [22m 12:49:06
[2m   Duration [22m 1.37s[2m (transform 545ms, setup 87ms, import 611ms, tests 36ms, environment 448ms)[22m

