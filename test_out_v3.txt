
 RUN  v4.0.15 C:/Users/mooya/develop/test

stdout | src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should detect Worker within range and enter Combat
Goblin constructor: calling super...
[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 20,20
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Actor 0] CHANGE STATE: None -> Wander Request:null
[Entity 1] Calling registerEntity...
[Entity 1] registerEntity returned.
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 30,20
[UnitCore.js] Unit Created ID:0 Role:worker Pos:30,20 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:30,20
[Test Debug 1] Target: None, State: Wander
[GoblinState Debug] ID:100 Calling scanForTargets...
[Goblin 100] Found Unit Candidate: 200 Dist:?
[Test Debug 2] Target: 200, State: Combat

stdout | src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should prioritize Worker if Building is far, or attack Building if close
Goblin constructor: calling super...
[Entity 2] Calling registerEntity...
[Entity 2] registerEntity returned.
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 20,20
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Entity 3] Calling registerEntity...
[Entity 3] registerEntity returned.
[Entity 3] Calling updatePosition...
[Entity 3] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 30,20
[UnitCore.js] Unit Created ID:1 Role:worker Pos:30,20 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:30,20
[Goblin 101] Found Unit Candidate: 201 Dist:?
[Actor 101] smartMove: triggers pathfinding. Dist: 10.0 Time:0.7 Last:0.0 Throttle:1.10 Action:Fighting
[Actor 101] smartMove: triggers pathfinding. Dist: 10.0 Time:1.8 Last:0.7 Throttle:1.10 Action:Fighting
[Actor 101] smartMove: triggers pathfinding. Dist: 10.0 Time:2.9 Last:1.8 Throttle:1.10 Action:Fighting
[Actor 101] smartMove: triggers pathfinding. Dist: 10.0 Time:4.0 Last:2.9 Throttle:1.10 Action:Fighting
[Test Debug Priority] Target: 201, BTarget: None, State: Combat

stdout | src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should switch target to Worker if it encounters one while moving to a far Building
Goblin constructor: calling super...
[Entity 4] Calling registerEntity...
[Entity 4] registerEntity returned.
[Entity 4] Calling updatePosition...
[Entity 4] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 20,20
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Entity 5] Calling registerEntity...
[Entity 5] registerEntity returned.
[Entity 5] Calling updatePosition...
[Entity 5] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 25,20
[UnitCore.js] Unit Created ID:2 Role:worker Pos:25,20 Special:false
[UnitCore.js] Unit Created ID:2 Role:worker Pos:25,20
[Goblin 102] Found Unit Candidate: 202 Dist:?
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:2.0 Last:0.0 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:3.5 Last:2.0 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:5.0 Last:3.5 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:6.5 Last:5.0 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:8.0 Last:6.5 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:9.5 Last:8.0 Throttle:1.20 Action:Fighting
[Test Debug Switch] Target: 202, BTarget: None, State: Combat

 ✓ src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should detect Worker within range and enter Combat 12ms
 ✓ src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should prioritize Worker if Building is far, or attack Building if close 6ms
 ✓ src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should switch target to Worker if it encounters one while moving to a far Building 4ms
stdout | src/tests/CombatBalance.test.js
[Import Debug] Raid: function, Combat: function, Wander: function

stdout | src/tests/ComplexAI.test.js
[Import Debug] Raid: function, Combat: function, Wander: function

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Worker vs Normal Goblin (Expected: Goblin Win due to stats buff)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.335840, 0.831139) -> Grid(53, 132) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.155300, 0.447786) -> Grid(24, 71) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.075123, 0.331730) -> Grid(12, 53) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should drop job gracefully if target building is destroyed
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.828663, 0.673008) -> Grid(132, 107) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.398235, 0.392298) -> Grid(63, 62) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.549881, 0.620149) -> Grid(87, 99) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Normal Goblin vs House (Expected: Mutually Assured Destruction or House Defense)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.924086, 0.634218) -> Grid(147, 101) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.443047, 0.711681) -> Grid(70, 113) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.272447, 0.930721) -> Grid(43, 148) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs Normal Goblin (Expected: Knight Stomp)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.383515, 0.715969) -> Grid(61, 114) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.655254, 0.895378) -> Grid(104, 143) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.701311, 0.499939) -> Grid(112, 79) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs King Goblin (Expected: Close or King Advantage)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.342985, 0.567284) -> Grid(54, 90) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.684145, 0.071564) -> Grid(109, 11) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.548724, 0.860304) -> Grid(87, 137) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Wizard vs Hobgoblin (Expected: Wizard High DPS but Fragile)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.927056, 0.283206) -> Grid(148, 45) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.246243, 0.675199) -> Grid(39, 108) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.883844, 0.647645) -> Grid(141, 103) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Goblin King should crush Worker
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.131040, 0.975933) -> Grid(20, 156) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.317763, 0.436941) -> Grid(50, 69) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.060387, 0.040585) -> Grid(9, 6) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

 × src/tests/CombatBalance.test.js > Combat Balance Verification > Worker vs Normal Goblin (Expected: Goblin Win due to stats buff) 18ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/tests/CombatBalance.test.js > Combat Balance Verification > Normal Goblin vs House (Expected: Mutually Assured Destruction or House Defense) 3ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs Normal Goblin (Expected: Knight Stomp) 3ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs King Goblin (Expected: Close or King Advantage) 2ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/tests/CombatBalance.test.js > Combat Balance Verification > Wizard vs Hobgoblin (Expected: Wizard High DPS but Fragile) 2ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/tests/CombatBalance.test.js > Combat Balance Verification > Goblin King should crush Worker 3ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear
[Game] Dispose called for Game Instance.
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.222306, 0.006646) -> Grid(35, 1) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.763721, 0.314312) -> Grid(122, 50) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.463693, 0.970852) -> Grid(74, 155) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night
[Game] Dispose called for Game Instance.
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.909498, 0.889360) -> Grid(145, 142) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.922866, 0.116300) -> Grid(147, 18) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.969248, 0.219931) -> Grid(155, 35) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should abandon unreachable job (Abandonment Test)
[Game] Dispose called for Game Instance.
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.371967, 0.936209) -> Grid(59, 149) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.776204, 0.290770) -> Grid(124, 46) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.888266, 0.259968) -> Grid(142, 41) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

 × src/tests/ComplexAI.test.js > Complex AI Scenarios > should drop job gracefully if target building is destroyed 28ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear 21ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night 12ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/tests/ComplexAI.test.js > Complex AI Scenarios > should abandon unreachable job (Abandonment Test) 4ms
   → [vitest] No "Raycaster" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:


 Test Files  2 failed | 1 passed (3)
      Tests  10 failed | 3 passed (13)
   Start at  20:51:03
   Duration  1.42s (transform 1.17s, setup 190ms, import 1.37s, tests 126ms, environment 1.51s)

