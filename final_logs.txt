
 RUN  v4.0.15 C:/Users/mooya/develop/test

stdout | src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should wait for moveInterval before first move
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should initialize with age 20
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should increment age when updateLogic is called
[UnitCore.js] Unit Created ID:1 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should NOT freeze if started at time 0
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false

 ﾃ・src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should wait for moveInterval before first move 7ms
   竊・expected 3.9377007757795806 to be greater than or equal to 2000
 笨・src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should NOT freeze if started at time 0 2ms
stderr | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should increment age when updateLogic is called
Test Error: TypeError: window.game.findBestRequest is not a function
    at UnitWanderState.update (C:/Users/mooya/develop/test/src/ai/states/UnitStates.js:24:37)
    at Unit.updateLogic (C:/Users/mooya/develop/test/src/Unit.js:662:24)
    at C:/Users/mooya/develop/test/src/tests/UnitLifecycle.test.js:50:18
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///C:/Users/mooya/develop/test/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should die when age exceeds lifespan
[UnitCore.js] Unit Created ID:2 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should age slower for Knights and Wizards (0.1 rate)
[UnitCore.js] Unit Created ID:3 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should age slower for Knights and Wizards (0.1 rate)
[UnitCore.js] Unit Created ID:4 Role:knight Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:5 Role:wizard Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should have longer lifespan for Special units
[UnitCore.js] Unit Created ID:6 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should have longer lifespan for Special units
[UnitCore.js] Unit Created ID:7 Role:worker Pos:0,0 Special:false

 笨・src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should initialize with age 20 3ms
 ﾃ・src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should increment age when updateLogic is called 21ms
   竊・window.game.findBestRequest is not a function
 ﾃ・src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should die when age exceeds lifespan 2ms
   竊・window.game.findBestRequest is not a function
 ﾃ・src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should age slower for Knights and Wizards (0.1 rate) 4ms
   竊・expected 20.2 to be close to 21, received difference is 0.8000000000000007, but expected 0.05
 笨・src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should have longer lifespan for Special units 2ms

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ Failed Tests 4 竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ

 FAIL  src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should wait for moveInterval before first move
AssertionError: expected 3.9377007757795806 to be greater than or equal to 2000
 笶ｯ src/tests/UnitInit.test.js:41:26
     39|         // moveInterval is 2000-5000
     40|         const interval = unit.moveInterval;
     41|         expect(interval).toBeGreaterThanOrEqual(2000);
       |                          ^
     42| 
     43|         // Advance time by 1s (1000ms)

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[1/4]竡ｯ

 FAIL  src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should increment age when updateLogic is called
TypeError: window.game.findBestRequest is not a function
 笶ｯ UnitWanderState.update src/ai/states/UnitStates.js:24:37
     22|         if (window.game) {
     23|             // Check for jobs even while moving (e.g. wandering)
     24|             const req = window.game.findBestRequest(this.actor, true);窶ｦ
       |                                     ^
     25|             if (req) {
     26|                 if (window.game.claimRequest(this.actor, req)) {
 笶ｯ Unit.updateLogic src/Unit.js:662:24
 笶ｯ src/tests/UnitLifecycle.test.js:50:18

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[2/4]竡ｯ

 FAIL  src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should die when age exceeds lifespan
TypeError: window.game.findBestRequest is not a function
 笶ｯ UnitWanderState.update src/ai/states/UnitStates.js:24:37
     22|         if (window.game) {
     23|             // Check for jobs even while moving (e.g. wandering)
     24|             const req = window.game.findBestRequest(this.actor, true);窶ｦ
       |                                     ^
     25|             if (req) {
     26|                 if (window.game.claimRequest(this.actor, req)) {
 笶ｯ Unit.updateLogic src/Unit.js:662:24
 笶ｯ src/tests/UnitLifecycle.test.js:66:14

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[3/4]竡ｯ

 FAIL  src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should age slower for Knights and Wizards (0.1 rate)
AssertionError: expected 20.2 to be close to 21, received difference is 0.8000000000000007, but expected 0.05
 笶ｯ src/tests/UnitLifecycle.test.js:84:28
     82| 
     83|         // 10 seconds passed, but strict 0.1 rate means 1.0 age added.窶ｦ
     84|         expect(knight.age).toBeCloseTo(21.0, 1);
       |                            ^
     85|         expect(wizard.age).toBeCloseTo(21.0, 1);
     86|     });

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[4/4]竡ｯ


 Test Files  2 failed (2)
      Tests  4 failed | 3 passed (7)
   Start at  20:07:17
   Duration  908ms (transform 231ms, setup 71ms, import 324ms, tests 45ms, environment 920ms)

