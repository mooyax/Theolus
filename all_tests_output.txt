
 RUN  v4.0.15 C:/Users/mooya/develop/test

 笶ｯ src/tests/BuildingStart.test.js (2 tests | 1 failed) 19ms
     笨・should build house if population is sufficient (Initial State) 5ms
     ﾃ・should build house if population > 8 (with Base Cap 10) 11ms
 笶ｯ src/tests/Stabilization.test.js (4 tests | 1 failed) 27ms
     笨・should NOT overwrite Action: Moving with Idle during Wander state self-transition 7ms
     笨・should NOT build on slope (Strict Check) 2ms
     ﾃ・should build on flat ground 14ms
     笨・should NOT build infinite houses (Population Cap Logic) 2ms
 笶ｯ src/tests/UnitStress.test.js (2 tests | 1 failed) 479ms
     笨・should handle 100 units starting distant jobs simultaneously without dropping tasks 92ms
     ﾃ・should eventually reach target even with extreme congestion (low budget) 382ms
 笶ｯ src/tests/MultiJob.test.js (1 test | 1 failed) 855ms
     ﾃ・should NOT interrupt busy units when a new job is added 853ms
 笨・src/tests/NightLoadJob.test.js (3 tests) 951ms
     笨・should correctly resume manual job when loaded at night  337ms
     笨・should wake up unit if they were saved while sleeping but had a job assigned (manual)  307ms
     笨・should treat legacy requests (missing isManual) as manual for specific types  305ms
 笨・src/tests/BuildingDestruction.test.js (4 tests) 1519ms
     笨・should successfully remove a building from the list  699ms
     笨・should allow a goblin to destroy a building  310ms
 笨・src/tests/RefuseDistraction.test.js (2 tests) 1072ms
     笨・should prioritize MANUAL move marker over autonomous HOUSE BUILDING  597ms
     笨・should NOT Switch to a better Auto-Job if Manual Job is active  474ms
 笨・src/tests/HumanSpawningSurvival.test.js (1 test) 1852ms
     笨・should allow population growth (slowly) even with 0 food  1850ms
 笨・src/tests/SaveLoadRestoration.test.js (2 tests) 612ms
     笨・should restore unit ID and re-link to JobState correctly  318ms
 笨・src/tests/SaveLoadIntegration.test.js (3 tests) 940ms
     笨・should maintain game continuity across save/load  339ms
     笨・should ignore unreachable jobs after load (IgnoredTarget Persistence)  303ms
 笨・src/tests/GoblinMobilization.test.js (2 tests) 512ms
 笨・src/tests/GoblinHutFix.test.js (2 tests) 3221ms
     笨・should NOT trigger spawnCallback for goblin_hut even if overpopulated  1719ms
     笨・should trigger spawnCallback for house when overpopulated (Control)  1501ms
 笨・src/tests/SimpleRegion.test.js (2 tests) 515ms
 笨・src/tests/LoadUpdateLoop.test.js (1 test) 357ms
     笨・should maintain JobState after first update loop post-load  355ms
 笨・src/tests/MovingFlicker.test.js (4 tests) 496ms
 笨・src/tests/SpawnCost.test.js (2 tests) 608ms
     笨・should consume food when spawning from House  319ms
 笨・src/tests/GhostHouse.test.js (1 test) 370ms
     笨・should NOT accumulate ghost buildings (cleared during deserialize)  368ms
 笨・src/tests/RealTerrainRestoration.test.js (1 test) 316ms
     笨・should successfully restore Terrain regions and Unit pathfinding  313ms
 笨・src/tests/ForceBuild.test.js (2 tests) 4354ms
     笨・should clear existing buildings when placing a new one  2325ms
     笨・should clear buildings partially in the way  2027ms
 笨・src/tests/SafeSpawn.test.js (1 test) 339ms
     笨・should NOT destroy house when spawning unit resets population to 0  338ms
 笨・src/tests/GridSearchRegression.test.js (3 tests) 4982ms
     笨・should find Worker when searching for "unit" using Grid Search (Large Scale Simulation)  1900ms
     笨・should NOT find Sheep or Fish when searching for "unit"  1575ms
     笨・should NOT find Building when searching for unit  1504ms
 笨・src/tests/StuckDebug.test.js (1 test) 352ms
     笨・should log reason for blockage  350ms
 笨・src/tests/WorkerDistraction.test.js (4 tests) 269ms
 笨・src/tests/Regression_WorkerLogic.test.js (3 tests) 173ms
[Test] ReleaseRequest Calls: 1
[Test] Unit HP: 0. isDead: true. TargetReq: null
 笨・src/tests/CombatRequestHandoff.test.js (2 tests) 93ms
 笨・src/tests/GoblinEncounter.test.js (3 tests) 5465ms
     笨・Goblin should detect Worker within range and enter CombatState  2176ms
     笨・Goblin should prioritize Worker if Building is far, or attack Building if close  1673ms
     笨・Goblin should switch target to Worker if it encounters one while moving to a far Building  1613ms
 笨・src/tests/LoadJitabata.test.js (1 test) 175ms
 笨・src/tests/ComplexAI.test.js (4 tests) 100ms
 笨・src/tests/StressTest.test.js (2 tests) 110ms
 笨・src/tests/SpatialSearch.test.js (4 tests) 5978ms
     笨・should register and retrieve an entity  1817ms
     笨・should move entity correctly between cells  1492ms
     笨・should unregister entity  1486ms
     笨・should find nearest entity using spatial search  1177ms
 笨・src/tests/TerrainDetection.test.ts (4 tests) 6097ms
     笨・should detect target in same region  1928ms
     笨・should NOT detect target in different region (Cross Mountain)  1470ms
     笨・should rely on Grid search and respect regions  1456ms
     笨・should detect target in different region IF CLOSE (Melee Exemption)  1241ms
 笨・src/tests/ComplexInteraction.test.js (3 tests) 90ms
 笨・src/tests/CombatBalance.test.js (6 tests) 82ms
 笨・src/tests/WorkerReachability.test.js (2 tests) 82ms
 笨・src/tests/Hotspot.test.js (6 tests) 94ms
 笨・src/tests/ForceAssignment.test.js (2 tests) 64ms
 笨・src/tests/GroupCombat.test.js (9 tests) 62ms
 笨・src/tests/CounterBalance.test.js (3 tests) 52ms
 笨・src/tests/Movement.test.js (4 tests) 44ms
 笨・src/tests/JobReassignment.test.js (1 test) 37ms
 笨・src/tests/JobPathFailure.test.js (1 test) 37ms
 笨・src/tests/GoblinRaidThreshold.test.js (5 tests) 40ms
 笨・src/tests/StuckAndMarker.test.js (1 test) 45ms
 笨・src/tests/GoblinTypes.test.js (4 tests) 45ms
 笨・src/tests/GoblinRaidExpiry.test.js (2 tests) 37ms
 笨・src/tests/JitterInvestigation.test.js (2 tests) 37ms
 笨・src/tests/ManualAssignment.test.js (5 tests) 45ms
 笨・src/tests/StuckReassignment.test.js (1 test) 49ms
 笨・src/tests/ActionLabelStability.test.js (1 test) 35ms
 笨・src/tests/RequestLifecycle.test.js (5 tests) 40ms
 笨・src/tests/Animals.test.js (2 tests) 39ms
 笨・src/tests/UnitVisibility.test.js (2 tests) 35ms
 笨・src/tests/PerformanceMonitor.test.js (12 tests) 34ms
 笨・src/tests/Unit.test.js (8 tests) 46ms
 笨・src/tests/HelpShowroom.test.js (4 tests) 32ms
 笨・src/tests/JobIdempotency.test.js (1 test) 31ms
 笨・src/tests/Lighting.test.js (1 test) 27ms
 笨・src/tests/BuildingDefense.test.js (8 tests) 27ms
 笨・src/tests/InterruptResume.test.js (2 tests) 29ms
 笨・src/tests/StartupCrash.test.js (3 tests) 28ms
 笨・src/tests/FactionWar.test.js (1 test) 30ms
 笨・src/tests/GoblinActivity.test.js (1 test) 28ms
 笨・src/tests/GoblinSpawn.test.js (2 tests) 24ms
 笨・src/tests/TargetingPriority.test.js (4 tests) 25ms
 笨・src/tests/CombatRetaliation.test.js (2 tests) 27ms
 笨・src/tests/EncounterCombat.test.js (3 tests) 27ms
 笨・src/tests/ManualBuild.test.js (3 tests) 18ms
 笨・src/tests/NightManualWork.test.js (4 tests) 20ms
 笨・src/tests/CombatStability.test.js (5 tests) 23ms
 笨・src/tests/GoblinDestruction.test.js (3 tests) 20ms
 笨・src/tests/IdleRegression.test.js (4 tests) 20ms
 笨・src/tests/WorkerRequest.test.js (3 tests) 19ms
 笨・src/tests/UnitBehavior.test.js (8 tests) 21ms
 笨・src/tests/WorkerOscillationStale.test.js (1 test) 23ms
 笨・src/tests/MarkerEndToEnd.test.js (5 tests) 22ms
 笨・src/tests/GoblinAggression.test.js (1 test) 21ms
 笨・src/tests/ResourceGathering.test.js (4 tests) 21ms
 笨・src/tests/GoblinStuckness.test.js (3 tests) 23ms
 笨・src/tests/TerrainJobReach.test.js (3 tests) 22ms
 笨・src/tests/WorkerDiversity.test.js (3 tests) 20ms
 笨・src/tests/RubberBanding.test.js (2 tests) 20ms
 笨・src/tests/MigrationImprovement.test.js (4 tests) 19ms
 笨・src/tests/NightMovement.test.js (4 tests) 20ms
 笨・src/tests/UnitWrapping.test.js (4 tests) 19ms
 笨・src/tests/NightLogic.test.js (3 tests) 25ms
 笨・src/tests/VisualDebug.test.js (1 test) 29ms
 笨・src/tests/MovementExecution.test.js (3 tests) 18ms
 笨・src/tests/ManualPriority.test.js (3 tests) 18ms
 笨・src/tests/ManaSystem.test.js (5 tests) 19ms
 笨・src/tests/Terrain.test.js (9 tests) 11911ms
       笨・should correctly sum housing population excluding farms  1748ms
       笨・should handle massive population overflow loop correctly  1458ms
       笨・should grow crops using simDeltaTime (Not raw deltaTime)  1645ms
       笨・should preserve overflow when harvesting  1218ms
       笨・should scale farm yield based on moisture  1159ms
       笨・should reduce food consumption at night  1175ms
       笨・should consume normal amount during day  1142ms
         笨・should return different colors for seasons  1115ms
         笨・should keep rock color even if dry (desert override check)  1249ms
 笨・src/tests/SquadAi.test.js (5 tests) 22ms
 笨・src/tests/UnitMigration.test.js (3 tests) 16ms
 笨・src/tests/WorkerOscillation.test.js (2 tests) 20ms
 笨・src/tests/UnitLifecycle.test.js (5 tests) 18ms
 笨・src/tests/MigrationConflict.test.js (3 tests) 17ms
 笨・src/tests/BuildingAttackAuto.test.js (2 tests) 15ms
 笨・src/tests/MovementFix.test.js (4 tests) 13ms
 笨・src/tests/ManualJobRetry.test.js (5 tests) 16ms
 笨・src/tests/UnitAISearch.test.js (2 tests) 14ms
 笨・src/tests/MarkerDistraction.test.js (2 tests) 15ms
 笨・src/tests/BuildingDistraction.test.js (2 tests) 15ms
 笨・src/tests/DeathAnimation.test.js (2 tests) 12ms
 笨・src/tests/DeepCup.test.js (1 test) 14ms
 笨・src/tests/UnitSnatch.test.js (2 tests) 15ms
 笨・src/tests/Hysteresis.test.js (3 tests) 16ms
 笨・src/tests/KnightMobilization.test.js (3 tests) 17ms
 笨・src/tests/Flatness.test.js (5 tests) 16ms
 笨・src/tests/CombatFixes.test.js (1 test) 13ms
 笨・src/tests/AdvancedUnits.test.js (3 tests) 14ms
 笨・src/tests/DebugRegression.test.js (1 test) 12ms
 笨・src/tests/CombatVerification.test.js (1 test) 10ms
 笨・src/tests/UnitPerformance.test.js (3 tests) 13ms
 笨・src/tests/GoblinStats.test.js (2 tests) 11ms
 笨・src/tests/CavePersistence.test.js (2 tests) 9ms
 笨・src/tests/ReproductionJitabata.test.js (1 test) 10ms
 笨・src/tests/CaveDestruction.test.js (1 test) 8ms
 笨・src/tests/WanderBehavior.test.js (2 tests) 10ms
 笨・src/tests/MovementReset.test.js (2 tests) 9ms
 笨・src/tests/StuckAndFrozen.test.js (2 tests) 10ms
 笨・src/tests/JobApproachThreshold.test.js (2 tests) 8ms
 笨・src/tests/JobAssignment.test.js (3 tests) 8ms
 笨・src/tests/WrapDistance.test.js (2 tests) 9ms
 笨・src/tests/DebuggingIdle.test.js (1 test) 8ms
 笨・src/tests/ShorelineLoop.test.js (2 tests) 8ms
 笨・src/tests/UnitInit.test.js (1 test) 8ms
 笨・src/tests/SquadMemory.test.js (2 tests) 4ms
 笨・src/tests/GoblinFixes.test.js (2 tests) 4ms
 笨・src/tests/MinimalUnit.test.js (1 test) 4ms
 笨・src/tests/Minimal.test.js (1 test) 2ms
 笨・src/tests/WorkerDiversityFixed.test.js (2 tests) 3ms

<--- Last few GCs --->

[74804:000002950ADEA000]    23393 ms: Scavenge (interleaved) 4044.0 (4121.5) -> 4042.8 (4142.0) MB, pooled: 0 MB, 14.92 / 0.00 ms  (average mu = 0.471, current mu = 0.299) allocation failure; 
[74804:000002950ADEA000]    25426 ms: Mark-Compact 4056.9 (4142.7) -> 4051.9 (4154.0) MB, pooled: 0 MB, 2017.13 / 0.00 ms  (average mu = 0.234, current mu = 0.052) allocation failure; scavenge might not succeed


<--- JS stacktrace --->

FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory
----- Native stack trace -----

 1: 00007FF671121477 node::SetCppgcReference+18247
 2: 00007FF671081EAB v8::base::CPU::num_virtual_address_bits+102475
 3: 00007FF671C8A921 v8::Isolate::ReportExternalAllocationLimitReached+65
 4: 00007FF671C774A6 v8::Function::Experimental_IsNopFunction+3302
 5: 00007FF671AD3BF0 v8::internal::StrongRootAllocatorBase::StrongRootAllocatorBase+33904
 6: 00007FF671AD027A v8::internal::StrongRootAllocatorBase::StrongRootAllocatorBase+19194
 7: 00007FF671AE685C v8::Isolate::GetHeapProfiler+8012
 8: 00007FF671AE70DA v8::Isolate::GetHeapProfiler+10186
 9: 00007FF671AF21C1 v8::Isolate::GetHeapProfiler+55473
10: 00007FF671B05D3A v8::Isolate::GetHeapProfiler+136234
11: 00007FF671B06013 v8::Isolate::GetHeapProfiler+136963
12: 00007FF6718A3746 v8::MemorySpan<std::basic_string_view<char,std::char_traits<char> > const >::end+138374
13: 00007FF6718AB616 v8::MemorySpan<std::basic_string_view<char,std::char_traits<char> > const >::end+170838
14: 00007FF6717BBA03 v8::base::AddressSpaceReservation::AddressSpaceReservation+286099
15: 00007FF671D45DEE v8::PropertyDescriptor::writable+726222
16: 00007FF5F2039F51 

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ Failed Tests 4 竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ

 FAIL  src/tests/BuildingStart.test.js > Building Logic > should build house if population > 8 (with Base Cap 10)
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 笶ｯ src/tests/BuildingStart.test.js:56:23
     54| 
     55|         const built = unit.tryBuildStructure(100);
     56|         expect(built).toBe(true);
       |                       ^
     57|     });
     58| });

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[1/4]竡ｯ

 FAIL  src/tests/MultiJob.test.js > Multi-Job Juggling Verification > should NOT interrupt busy units when a new job is added
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 笶ｯ src/tests/MultiJob.test.js:94:29
     92|         u2.updateLogic(5.0, 0.1);
     93| 
     94|         expect(u1.isMoving).toBe(true);
       |                             ^
     95|         expect(u2.isMoving).toBe(true);
     96|         const u1_moveStart = u1.moveStartTime;

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[2/4]竡ｯ

 FAIL  src/tests/Stabilization.test.js > Stabilization Verified > should build on flat ground
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 笶ｯ src/tests/Stabilization.test.js:87:23
     85|         const built = unit.tryBuildStructure(100);
     86| 
     87|         expect(built).toBe(true);
       |                       ^
     88|         // Verify House added
     89|         const cell = terrain.grid[5][5];

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[3/4]竡ｯ

 FAIL  src/tests/UnitStress.test.js > Unit AI Stress Testing > should eventually reach target even with extreme congestion (low budget)
AssertionError: expected 3 to be 5 // Object.is equality

- Expected
+ Received

- 5
+ 3

 笶ｯ src/tests/UnitStress.test.js:225:33
    223| 
    224|         // Verify all units eventually moved/pathfound
    225|         expect(movedUnits.size).toBe(numUnits);
       |                                 ^
    226|         units.forEach(u => {
    227|             const isWorking = u.state instanceof JobState;

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[4/4]竡ｯ

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ Unhandled Errors 竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ Unhandled Error 竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ
Error: [vitest-pool]: Worker forks emitted error.
 笶ｯ EventEmitter.<anonymous> node_modules/vitest/dist/chunks/cli-api.C7sYjHmQ.js:8010:22
 笶ｯ EventEmitter.emit node:events:519:28
 笶ｯ ChildProcess.emitUnexpectedExit node_modules/vitest/dist/chunks/cli-api.C7sYjHmQ.js:7583:22
 笶ｯ ChildProcess.emit node:events:519:28
 笶ｯ Process.ChildProcess._handle.onexit node:internal/child_process:293:12

Caused by: Error: Worker exited unexpectedly
 笶ｯ ChildProcess.emitUnexpectedExit node_modules/vitest/dist/chunks/cli-api.C7sYjHmQ.js:7582:33
 笶ｯ ChildProcess.emit node:events:519:28
 笶ｯ Process.ChildProcess._handle.onexit node:internal/child_process:293:12

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ


 Test Files  4 failed | 126 passed (131)
      Tests  4 failed | 369 passed (374)
     Errors  1 error
   Start at  11:13:23
   Duration  42.11s (transform 8.58s, setup 18.59s, import 11.10s, tests 57.58s, environment 110.83s)

