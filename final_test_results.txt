
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/mooya/develop/test[39m

[90mstdout[2m | src/tests/InterruptResume.test.js[2m > [22m[2mUnit Interrupt and Resume[2m > [22m[2mshould return to previous movement target after finishing a job
[22m[39m[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[DIAG] Actor Created ID: 0
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0

[90mstdout[2m | src/tests/InterruptResume.test.js[2m > [22m[2mUnit Interrupt and Resume[2m > [22m[2mshould return to previous movement target after finishing a job
[22m[39m[Actor 1] SmartMove Depth:1 Node:0,0 My:0,0 d:0,0 
[Actor 1] Reached Node.Shifting.
[Actor 1] SmartMove Depth:2 Node:80,80 My:0,0 d:80,80 
[Unit 1] Moving onto Rock at 80,80 H:10 (Speed Penalty)
[Unit 1] canMoveTo(80,80) OK
[Unit 1] canMoveTo(80,80) checking grid...
[DIAG] executeMove Actor:1 calling startMove.Current isMoving:false 
[Entity 1] startMove -> isMoving:true. Target:80,80 StartTime:100.0000
[DIAG] executeMove Actor:1 finished startMove.New isMoving:true 

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Goblin if it is much closer than Building
[22m[39m[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[DIAG] Actor Created ID: 0
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0
[UnitCore.js] Unit Construction Finished ID:0

[90mstdout[2m | src/tests/InterruptResume.test.js[2m > [22m[2mUnit Interrupt and Resume[2m > [22m[2mshould return to previous movement target after finishing a job
[22m[39m[Actor 1] Path Invalidated: Target Changed.Old:80,80 New:30,30 

[90mstdout[2m | src/tests/InterruptResume.test.js[2m > [22m[2mUnit Interrupt and Resume[2m > [22m[2mshould return to previous movement target after finishing a job
[22m[39m[Actor 1] SmartMove Depth:1 Node:0,0 My:0,0 d:0,0 
[Actor 1] Reached Node.Shifting.
[Actor 1] SmartMove Depth:2 Node:30,30 My:0,0 d:30,30 
[Unit 1] Moving onto Rock at 30,30 H:10 (Speed Penalty)
[Unit 1] canMoveTo(30,30) OK
[Unit 1] canMoveTo(30,30) checking grid...
[DIAG] executeMove Actor:1 calling startMove.Current isMoving:true 
[Entity 1] startMove -> isMoving:true. Target:30,30 StartTime:0.0000
[DIAG] executeMove Actor:1 finished startMove.New isMoving:true 

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Goblin if it is much closer than Building
[22m[39m[Unit Debug 0] updateLogic. State: Wander
[Unit 0] State Change: Wander -> Combat

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Building if distances are very close (Siege Mode)
[22m[39m[Entity 1] Calling registerEntity...
[Entity 1] registerEntity returned.
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[DIAG] Actor Created ID: 1
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:1 Role:knight Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:1 Role:knight Pos:0,0
[UnitCore.js] Unit Construction Finished ID:1

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Building if distances are very close (Siege Mode)
[22m[39m[Entity 2] Calling registerEntity...
[Entity 2] registerEntity returned.
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[DIAG] Actor Created ID: 2
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:2 Role:knight Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:2 Role:knight Pos:0,0
[UnitCore.js] Unit Construction Finished ID:2

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Building if distances are very close (Siege Mode)
[22m[39m[Actor 2] SmartMove Depth:1 Node:7,0 My:0,0 d:7,0 
[Unit 2] Moving onto Rock at 7,0 H:10 (Speed Penalty)
[Unit 2] canMoveTo(7,0) OK
[Unit 2] canMoveTo(7,0) checking grid...
[DIAG] executeMove Actor:2 calling startMove.Current isMoving:false 
[Entity 2] startMove -> isMoving:true. Target:7,0 StartTime:1000.0000
[DIAG] executeMove Actor:2 finished startMove.New isMoving:true 

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould NOT auto-target distant Huts (Workers are passive)
[22m[39m[Entity 3] Calling registerEntity...
[Entity 3] registerEntity returned.
[Entity 3] Calling updatePosition...
[Entity 3] updatePosition returned.
[DIAG] Actor Created ID: 3
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:3 Role:knight Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:3 Role:knight Pos:0,0
[UnitCore.js] Unit Construction Finished ID:3

[90mstdout[2m | src/tests/InterruptResume.test.js[2m > [22m[2mUnit Interrupt and Resume[2m > [22m[2mshould resume MIGRATION after Combat interruption
[22m[39m[Entity 1] Calling registerEntity...
[Entity 1] registerEntity returned.
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[DIAG] Actor Created ID: 1
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:1

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould NOT auto-target distant Huts (Workers are passive)
[22m[39m[Entity 4] Calling registerEntity...
[Entity 4] registerEntity returned.
[Entity 4] Calling updatePosition...
[Entity 4] updatePosition returned.
[DIAG] Actor Created ID: 4
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:4 Role:worker Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:4 Role:worker Pos:0,0
[UnitCore.js] Unit Construction Finished ID:4

 [31mï¾ƒãƒ»[39m src/tests/InterruptResume.test.js[2m > [22mUnit Interrupt and Resume[2m > [22mshould return to previous movement target after finishing a job[32m 21[2mms[22m[39m
[31m   ç«Šãƒ»Cannot read properties of undefined (reading 'x')[39m
 [31mï¾ƒãƒ»[39m src/tests/InterruptResume.test.js[2m > [22mUnit Interrupt and Resume[2m > [22mshould resume MIGRATION after Combat interruption[32m 6[2mms[22m[39m
[31m   ç«Šãƒ»expected 'Moving' to be 'Migrating' // Object.is equality[39m
[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould auto-target CLOSE Huts for self-defense (Workers)
[22m[39m[Entity 5] Calling registerEntity...
[Entity 5] registerEntity returned.
[Entity 5] Calling updatePosition...
[Entity 5] updatePosition returned.
[DIAG] Actor Created ID: 5
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:5 Role:knight Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:5 Role:knight Pos:0,0
[UnitCore.js] Unit Construction Finished ID:5

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould auto-target CLOSE Huts for self-defense (Workers)
[22m[39m[Entity 6] Calling registerEntity...
[Entity 6] registerEntity returned.
[Entity 6] Calling updatePosition...
[Entity 6] updatePosition returned.
[DIAG] Actor Created ID: 6
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:6 Role:worker Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:6 Role:worker Pos:0,0
[UnitCore.js] Unit Construction Finished ID:6

 [32mç¬¨ãƒ»[39m src/tests/TargetingPriority.test.js[2m > [22mUnit Targeting Priority[2m > [22mshould prioritize Goblin if it is much closer than Building[32m 5[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/TargetingPriority.test.js[2m > [22mUnit Targeting Priority[2m > [22mshould prioritize Building if distances are very close (Siege Mode)[32m 4[2mms[22m[39m
 [31mï¾ƒãƒ»[39m src/tests/TargetingPriority.test.js[2m > [22mUnit Targeting Priority[2m > [22mshould NOT auto-target distant Huts (Workers are passive)[32m 9[2mms[22m[39m
[31m   ç«Šãƒ»expected { userData: { çª¶ï½¦(4) }, gridX: 10, çª¶ï½¦(2) } to be falsy[39m
 [32mç¬¨ãƒ»[39m src/tests/TargetingPriority.test.js[2m > [22mUnit Targeting Priority[2m > [22mshould auto-target CLOSE Huts for self-defense (Workers)[32m 1[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinFixes.test.js
[22m[39m[Import Debug] Raid: function, Combat: function, Wander: function

[90mstdout[2m | src/tests/JobPathFailure.test.js
[22m[39m[Import Debug] Raid: function, Combat: function, Wander: function

[90mstdout[2m | src/tests/GoblinFixes.test.js[2m > [22m[2mGoblin Spawning Logic[2m > [22m[2mshould update building population
[22m[39m[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.

[90mstdout[2m | src/tests/GoblinFixes.test.js[2m > [22m[2mGoblin Spawning Logic[2m > [22m[2mshould synchronize clipping planes with controls.target when available
[22m[39m[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.855337, 0.846996) -> Grid(205, 203) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.355167, 0.715083) -> Grid(85, 171) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.603718, 0.843312) -> Grid(144, 202) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)
[Camera] Controls enabled: undefined, Pos: 100.0,100.0,100.0

 [32mç¬¨ãƒ»[39m src/tests/GoblinFixes.test.js[2m > [22mGoblin Spawning Logic[2m > [22mshould update building population[32m 2[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/GoblinFixes.test.js[2m > [22mGoblin Spawning Logic[2m > [22mshould synchronize clipping planes with controls.target when available[32m 6[2mms[22m[39m
[90mstdout[2m | src/tests/JobPathFailure.test.js[2m > [22m[2mJob Pathfinding Failure Handling[2m > [22m[2mshould abandon job if smartMove fails repeatedly
[22m[39m[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[DIAG] Actor Created ID: 0
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0
[UnitCore.js] Unit Construction Finished ID:0
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.670216, 0.667042) -> Grid(67, 66) rngState=undefined
GoblinManager: Cave registered at 67,66 
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.268789, 0.843096) -> Grid(26, 84) rngState=undefined
GoblinManager: Cave registered at 26,84 
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.914901, 0.225103) -> Grid(91, 22) rngState=undefined
GoblinManager: Cave registered at 91,22 
GoblinManager: Cave registered at 76,19 
GoblinManager: Cave registered at 59,30 
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 5/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5)
GoblinManager: Force spawning Debug Goblin
[Game] Generating Preview Terrain...
[Game] Preview Ready.

[90mstdout[2m | src/tests/JobPathFailure.test.js[2m > [22m[2mJob Pathfinding Failure Handling[2m > [22m[2mshould abandon job if smartMove fails repeatedly
[22m[39m[Test Debug] unit.canMoveTo is: [Function: Mock] {
  _isMockFunction: [33mtrue[39m,
  getMockImplementation: [36m[Function (anonymous)][39m,
  mock: {
    calls: [],
    contexts: [],
    instances: [],
    invocationCallOrder: [],
    settledResults: [],
    results: [],
    lastCall: [36m[Getter][39m
  },
  mockImplementation: [36m[Function: mockImplementation][39m,
  mockImplementationOnce: [36m[Function: mockImplementationOnce][39m,
  withImplementation: [36m[Function: withImplementation][39m,
  mockReturnThis: [36m[Function: mockReturnThis][39m,
  mockReturnValue: [36m[Function: mockReturnValue][39m,
  mockReturnValueOnce: [36m[Function: mockReturnValueOnce][39m,
  mockResolvedValue: [36m[Function: mockResolvedValue][39m,
  mockResolvedValueOnce: [36m[Function: mockResolvedValueOnce][39m,
  mockRejectedValue: [36m[Function: mockRejectedValue][39m,
  mockRejectedValueOnce: [36m[Function: mockRejectedValueOnce][39m,
  mockClear: [36m[Function: mockClear][39m,
  mockReset: [36m[Function: mockReset][39m,
  mockRestore: [36m[Function: mockRestore][39m,
  mockName: [36m[Function: mockName][39m,
  getMockName: [36m[Function: getMockName][39m,
  [[32mSymbol(nodejs.dispose)[39m]: [36m[Function (anonymous)][39m
}
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[Unit Debug 1] updateLogic. State: Job
[JobState] Unit Stuck for 5s. Abandoning Job. DistSq: 400.0
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
[Unit Debug 1] updateLogic. State: Wander
Success: Job released after repeated failures.

 [32mç¬¨ãƒ»[39m src/tests/JobPathFailure.test.js[2m > [22mJob Pathfinding Failure Handling[2m > [22mshould abandon job if smartMove fails repeatedly[32m 19[2mms[22m[39m

[2m Test Files [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m2 passed[39m[22m[90m (4)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (9)[39m
[2m   Start at [22m 00:07:08
[2m   Duration [22m 1.20s[2m (transform 1.07s, setup 281ms, import 1.48s, tests 79ms, environment 1.88s)[22m

