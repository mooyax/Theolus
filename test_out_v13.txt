
 RUN  v4.0.15 C:/Users/mooya/develop/test

stdout | src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should immediately switch to Job and target the job upon assignment
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10

stdout | src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should immediately switch to Job and target the job upon assignment
[Unit 0] State Change: Wander -> Wander
[Test] Assigning request...
[Unit 0] State Change: Wander -> Job
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:false Path:0
[Actor 0] smartMove: triggers pathfinding. Dist: 10.0 Time:0.0 Last:0.0 Throttle:1.00 Action:Approaching Job
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:false Path:2
[Actor 0] SmartMove Depth:1 Node:10,10 My:10,10 d:0,0
[Actor 0] Reached Node. Shifting.
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:false Path:1
[Actor 0] SmartMove Depth:2 Node:20,10 My:10,10 d:10,0
[Entity 0] startMove -> isMoving:true. Target:20,10 StartTime:0.0000
[Test] Update Frame 1...
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:true Path:1
[Actor 0] SmartMove Depth:0 Node:20,10 My:10,10 d:10,0
[Test] Unit Moving? true Target: 20,10

stdout | src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should NOT be distracted by WanderState updates during Job
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10

stdout | src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should NOT be distracted by WanderState updates during Job
[Unit 0] State Change: Wander -> Job
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:false Path:0
[Actor 0] smartMove: triggers pathfinding. Dist: 10.0 Time:0.0 Last:0.0 Throttle:1.00 Action:Approaching Job
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:false Path:2
[Actor 0] SmartMove Depth:1 Node:10,10 My:10,10 d:0,0
[Actor 0] Reached Node. Shifting.
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:false Path:1
[Actor 0] SmartMove Depth:2 Node:20,10 My:10,10 d:10,0
[Entity 0] startMove -> isMoving:true. Target:20,10 StartTime:0.0000
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:true Path:1
[Actor 0] SmartMove Depth:0 Node:20,10 My:10,10 d:10,0
[Actor 0] smartMove to 20,10 (H:1). Reachable:true Dist:10.00 Moving:true Path:1
[Actor 0] SmartMove Depth:0 Node:20,10 My:10,10 d:10,0

stdout | src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should not freeze due to throttle at low game time
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10

stdout | src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should not freeze due to throttle at low game time
[Unit 0] State Change: Wander -> Wander
[Unit 0] State Change: Wander -> Job
[Actor 0] smartMove to 50,50 (H:1). Reachable:true Dist:56.57 Moving:false Path:0
[Actor 0] smartMove: triggers pathfinding. Dist: 56.6 Time:0.0 Last:0.0 Throttle:1.00 Action:Approaching Job
[Actor 0] smartMove to 50,50 (H:1). Reachable:true Dist:56.57 Moving:false Path:2
[Actor 0] SmartMove Depth:1 Node:10,10 My:10,10 d:0,0
[Actor 0] Reached Node. Shifting.
[Actor 0] smartMove to 50,50 (H:1). Reachable:true Dist:56.57 Moving:false Path:1
[Actor 0] SmartMove Depth:2 Node:50,50 My:10,10 d:40,40
[Entity 0] startMove -> isMoving:true. Target:50,50 StartTime:0.0000

stdout | src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should NOT build a house immediately if pathfinding fails temporarily
[Entity 3] Calling updatePosition...
[Entity 3] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:3 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:3 Role:worker Pos:10,10

stdout | src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should NOT build a house immediately if pathfinding fails temporarily
[Unit 0] State Change: Wander -> Job

stdout | src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should detect Worker within range and enter Combat
Goblin constructor: calling super...
[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 20,20
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Actor 0] CHANGE STATE: None -> Wander Request:null
[Entity 1] Calling registerEntity...
[Entity 1] registerEntity returned.
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 30,20
[UnitCore.js] Unit Created ID:0 Role:worker Pos:30,20 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:30,20
[Test Debug 1] Target: None, State: Wander
[GoblinState Debug] ID:100 Calling scanForTargets...
[Goblin 100] Found Unit Candidate: 200 Dist:?
[Test Debug 2] Target: 200, State: Combat

stdout | src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should prioritize Worker if Building is far, or attack Building if close
Goblin constructor: calling super...
[Entity 2] Calling registerEntity...
[Entity 2] registerEntity returned.
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 20,20
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Entity 3] Calling registerEntity...
[Entity 3] registerEntity returned.
[Entity 3] Calling updatePosition...
[Entity 3] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 30,20
[UnitCore.js] Unit Created ID:1 Role:worker Pos:30,20 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:30,20
[Goblin 101] Found Unit Candidate: 201 Dist:?
[Actor 101] smartMove: triggers pathfinding. Dist: 10.0 Time:0.7 Last:0.0 Throttle:1.10 Action:Fighting
[Actor 101] smartMove: triggers pathfinding. Dist: 10.0 Time:1.8 Last:0.7 Throttle:1.10 Action:Fighting
[Actor 101] smartMove: triggers pathfinding. Dist: 10.0 Time:2.9 Last:1.8 Throttle:1.10 Action:Fighting
[Actor 101] smartMove: triggers pathfinding. Dist: 10.0 Time:4.0 Last:2.9 Throttle:1.10 Action:Fighting
[Test Debug Priority] Target: 201, BTarget: None, State: Combat

stdout | src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should switch target to Worker if it encounters one while moving to a far Building
Goblin constructor: calling super...
[Entity 4] Calling registerEntity...
[Entity 4] registerEntity returned.
[Entity 4] Calling updatePosition...
[Entity 4] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 20,20
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Entity 5] Calling registerEntity...
[Entity 5] registerEntity returned.
[Entity 5] Calling updatePosition...
[Entity 5] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 25,20
[UnitCore.js] Unit Created ID:2 Role:worker Pos:25,20 Special:false
[UnitCore.js] Unit Created ID:2 Role:worker Pos:25,20
[Goblin 102] Found Unit Candidate: 202 Dist:?
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:2.0 Last:0.0 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:3.5 Last:2.0 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:5.0 Last:3.5 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:6.5 Last:5.0 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:8.0 Last:6.5 Throttle:1.20 Action:Fighting
[Actor 102] smartMove: triggers pathfinding. Dist: 5.0 Time:9.5 Last:8.0 Throttle:1.20 Action:Fighting
[Test Debug Switch] Target: 202, BTarget: None, State: Combat

 ✓ src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should detect Worker within range and enter Combat 16ms
 ✓ src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should prioritize Worker if Building is far, or attack Building if close 9ms
 ✓ src/tests/GoblinEncounter.test.js > Goblin Encounter Logic > Goblin should switch target to Worker if it encounters one while moving to a far Building 5ms
stdout | src/tests/CombatBalance.test.js
[Import Debug] Raid: function, Combat: function, Wander: function

stdout | src/tests/ComplexAI.test.js
[Import Debug] Raid: function, Combat: function, Wander: function

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Worker vs Normal Goblin (Expected: Goblin Win due to stats buff)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.340630, 0.869749) -> Grid(54, 139) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.609300, 0.380101) -> Grid(97, 60) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.626679, 0.971655) -> Grid(100, 155) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.127714, 0.381097) -> Grid(20, 60) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.334292, 0.194621) -> Grid(53, 31) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.022884, 0.527559) -> Grid(3, 84) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should drop job gracefully if target building is destroyed
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.187434, 0.637023) -> Grid(29, 101) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.634624, 0.565929) -> Grid(101, 90) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.191415, 0.156450) -> Grid(30, 25) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should drop job gracefully if target building is destroyed
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[Game] Request Added: cultivate at (20,20) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job
[Actor 0] smartMove to 20,20 (H:5). Reachable:true Dist:14.14 Moving:false Path:0
[Actor 0] smartMove: triggers pathfinding. Dist: 14.1 Time:0.0 Last:0.0 Throttle:1.00 Action:Approaching Job
[ComplexAI Debug 1] State: Job
[UnitState Job] Target b_1 destroyed. Exiting Job.
[Unit 0] State Change: Job -> Wander
[Actor 0] smartMove to 20,20 (H:5). Reachable:true Dist:14.14 Moving:false Path:1
[Actor 0] SmartMove Depth:1 Node:20,20 My:10,10 d:10,10
[Entity 0] startMove -> isMoving:true. Target:20,20 StartTime:0.0000

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Worker vs Normal Goblin (Expected: Goblin Win due to stats buff)
[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
Goblin constructor: calling super...
[Entity 1] Calling registerEntity...
[Entity 1] registerEntity returned.
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 10,10
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Actor 0] CHANGE STATE: None -> Wander Request:null
[Unit 0] State Change: Wander -> Combat
[Unit Debug] ATTACKING Goblin 0
[Actor 0] CHANGE STATE: Wander -> Combat Request:null
Goblin hit Unit! Dmg: 15 UnitHP: 39 
[Unit Debug] ATTACKING Goblin 0
Goblin hit Unit! Dmg: 15 UnitHP: 24.03360000000022 
[Unit Debug] ATTACKING Goblin 0
Goblin hit Unit! Dmg: 15 UnitHP: 9.06720000000044 
[Unit Debug] ATTACKING Goblin 0
[Unit 0] Death Counter! Hitting 0
Goblin(normal) died.ID:0 
Unit 0 (worker) DIED. R.I.P.
Goblin hit Unit! Dmg: 15 UnitHP: 0 
[Worker vs Normal]
 Start: Unit(worker HP:54/54 Dmg:12) vs Goblin(normal HP:50/50 Dmg:15)
End: Winner=Goblin Frames=191
Final: Unit HP:0.0 Goblin HP:0.0

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Worker vs Normal Goblin (Expected: Goblin Win due to stats buff)
[Game] Dispose called for Game Instance.

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Normal Goblin vs House (Expected: Mutually Assured Destruction or House Defense)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.390774, 0.071893) -> Grid(62, 11) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.372960, 0.299829) -> Grid(59, 47) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.925205, 0.121190) -> Grid(148, 19) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.506990, 0.192905) -> Grid(81, 30) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.471524, 0.330612) -> Grid(75, 52) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.363428, 0.827113) -> Grid(58, 132) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Normal Goblin vs House (Expected: Mutually Assured Destruction or House Defense)
Goblin constructor: calling super...
[Entity 2] Calling registerEntity...
[Entity 2] registerEntity returned.
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 10,10
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
Check updateCombatLogic: function
Goblin Raid: House population reduced.Rem: 9 
Goblin Raid: House population reduced.Rem: 8 
Goblin(normal) died.ID:1 
[Goblin vs House]
 Start: Goblin vs House (Pop:10)
End: Goblin Dead=true House Pop=8 Frames=64

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Normal Goblin vs House (Expected: Mutually Assured Destruction or House Defense)
[Game] Dispose called for Game Instance.

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear
[Game] Dispose called for Game Instance.
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.828427, 0.722486) -> Grid(132, 115) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.683931, 0.453314) -> Grid(109, 72) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.040401, 0.856198) -> Grid(6, 136) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[Game] Request Added: raise at (50,50) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job
[Actor 0] smartMove to 50,50 (H:5). Reachable:true Dist:56.57 Moving:false Path:0
[Actor 0] smartMove: triggers pathfinding. Dist: 56.6 Time:0.0 Last:0.0 Throttle:1.00 Action:Approaching Job
[Game] Request Added: raise at (11,11) ID:req_1
[Actor 0] smartMove to 50,50 (H:5). Reachable:true Dist:56.57 Moving:false Path:1
[Actor 0] SmartMove Depth:1 Node:50,50 My:10,10 d:40,40
[Entity 0] startMove -> isMoving:true. Target:50,50 StartTime:0.0000

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs Normal Goblin (Expected: Knight Stomp)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.782089, 0.874107) -> Grid(125, 139) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.746653, 0.707456) -> Grid(119, 113) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.426992, 0.473855) -> Grid(68, 75) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.165209, 0.793544) -> Grid(26, 126) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.374978, 0.157614) -> Grid(59, 25) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.504609, 0.103698) -> Grid(80, 16) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs Normal Goblin (Expected: Knight Stomp)
[Entity 3] Calling registerEntity...
[Entity 3] registerEntity returned.
[Entity 3] Calling updatePosition...
[Entity 3] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:1 Role:knight Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:knight Pos:10,10
Goblin constructor: calling super...
[Entity 4] Calling registerEntity...
[Entity 4] registerEntity returned.
[Entity 4] Calling updatePosition...
[Entity 4] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 10,10
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Unit Debug] ATTACKING Goblin 2
[Goblin 2] Death Counter! Hitting 1
Goblin(normal) died.ID:2 
[Game] New Battle Hotspot at 10,10 (Region:[object Object])
[Knight vs Normal]
 Start: Unit(knight HP:1005/1005 Dmg:300) vs Goblin(normal HP:50/50 Dmg:15)
End: Winner=Unit Frames=2
Final: Unit HP:997.5 Goblin HP:0.0

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs Normal Goblin (Expected: Knight Stomp)
[Game] Dispose called for Game Instance.

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear
[Actor 0] SmartMove Depth:0 Node:50,50 My:10,10 d:40,40

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs King Goblin (Expected: Close or King Advantage)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.186910, 0.099332) -> Grid(29, 15) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.617969, 0.388261) -> Grid(98, 62) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.908740, 0.343029) -> Grid(145, 54) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.780680, 0.385279) -> Grid(124, 61) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.560151, 0.521744) -> Grid(89, 83) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.685575, 0.900258) -> Grid(109, 144) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs King Goblin (Expected: Close or King Advantage)
[Entity 5] Calling registerEntity...
[Entity 5] registerEntity returned.
[Entity 5] Calling updatePosition...
[Entity 5] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:2 Role:knight Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:2 Role:knight Pos:10,10
Goblin constructor: calling super...
[Entity 6] Calling registerEntity...
[Entity 6] registerEntity returned.
[Entity 6] Calling updatePosition...
[Entity 6] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 10,10
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Unit Debug] ATTACKING Goblin 3
[Game] New Battle Hotspot at 10,10 (Region:[object Object])
Goblin hit Unit! Dmg: 80 UnitHP: 924 
[Unit Debug] ATTACKING Goblin 3
Goblin hit Unit! Dmg: 80 UnitHP: 844.0400000000013 
[Unit Debug] ATTACKING Goblin 3
Goblin hit Unit! Dmg: 80 UnitHP: 764.0800000000027 
[Unit Debug] ATTACKING Goblin 3
[Unit Debug] ATTACKING Goblin 3
Goblin hit Unit! Dmg: 80 UnitHP: 684.120000000004 
[Unit Debug] ATTACKING Goblin 3
[Goblin 3] Death Counter! Hitting 2
Goblin(king) died.ID:3 
King Defeated! +500 Mana
[Knight vs King]
 Start: Unit(knight HP:1004/1004 Dmg:300) vs Goblin(king HP:1649/1649 Dmg:80)
End: Winner=Unit Frames=317
Final: Unit HP:644.2 Goblin HP:0.0

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs King Goblin (Expected: Close or King Advantage)
[Game] Dispose called for Game Instance.

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night
[Game] Dispose called for Game Instance.
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.485217, 0.081969) -> Grid(77, 13) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.015392, 0.723421) -> Grid(2, 115) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.508543, 0.049371) -> Grid(81, 7) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[Game] Request Added: raise at (50,50) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job
[Actor 0] smartMove to 50,50 (H:5). Reachable:true Dist:56.57 Moving:false Path:0
[Actor 0] smartMove: triggers pathfinding. Dist: 56.6 Time:0.0 Last:0.0 Throttle:1.00 Action:Approaching Job

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Wizard vs Hobgoblin (Expected: Wizard High DPS but Fragile)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.920193, 0.246353) -> Grid(147, 39) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.947275, 0.438692) -> Grid(151, 70) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.934284, 0.061193) -> Grid(149, 9) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.842786, 0.167104) -> Grid(134, 26) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.176221, 0.401980) -> Grid(28, 64) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.341547, 0.747588) -> Grid(54, 119) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night
[Actor 0] smartMove to 50,50 (H:5). Reachable:true Dist:56.57 Moving:false Path:1
[Actor 0] SmartMove Depth:1 Node:50,50 My:10,10 d:40,40
[Entity 0] startMove -> isMoving:true. Target:50,50 StartTime:0.0000

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Wizard vs Hobgoblin (Expected: Wizard High DPS but Fragile)
[Entity 7] Calling registerEntity...
[Entity 7] registerEntity returned.
[Entity 7] Calling updatePosition...
[Entity 7] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:3 Role:wizard Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:3 Role:wizard Pos:10,10
Goblin constructor: calling super...
[Entity 8] Calling registerEntity...
[Entity 8] registerEntity returned.
[Entity 8] Calling updatePosition...
[Entity 8] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 10,10
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
[Unit Debug] ATTACKING Goblin 4
[Goblin 4] Death Counter! Hitting 3
Goblin(hobgoblin) died.ID:4 
[Game] New Battle Hotspot at 10,10 (Region:[object Object])
[Wizard vs Hobgoblin]
 Start: Unit(wizard HP:157/157 Dmg:240) vs Goblin(hobgoblin HP:150/150 Dmg:30)
End: Winner=Unit Frames=2
Final: Unit HP:142.0 Goblin HP:0.0

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Wizard vs Hobgoblin (Expected: Wizard High DPS but Fragile)
[Game] Dispose called for Game Instance.

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Goblin King should crush Worker
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.280745, 0.053133) -> Grid(44, 8) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.456865, 0.599237) -> Grid(73, 95) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.625060, 0.250708) -> Grid(100, 40) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.458620, 0.801065) -> Grid(73, 128) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.483385, 0.492667) -> Grid(77, 78) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.178136, 0.098539) -> Grid(28, 15) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should abandon unreachable job (Abandonment Test)
[Game] Dispose called for Game Instance.
[GoblinManager] 5個の洞窟を生成中...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.533837, 0.037577) -> Grid(85, 6) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.938951, 0.863921) -> Grid(150, 138) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.246083, 0.463639) -> Grid(39, 74) rngState=undefined
[GoblinManager] 洞窟生成完了: 0/5 (試行回数: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should abandon unreachable job (Abandonment Test)
[Entity 3] Calling updatePosition...
[Entity 3] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[Game] Request Added: raise at (90,90) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job
[Actor 0] smartMove to 90,90 (H:5). Reachable:true Dist:28.28 Moving:false Path:0
[Actor 0] smartMove: triggers pathfinding. Dist: 28.3 Time:0.0 Last:0.0 Throttle:1.00 Action:Approaching Job
[Game] Request req_0 Deferred (Excluded) for 3s until 3.1
[Unit 0] State Change: Job -> Wander

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Goblin King should crush Worker
[Entity 9] Calling registerEntity...
[Entity 9] registerEntity returned.
[Entity 9] Calling updatePosition...
[Entity 9] updatePosition returned.
[ActorCore] Actor Created. Type: unit Pos: 10,10
[UnitCore.js] Unit Created ID:4 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:4 Role:worker Pos:10,10
Goblin constructor: calling super...
[Entity 10] Calling registerEntity...
[Entity 10] registerEntity returned.
[Entity 10] Calling updatePosition...
[Entity 10] updatePosition returned.
[ActorCore] Actor Created. Type: goblin Pos: 10,10
Goblin constructor: super returned.
Goblin constructor: checking scene...
Goblin constructor: setting ID...
Worker HP: 63, Dmg: 12
King HP: 1647, Dmg: 80
[Unit Debug] ATTACKING Goblin 5
[Unit 4] Death Counter! Hitting 5
Unit 4 (worker) DIED. R.I.P.
Goblin hit Unit! Dmg: 80 UnitHP: 0 
[Worker vs King]
 Start: Unit(worker HP:63/63 Dmg:12) vs Goblin(king HP:1647/1647 Dmg:80)
End: Winner=Goblin Frames=2
Final: Unit HP:0.0 Goblin HP:1629.0

stdout | src/tests/CombatBalance.test.js > Combat Balance Verification > Goblin King should crush Worker
[Game] Dispose called for Game Instance.

 ✓ src/tests/ComplexAI.test.js > Complex AI Scenarios > should drop job gracefully if target building is destroyed 17ms
 ✓ src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear 15ms
 ✓ src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night 8ms
 ✓ src/tests/ComplexAI.test.js > Complex AI Scenarios > should abandon unreachable job (Abandonment Test) 7ms
 ✓ src/tests/CombatBalance.test.js > Combat Balance Verification > Worker vs Normal Goblin (Expected: Goblin Win due to stats buff) 19ms
 ✓ src/tests/CombatBalance.test.js > Combat Balance Verification > Normal Goblin vs House (Expected: Mutually Assured Destruction or House Defense) 5ms
 ✓ src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs Normal Goblin (Expected: Knight Stomp) 8ms
 ✓ src/tests/CombatBalance.test.js > Combat Balance Verification > Knight vs King Goblin (Expected: Close or King Advantage) 7ms
 ✓ src/tests/CombatBalance.test.js > Combat Balance Verification > Wizard vs Hobgoblin (Expected: Wizard High DPS but Fragile) 5ms
 ✓ src/tests/CombatBalance.test.js > Combat Balance Verification > Goblin King should crush Worker 5ms
 ✓ src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should immediately switch to Job and target the job upon assignment 7ms
 ✓ src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should NOT be distracted by WanderState updates during Job 3ms
 ✓ src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should not freeze due to throttle at low game time 2ms
 × src/tests/WorkerDistraction.test.js > Worker Distraction Investigation > should NOT build a house immediately if pathfinding fails temporarily 672ms
   → expected Job{ …(5) } to not be an instance of Job

 Test Files  1 failed | 3 passed (4)
      Tests  1 failed | 16 passed (17)
   Start at  21:14:16
   Duration  1.97s (transform 1.26s, setup 294ms, import 1.61s, tests 817ms, environment 2.41s)

