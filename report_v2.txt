
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/mooya/develop/test[39m

[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mshould retry migration after 30 seconds timeout
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:50,50 Special:false

 [31mç¬¶ï½¯[39m src/tests/SimpleRegion.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 81[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should identify a single island[39m[32m 66[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should split two islands[39m[32m 13[2mms[22m[39m
[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mshould interrupt migration if enemy is found (Priority)
[22m[39m[UnitCore.js] Unit Created ID:1 Role:worker Pos:50,50 Special:false

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Goblin if it is much closer than Building
[22m[39m[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false

[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mshould stop migrating if construction succeeds
[22m[39m[UnitCore.js] Unit Created ID:2 Role:worker Pos:50,50 Special:false

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Goblin if it is much closer than Building
[22m[39m[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=undefined

[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mDEBUG: should log blockage reasons correctly
[22m[39m[UnitCore.js] Unit Created ID:3 Role:worker Pos:50,50 Special:false

[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mDEBUG: should log blockage reasons correctly
[22m[39m--- DEBUG: Testing Slope Block ---
[Unit test-migrant] Blocked by Slope at 21,20 H:2->6
--- DEBUG: Testing Water Block ---
--- DEBUG: Testing Building Pass ---

 [31mç¬¶ï½¯[39m src/tests/MigrationImprovement.test.js [2m([22m[2m4 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 69[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should retry migration after 30 seconds timeout[39m[32m 55[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should interrupt migration if enemy is found (Priority)[39m[32m 3[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should stop migrating if construction succeeds[39m[32m 3[2mms[22m[39m
     [32mç¬¨ãƒ»[39m DEBUG: should log blockage reasons correctly[32m 5[2mms[22m[39m
[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Building if distances are similar (Bonus check)
[22m[39m[UnitCore.js] Unit Created ID:1 Role:knight Pos:0,0 Special:false

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould allow Workers to target Huts at range 25 (New Range: 30)
[22m[39m[UnitCore.js] Unit Created ID:2 Role:knight Pos:0,0 Special:false

 [31mç¬¶ï½¯[39m src/tests/TargetingPriority.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 98[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should prioritize Goblin if it is much closer than Building[39m[32m 50[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should prioritize Building if distances are similar (Bonus check)[39m[32m 4[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should allow Workers to target Huts at range 25 (New Range: 30)[39m[32m 27[2mms[22m[39m
[90mstdout[2m | src/tests/BuildingDefense.test.js[2m > [22m[2mBuilding Defense Logic[2m > [22m[2mStandard HP logic for Goblin buildings
[22m[39m[UnitCore.js] Unit Created ID:0 Role:knight Pos:20,20 Special:false
Unit 0 attacking cave. HP: 150

 [31mç¬¶ï½¯[39m src/tests/BuildingDefense.test.js [2m([22m[2m8 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[32m 127[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Goblins deal population damage to player buildings[39m[32m 56[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Goblins deal structural damage to empty player buildings[39m[32m 3[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Goblins destroy player buildings when HP reaches 0[39m[32m 8[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Buildings retaliate against melee goblins[39m[32m 3[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Towers have massive retaliation[39m[32m 2[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m No retaliation for distant attackers (Shamans)[39m[32m 2[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Goblins can target buildings with 0 population but > 0 structural HP[39m[32m 10[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Standard HP logic for Goblin buildings[32m 40[2mms[22m[39m
[90mstdout[2m | src/tests/CombatBalance.test.js[2m > [22m[2mCombat Balance Simulation[2m > [22m[2mKnight vs Single Goblin (1v1) - AI Logic Check
[22m[39m[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false

[90mstdout[2m | src/tests/CombatBalance.test.js[2m > [22m[2mCombat Balance Simulation[2m > [22m[2mWizard vs Single Goblin (1v1) - Wizard should win
[22m[39m[UnitCore.js] Unit Created ID:1 Role:wizard Pos:0,0 Special:false

[90mstdout[2m | src/tests/CombatBalance.test.js[2m > [22m[2mCombat Balance Simulation[2m > [22m[2mKnight vs Swarm (1v5) - Knight should surviving
[22m[39m[UnitCore.js] Unit Created ID:2 Role:knight Pos:0,0 Special:false

[90mstdout[2m | src/tests/CombatBalance.test.js[2m > [22m[2mCombat Balance Simulation[2m > [22m[2mLoad Game Persistence - Should resume movement
[22m[39m[UnitCore.js] Unit Created ID:3 Role:knight Pos:0,0 Special:false

 [31mç¬¶ï½¯[39m src/tests/CombatBalance.test.js [2m([22m[2m4 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[32m 60[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Knight vs Single Goblin (1v1) - AI Logic Check[39m[32m 48[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Wizard vs Single Goblin (1v1) - Wizard should win[39m[32m 3[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Knight vs Swarm (1v5) - Knight should surviving[39m[32m 3[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Load Game Persistence - Should resume movement[39m[32m 2[2mms[22m[39m
 [31mç¬¶ï½¯[39m src/tests/BuildingDestruction.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 398[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should destroy building immediately when population hits 0[39m[32m 240[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should destroy building if already 0[39m[32m 74[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should NOT destroy building if population remains > 0[39m[32m 81[2mms[22m[39m
[90mstdout[2m | src/tests/Hotspot.test.js[2m > [22m[2mGlobal Battle Hotspots Logic[2m > [22m[2mClusters nearby battle reports
[22m[39m[Game] New Battle Hotspot at 10,10 (Region:1)

 [31mç¬¶ï½¯[39m src/tests/GoblinMobilization.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 373[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m triggerWave should mobilize idle goblins[39m[32m 265[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m mobilizeClan should rely on getClanRaidTarget fallback[39m[32m 105[2mms[22m[39m
[90mstdout[2m | src/tests/Hotspot.test.js[2m > [22m[2mGlobal Battle Hotspots Logic[2m > [22m[2mDecays intensity
[22m[39m[Game] New Battle Hotspot at 10,10 (Region:1)

[90mstdout[2m | src/tests/Hotspot.test.js[2m > [22m[2mGlobal Battle Hotspots Logic[2m > [22m[2mMobilizes idle squads
[22m[39m[Game] Mobilizing Squad 1 to Hotspot at 50,50 (Intensity:100.0)

 [31mç¬¶ï½¯[39m src/tests/Hotspot.test.js [2m([22m[2m6 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 958[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m Clusters nearby battle reports [33m 932[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Decays intensity[32m 1[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Mobilizes idle squads to intense hotspots (Updated Threshold)[39m[32m 12[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Triggers autonomous patrol for idle Knights[32m 4[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Mobilizes idle squads[32m 3[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Does not mobilize across regions[32m 2[2mms[22m[39m
[90mstdout[2m | src/tests/AdvancedUnits.test.js[2m > [22m[2mAdvanced Units[2m > [22m[2mshould initialize Knight with high stats
[22m[39m[UnitCore.js] Unit Created ID:0 Role:knight Pos:10,10 Special:false

[90mstdout[2m | src/tests/AdvancedUnits.test.js[2m > [22m[2mAdvanced Units[2m > [22m[2mshould initialize Wizard with low HP and high stats
[22m[39m[UnitCore.js] Unit Created ID:1 Role:wizard Pos:10,10 Special:false

 [31mç¬¶ï½¯[39m src/tests/WorkerReachability.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 994[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m findBestRequest filters out unreachable jobs [33m 961[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m forceAssignRequest skips unreachable units[39m[32m 30[2mms[22m[39m
[90mstdout[2m | src/tests/AdvancedUnits.test.js[2m > [22m[2mAdvanced Units[2m > [22m[2mshould allow Wizard to attack from range
[22m[39m[UnitCore.js] Unit Created ID:2 Role:wizard Pos:10,10 Special:false
[Unit Debug] ATTACKING Goblin g1

 [31mç¬¶ï½¯[39m src/tests/CombatRequestHandoff.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 964[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Worker releases job when engaging in combat[39m[33m 439[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m forceAssignRequest prioritizes nearby busy unit over distant idle unit[39m[33m 521[2mms[22m[39m
[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould tag new requests with createdAt timestamp
[22m[39mGame constructor called

 [31mç¬¶ï½¯[39m src/tests/AdvancedUnits.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 47[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should initialize Knight with high stats[32m 7[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should initialize Wizard with low HP and high stats[39m[32m 12[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should allow Wizard to attack from range[39m[32m 25[2mms[22m[39m
[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould cleanup expired pending requests
[22m[39mGame constructor called

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould NOT cleanup assigned requests even if old
[22m[39mGame constructor called

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould cancel request via Proximity Search
[22m[39mGame constructor called

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould prioritize nearest request when cancelling
[22m[39mGame constructor called

 [31mç¬¶ï½¯[39m src/tests/RequestLifecycle.test.js [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 163[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should tag new requests with createdAt timestamp[39m[32m 103[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should cleanup expired pending requests[39m[32m 9[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should NOT cleanup assigned requests even if old[39m[32m 32[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should cancel request via Proximity Search[39m[32m 4[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should prioritize nearest request when cancelling[39m[32m 11[2mms[22m[39m
 [31mç¬¶ï½¯[39m src/tests/GoblinFixes.test.js [2m([22m[2m4 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 561[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Entity.getDistance should handle wrapping[39m[32m 290[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Terrain.findBestTarget should find wrapped targets[39m[32m 111[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Terrain.findBestTarget should handle non-wrapping case correctly (sanity)[39m[32m 100[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m GoblinManager difficulty scaling increases stronger goblin probability[39m[32m 57[2mms[22m[39m
 [31mç¬¶ï½¯[39m src/tests/StuckDebug.test.js [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1029[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should log reason for blockage[39m[33m 1026[2mms[22m[39m
 [31mç¬¶ï½¯[39m src/tests/MinimalUnit.test.js [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1149[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m can instantiate Unit[39m[33m 1146[2mms[22m[39m
[90mstdout[2m | src/tests/UnitBehavior.test.js[2m > [22m[2mUnit Behavior Mode[2m > [22m[2mshould return Patrol for Knight/Wizard when idle
[22m[39m[UnitCore.js] Unit Created ID:0 Role:undefined Pos:5,5 Special:false

[90mstdout[2m | src/tests/UnitBehavior.test.js[2m > [22m[2mUnit Behavior Mode[2m > [22m[2mshould return Wander for Worker when idle
[22m[39m[UnitCore.js] Unit Created ID:1 Role:undefined Pos:5,5 Special:false

[90mstdout[2m | src/tests/UnitBehavior.test.js[2m > [22m[2mUnit Behavior Mode[2m > [22m[2mshould return Combat when targetGoblin is set
[22m[39m[UnitCore.js] Unit Created ID:2 Role:undefined Pos:5,5 Special:false

[90mstdout[2m | src/tests/UnitBehavior.test.js[2m > [22m[2mUnit Behavior Mode[2m > [22m[2mshould return Siege when targetBuilding is set
[22m[39m[UnitCore.js] Unit Created ID:3 Role:undefined Pos:5,5 Special:false

[90mstdout[2m | src/tests/UnitBehavior.test.js[2m > [22m[2mUnit Behavior Mode[2m > [22m[2mshould return Working when targetRequest is set
[22m[39m[UnitCore.js] Unit Created ID:4 Role:undefined Pos:5,5 Special:false

[90mstdout[2m | src/tests/UnitBehavior.test.js[2m > [22m[2mUnit Behavior Mode[2m > [22m[2mshould return Exploration with coords when targetRaidPoint is set
[22m[39m[UnitCore.js] Unit Created ID:5 Role:undefined Pos:5,5 Special:false

[90mstdout[2m | src/tests/WorkerRequest.test.js[2m > [22m[2mWorker Job Logic (Unit.js)[2m > [22m[2mUnit finds and claims request when idle
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false

[90mstdout[2m | src/tests/WorkerRequest.test.js[2m > [22m[2mWorker Job Logic (Unit.js)[2m > [22m[2mUnit moves to target request
[22m[39m[UnitCore.js] Unit Created ID:1 Role:worker Pos:0,0 Special:false

[90mstdout[2m | src/tests/UnitBehavior.test.js[2m > [22m[2mUnit Behavior Mode[2m > [22m[2mshould return Migrating when action is Migrating
[22m[39m[UnitCore.js] Unit Created ID:6 Role:undefined Pos:5,5 Special:false

[90mstdout[2m | src/tests/UnitBehavior.test.js[2m > [22m[2mUnit Behavior Mode[2m > [22m[2mshould prioritize Combat over Exploration
[22m[39m[UnitCore.js] Unit Created ID:7 Role:undefined Pos:5,5 Special:false

 [31mç¬¶ï½¯[39m src/tests/UnitBehavior.test.js [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 38[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should return Patrol for Knight/Wizard when idle[32m 7[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should return Wander for Worker when idle[32m 2[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should return Combat when targetGoblin is set[32m 1[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should return Siege when targetBuilding is set[32m 1[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should return Working when targetRequest is set[32m 1[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should return Exploration with coords when targetRaidPoint is set[39m[32m 19[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should return Migrating when action is Migrating[32m 2[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should prioritize Combat over Exploration[32m 1[2mms[22m[39m
[90mstdout[2m | src/tests/WorkerRequest.test.js[2m > [22m[2mWorker Job Logic (Unit.js)[2m > [22m[2mUnit completes request upon arrival
[22m[39m[UnitCore.js] Unit Created ID:2 Role:worker Pos:0,0 Special:false

 [31mç¬¶ï½¯[39m src/tests/WorkerRequest.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 39[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Unit finds and claims request when idle[32m 9[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Unit moves to target request[39m[32m 20[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Unit completes request upon arrival[39m[32m 6[2mms[22m[39m
[90mstdout[2m | src/tests/CombatVerification.test.js[2m > [22m[2mCombat Logic Verification[2m > [22m[2mScenario A: Worker destroys Cave
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 1] Moving onto Rock at 10,10 H:10 (Speed Penalty)
[MockTerrain] Searching 1 buildings. Range:25 Center:10,10
  - Checking Building at 12,10. Dist:2
    -> Score: 2
Unit 1 found Base via Spatial Search!
Approach Point: 11,10
Unit 1 attacking cave. HP: 196

[90mstdout[2m | src/tests/CombatVerification.test.js[2m > [22m[2mCombat Logic Verification[2m > [22m[2mScenario B: Goblin destroys House
[22m[39mGoblin 0 SPAWNED FOR RAIDING! Target: NaN,NaN
[Goblin 0] ENTER RaidState. Goal: NaN,NaN
[MockTerrain] Searching 1 buildings. Range:25 Center:20,20
  - Checking Building at 22,20. Dist:2
    -> Score: 2
Goblin 0 attacking house. Pop: 1.92
Goblin 0 attacking house. Pop: 1.84
House Pop: 1.8399999999999999

[90mstdout[2m | src/tests/CombatVerification.test.js[2m > [22m[2mCombat Logic Verification[2m > [22m[2mScenario C: Goblin finds and destroys House
[22m[39m[MockTerrain] Searching 1 buildings. Range:12 Center:8,8
  - Checking Building at 10,10. Dist:2.8284271247461903
    -> Score: 2.8284271247461903
Goblin 1 hitting Empty house. HP: 92
Goblin 1 hitting Empty house. HP: 84
[Test] House HP reduced to 84

 [31mç¬¶ï½¯[39m src/tests/CombatVerification.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 37[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Scenario A: Worker destroys Cave[39m[32m 24[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Scenario B: Goblin destroys House[32m 5[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Scenario C: Goblin finds and destroys House[32m 2[2mms[22m[39m
[90mstdout[2m | src/tests/NightLogic.test.js[2m > [22m[2mNight Logic - Shelter Entry[2m > [22m[2mWorker should engage pathfinding to House but is likely blocked
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false
[Unit 0] Moving onto Rock at 0,1 H:10 (Speed Penalty)

 [31mç¬¶ï½¯[39m src/tests/NightLogic.test.js [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 37[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Worker should engage pathfinding to House but is likely blocked[39m[32m 33[2mms[22m[39m
 [31mç¬¶ï½¯[39m src/tests/GoblinDestruction.test.js [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 37[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should damage building population[39m[32m 29[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should destroy building when population drops below 1.0[39m[32m 2[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should destroy building even if fractional population remains (e.g. 0.5)[39m[32m 1[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should NOT destroy building if population remains >= 1.0[39m[32m 1[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should take retaliation damage[39m[32m 1[2mms[22m[39m
stderr | src/tests/GhostHouse.test.js > Terrain Ghost House Test > should accumulate ghost buildings in entityGrid if not cleared during deserialize
[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

 [31mç¬¶ï½¯[39m src/tests/GhostHouse.test.js [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 19[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should accumulate ghost buildings in entityGrid if not cleared during deserialize[39m[32m 16[2mms[22m[39m
 [31mç¬¶ï½¯[39m src/tests/CavePersistence.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 31[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should update cave Y position when terrain height changes[39m[32m 26[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should still destroy cave if submerged (height <= 0)[39m[32m 2[2mms[22m[39m
[90mstdout[2m | src/tests/UnitWrapping.test.js[2m > [22m[2mUnit Movement Wrapping[2m > [22m[2mshould move normally for short distances
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false

[90mstdout[2m | src/tests/UnitWrapping.test.js[2m > [22m[2mUnit Movement Wrapping[2m > [22m[2mshould wrap LEFT if target is across right boundary
[22m[39m[UnitCore.js] Unit Created ID:1 Role:worker Pos:0,0 Special:false

[90mstdout[2m | src/tests/ForceAssignment.test.js[2m > [22m[2mForce Assignment Integration[2m > [22m[2mshould successfully triggerMove without infinite loop
[22m[39mGame constructor called
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false

[90mstdout[2m | src/tests/UnitWrapping.test.js[2m > [22m[2mUnit Movement Wrapping[2m > [22m[2mshould wrap RIGHT if target is across left boundary
[22m[39m[UnitCore.js] Unit Created ID:2 Role:worker Pos:0,0 Special:false

[90mstdout[2m | src/tests/UnitWrapping.test.js[2m > [22m[2mUnit Movement Wrapping[2m > [22m[2mshould handle Z axis wrapping
[22m[39m[UnitCore.js] Unit Created ID:3 Role:worker Pos:0,0 Special:false

 [31mç¬¶ï½¯[39m src/tests/UnitWrapping.test.js [2m([22m[2m4 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[32m 23[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should move normally for short distances[39m[32m 12[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should wrap LEFT if target is across right boundary[39m[32m 2[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should wrap RIGHT if target is across left boundary[39m[32m 2[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should handle Z axis wrapping[39m[32m 4[2mms[22m[39m
[90mstdout[2m | src/tests/ForceAssignment.test.js[2m > [22m[2mForce Assignment Integration[2m > [22m[2mshould handle Force Assignment logic block
[22m[39mGame constructor called
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false

 [31mç¬¶ï½¯[39m src/tests/ForceAssignment.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 24[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should successfully triggerMove without infinite loop[39m[32m 18[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should handle Force Assignment logic block[39m[32m 4[2mms[22m[39m
[90mstdout[2m | src/tests/UnitInit.test.js[2m > [22m[2mUnit Initialization and Movement Start[2m > [22m[2mshould wait for moveInterval before first move
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false

[90mstdout[2m | src/tests/UnitInit.test.js[2m > [22m[2mUnit Initialization and Movement Start[2m > [22m[2mshould NOT freeze if started at time 0
[22m[39m[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false

 [31mç¬¶ï½¯[39m src/tests/UnitInit.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 23[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should wait for moveInterval before first move[39m[32m 16[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should NOT freeze if started at time 0[32m 4[2mms[22m[39m
 [31mç¬¶ï½¯[39m src/tests/ManaSystem.test.js [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 28[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should block actions when mana is negative[32m 4[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should allow actions when mana is positive[32m 1[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should consume mana correctly[32m 3[2mms[22m[39m
[31m       [31mï¾ƒãƒ»[31m should consume mana on raise terrain[39m[32m 14[2mms[22m[39m
       [32mç¬¨ãƒ»[39m should block raise terrain if mana is negative[32m 2[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinTypes.test.js[2m > [22m[2mGoblin Types & Stats[2m > [22m[2mshould correctly spawn types based on random probability
[22m[39mGoblinManager: Generation started...
GoblinManager: Cave registered at 50,50 
[GoblinManager] Clan clan_cave_50_50 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin
îžè˜ Goblin King Spawned!

 [32mç¬¨ãƒ»[39m src/tests/GoblinTypes.test.js [2m([22m[2m4 tests[22m[2m)[22m[32m 40[2mms[22m[39m
[90mstdout[2m | src/tests/Pathfinding.test.js[2m > [22m[2mTerrain Pathfinding Costs[2m > [22m[2mPrefers a longer flat route over a shorter mountain route
[22m[39mPath Length: 31
Goes through gap: true
Goes through mountain: false

 [32mç¬¨ãƒ»[39m src/tests/Pathfinding.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 149[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/UnitVisibility.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 162[2mms[22m[39m
[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mResource Gathering[2m > [22m[2mshould gather fish if checking neighbors finds water
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:5,5 Special:false

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mResource Gathering[2m > [22m[2mshould NOT gather fish if completely inland
[22m[39m[UnitCore.js] Unit Created ID:1 Role:worker Pos:5,5 Special:false

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mBuild Priority (Famine)[2m > [22m[2mshould prioritize Farm and ABORT house if farm fails during famine
[22m[39m[UnitCore.js] Unit Created ID:2 Role:worker Pos:5,5 Special:false

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mBuild Priority (Famine)[2m > [22m[2mshould prioritize Farm and ABORT house if farm fails during famine
[22m[39m[Unit 2] Moving onto Rock at 5,6 H:10 (Speed Penalty)
[Unit 2] Blocked by Slope at 5,6 H:1->10

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mBuild Priority (Famine)[2m > [22m[2mshould fallback to House if NOT in famine
[22m[39m[UnitCore.js] Unit Created ID:3 Role:worker Pos:5,5 Special:false

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mBuild Priority (Famine)[2m > [22m[2mshould fallback to House if NOT in famine
[22m[39m[Unit 3] Moving onto Rock at 5,6 H:10 (Speed Penalty)
[Unit 3] Blocked by Slope at 5,6 H:1->10

 [32mç¬¨ãƒ»[39m src/tests/Unit.test.js [2m([22m[2m8 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[32m 40[2mms[22m[39m
[90mstdout[2m | src/tests/Movement.test.js[2m > [22m[2mTerrain Movement and Logic Tests[2m > [22m[2mshould set very long moveDuration for Unit on Rock
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false

stderr | src/tests/Movement.test.js > Terrain Movement and Logic Tests > should set very long moveDuration for Unit on Rock
DEBUG: MoveDur=5.8
DEBUG: Heights Cur=10 Next=12

[90mstdout[2m | src/tests/Movement.test.js[2m > [22m[2mTerrain Movement and Logic Tests[2m > [22m[2mshould set normal moveDuration on Flat
[22m[39m[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false

stderr | src/tests/Movement.test.js > Terrain Movement and Logic Tests > should set normal moveDuration on Flat
DEBUG: Normal MoveDur=0.8

[90mstdout[2m | src/tests/Movement.test.js[2m > [22m[2mTerrain Movement and Logic Tests[2m > [22m[2mshould prevent Unit from moving/building on Rock checks?
[22m[39m[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10 Special:false

[90mstdout[2m | src/tests/Movement.test.js[2m > [22m[2mTerrain Movement and Logic Tests[2m > [22m[2mshould increase Goblin Hut population and spawn goblin
[22m[39m[UnitCore.js] Unit Created ID:3 Role:worker Pos:10,10 Special:false

[90mstdout[2m | src/tests/WorkerDiversity.test.js[2m > [22m[2mWorker Diversity Spawning[2m > [22m[2mshould spawn diverse roles (Worker/Hunter/Fisher) from a House
[22m[39mSpawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:0 Role:hunter Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:1 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:3 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:4 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:5 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:6 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:7 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:8 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:9 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:10 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:11 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:12 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:13 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:14 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:15 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:16 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:17 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:18 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:19 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:20 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:21 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:22 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:23 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:24 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:25 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:26 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:27 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:28 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:29 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:30 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:31 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:32 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:33 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:34 Role:fisher Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:35 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:36 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:37 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:38 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:39 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:40 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:41 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:42 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:43 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:44 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:45 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:46 Role:fisher Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:47 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:48 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:49 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:50 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:51 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:52 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:53 Role:hunter Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:54 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:55 Role:fisher Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:56 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:57 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:58 Role:hunter Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:59 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:60 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:61 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:62 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:63 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:64 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:65 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:66 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:67 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:68 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:69 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:70 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:71 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:72 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:73 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:74 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:75 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:76 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:77 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:78 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:79 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:80 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:81 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:82 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:83 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:84 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:85 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:86 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:87 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:88 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:89 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:90 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:91 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:92 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:93 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:94 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:95 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:96 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:97 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:98 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:99 Role:worker Pos:10,10 Special:false
Spawn Distribution (100 runs): { worker: [33m57[39m, hunter: [33m23[39m, fisher: [33m20[39m }

[90mstdout[2m | src/tests/WorkerDiversity.test.js[2m > [22m[2mWorker Diversity Spawning[2m > [22m[2mshould spawn Knights from Barracks
[22m[39mSpawned knight linked to barracks at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:100 Role:knight Pos:10,10 Special:false

[90mstdout[2m | src/tests/WorkerDiversity.test.js[2m > [22m[2mWorker Diversity Spawning[2m > [22m[2mshould spawn Wizards from Towers
[22m[39mSpawned wizard linked to tower at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:101 Role:wizard Pos:10,10 Special:false

 [32mç¬¨ãƒ»[39m src/tests/WorkerDiversity.test.js [2m([22m[2m3 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstdout[2m | src/tests/Movement.test.js[2m > [22m[2mTerrain Movement and Logic Tests[2m > [22m[2mshould increase Goblin Hut population and spawn goblin
[22m[39mGoblinManager: Generation started...
GoblinManager: Cave registered at 50,50 
[GoblinManager] Clan clan_cave_50_50 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin
Goblin born from Hut! Clan: test. Global Pop: 1

 [32mç¬¨ãƒ»[39m src/tests/Movement.test.js [2m([22m[2m4 tests[22m[2m)[22m[32m 66[2mms[22m[39m
[90mstdout[2m | src/tests/Lighting.test.js[2m > [22m[2mBuildingRenderer Lighting[2m > [22m[2mshould turn on barracks lights at night
[22m[39mTower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

[90mstdout[2m | src/tests/UnitAISearch.test.js[2m > [22m[2mUnit AI Search Optimization[2m > [22m[2mshould use Spatial Search to find goblin
[22m[39m[UnitCore.js] Unit Created ID:0 Role:guard Pos:0,0 Special:false

 [32mç¬¨ãƒ»[39m src/tests/Lighting.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 79[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/UnitAISearch.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 19[2mms[22m[39m
[90mstdout[2m | src/tests/SquadAi.test.js[2m > [22m[2mSquad AI & Region Logic[2m > [22m[2mshould share targets among squad members
[22m[39m[UnitCore.js] Unit Created ID:0 Role:knight Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:knight Pos:20,20 Special:false

[90mstdout[2m | src/tests/SquadAi.test.js[2m > [22m[2mSquad AI & Region Logic[2m > [22m[2mRegression: Migration Stagnation Fix (Knight)
[22m[39m[UnitCore.js] Unit Created ID:2 Role:knight Pos:10,10 Special:false
Unit 2 (knight) finished migrating. Resuming Idle.

[90mstdout[2m | src/tests/SquadAi.test.js[2m > [22m[2mSquad AI & Region Logic[2m > [22m[2mRegression: Migration Stagnation Fix (Worker)
[22m[39m[UnitCore.js] Unit Created ID:3 Role:worker Pos:10,10 Special:false
Unit 3 (Worker) migration target invalid for build. Searching nearby...

[90mstdout[2m | src/tests/SquadAi.test.js[2m > [22m[2mSquad AI & Region Logic[2m > [22m[2mshould allow cross-region movement if target is very close (Self Defense)
[22m[39m[UnitCore.js] Unit Created ID:4 Role:knight Pos:10,10 Special:false

 [32mç¬¨ãƒ»[39m src/tests/SquadAi.test.js [2m([22m[2m5 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinSpawn.test.js[2m > [22m[2mGoblin Hut Spawning[2m > [22m[2mshould spawn goblin when hut population reaches 10
[22m[39mGoblinManager: Generation started...
GoblinManager: Cave registered at 40,49 
[GoblinManager] Clan clan_cave_40_49 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 11,60 
[GoblinManager] Clan clan_cave_11_60 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 85,0 
[GoblinManager] Clan clan_cave_85_0 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 16,65 
[GoblinManager] Clan clan_cave_16_65 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 79,13 
[GoblinManager] Clan clan_cave_79_13 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin

[90mstdout[2m | src/tests/GoblinSpawn.test.js[2m > [22m[2mGoblin Hut Spawning[2m > [22m[2mshould spawn goblin when hut population reaches 10
[22m[39mGoblin born from Hut! Clan: clan_hut_10_10. Global Pop: 0

[90mstdout[2m | src/tests/GoblinSpawn.test.js[2m > [22m[2mGoblin Hut Spawning[2m > [22m[2mshould NOT spawn if Global Cap is reached
[22m[39mGoblinManager: Generation started...
GoblinManager: Cave registered at 56,45 
[GoblinManager] Clan clan_cave_56_45 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 81,27 
[GoblinManager] Clan clan_cave_81_27 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 86,82 
[GoblinManager] Clan clan_cave_86_82 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 5,14 
[GoblinManager] Clan clan_cave_5_14 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 42,62 
[GoblinManager] Clan clan_cave_42_62 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin

 [32mç¬¨ãƒ»[39m src/tests/GoblinSpawn.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 62[2mms[22m[39m
[90mstdout[2m | src/tests/ForceBuild.test.js[2m > [22m[2mTerrain Force Build Logic[2m > [22m[2mshould clear existing buildings when placing a new one
[22m[39m[Terrain] addBuilding: house at 10,10. Force:false
[Terrain] Building Added: house at (10, 10) Size:2x2. Total: 1
[Terrain] Clearing obstacle: house for new construction.
[Terrain] Building removed at 10,10
[Terrain] addBuilding: barracks at 10,10. Force:false
[Terrain] Building Added: barracks at (10, 10) Size:3x3. Total: 1

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould save game data correctly
[22m[39mGame constructor called

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould save game data correctly
[22m[39mSaving Game Data: {
  slotId: [33m1[39m,
  timestamp: [33m1766911497172[39m,
  resources: { grain: [33m100[39m, fish: [33m50[39m, meat: [33m25[39m },
  gameTime: [33m12[39m,
  gameTotalTime: [33m0[39m,
  currentSeasonIndex: [90mundefined[39m,
  daysPassed: [90mundefined[39m,
  terrain: {
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m2[39m,
    h: [
      [33m12[39m, [33m11[39m, [33m11[39m, [33m10[39m, [33m10[39m,  [33m9[39m,  [33m8[39m,  [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,
       [33m6[39m,  [33m5[39m,  [33m4[39m,  [33m4[39m,  [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m4[39m,  [33m3[39m,  [33m3[39m,
       [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m1[39m,  [33m1[39m,  [33m0[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m,
      [33m-0[39m,  [33m0[39m,  [33m1[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,
       [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m0[39m, [33m-0[39m, [33m-1[39m, [33m-1[39m, [33m-2[39m,
      [33m-3[39m, [33m-3[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-3[39m, [33m-2[39m,
      [33m-2[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m, [33m-0[39m,  [33m1[39m,  [33m2[39m,  [33m4[39m,  [33m4[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,
       [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m4[39m,  [33m4[39m,  [33m4[39m,  [33m4[39m,  [33m4[39m,
       [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m5[39m,
      ... 25500 more items
    ],
    n: [
       [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.02[39m,
       [33m0.01[39m,  [33m0.01[39m, [33m-0.02[39m,    [33m-0[39m, [33m-0.02[39m, [33m-0.02[39m,    [33m-0[39m, [33m-0.02[39m, [33m-0.02[39m,
       [33m0.01[39m,    [33m-0[39m, [33m-0.02[39m,    [33m-0[39m,    [33m-0[39m, [33m-0.02[39m, [33m-0.01[39m, [33m-0.02[39m,  [33m0.02[39m,
       [33m0.02[39m,     [33m0[39m, [33m-0.02[39m, [33m-0.02[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.02[39m,    [33m-0[39m,     [33m0[39m,
      [33m-0.02[39m,  [33m0.02[39m,    [33m-0[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.02[39m,  [33m0.02[39m,
      [33m-0.01[39m, [33m-0.01[39m,     [33m0[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,     [33m0[39m,  [33m0.01[39m,  [33m0.02[39m,
       [33m0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m,    [33m-0[39m,  [33m0.01[39m,     [33m0[39m,     [33m0[39m,  [33m0.02[39m,
       [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m,
      [33m-0.01[39m,  [33m0.01[39m,  [33m0.01[39m, [33m-0.02[39m,     [33m0[39m,  [33m0.01[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.02[39m,
         [33m-0[39m,  [33m0.02[39m, [33m-0.01[39m,     [33m0[39m,     [33m0[39m, [33m-0.01[39m,    [33m-0[39m,  [33m0.02[39m,    [33m-0[39m,
      [33m-0.01[39m,     [33m0[39m, [33m-0.02[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.02[39m,  [33m0.01[39m,  [33m0.01[39m,    [33m-0[39m,
       [33m0.02[39m,
      ... 25500 more items
    ],
    b: [],
    m: [
      [33m0.74[39m, [33m0.73[39m, [33m0.72[39m, [33m0.69[39m, [33m0.67[39m, [33m0.66[39m, [33m0.65[39m, [33m0.64[39m, [33m0.63[39m, [33m0.61[39m,
      [33m0.59[39m, [33m0.57[39m, [33m0.56[39m, [33m0.57[39m, [33m0.58[39m,  [33m0.6[39m,  [33m0.6[39m, [33m0.58[39m, [33m0.57[39m, [33m0.54[39m,
      [33m0.53[39m, [33m0.51[39m,  [33m0.5[39m, [33m0.49[39m, [33m0.49[39m, [33m0.49[39m,  [33m0.5[39m, [33m0.52[39m, [33m0.54[39m, [33m0.56[39m,
      [33m0.59[39m,  [33m0.6[39m, [33m0.61[39m, [33m0.61[39m,  [33m0.6[39m, [33m0.59[39m, [33m0.58[39m, [33m0.56[39m, [33m0.55[39m, [33m0.54[39m,
      [33m0.53[39m, [33m0.53[39m, [33m0.52[39m, [33m0.51[39m, [33m0.51[39m, [33m0.51[39m, [33m0.51[39m, [33m0.52[39m, [33m0.53[39m, [33m0.54[39m,
      [33m0.54[39m, [33m0.54[39m, [33m0.54[39m, [33m0.57[39m, [33m0.61[39m, [33m0.65[39m, [33m0.69[39m, [33m0.71[39m, [33m0.73[39m, [33m0.75[39m,
      [33m0.78[39m,  [33m0.8[39m, [33m0.82[39m, [33m0.84[39m, [33m0.85[39m, [33m0.84[39m, [33m0.83[39m, [33m0.81[39m, [33m0.79[39m, [33m0.78[39m,
      [33m0.78[39m, [33m0.78[39m, [33m0.76[39m, [33m0.75[39m, [33m0.73[39m, [33m0.71[39m, [33m0.69[39m, [33m0.67[39m, [33m0.64[39m, [33m0.62[39m,
       [33m0.6[39m, [33m0.58[39m, [33m0.56[39m, [33m0.53[39m, [33m0.51[39m,  [33m0.5[39m, [33m0.49[39m, [33m0.48[39m, [33m0.47[39m, [33m0.45[39m,
      [33m0.43[39m, [33m0.41[39m,  [33m0.4[39m,  [33m0.4[39m,  [33m0.4[39m, [33m0.41[39m, [33m0.41[39m, [33m0.41[39m, [33m0.39[39m, [33m0.37[39m,
      ... 25500 more items
    ]
  },
  units: [],
  goblinManager: {},
  camera: {
    position: { x: [33m20[39m, y: [33m20[39m, z: [33m20[39m },
    zoom: [33m1[39m,
    target: { x: [90mundefined[39m, y: [90mundefined[39m, z: [90mundefined[39m }
  },
  requests: []
}
Saved to slot 1 (Compressed). Size: 24424 chars (Original: 310016)

 [32mç¬¨ãƒ»[39m src/tests/SpatialSearch.test.js [2m([22m[2m4 tests[22m[2m)[22m[33m 3791[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should register and retrieve an entity [33m 1287[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should move entity correctly between cells [33m 904[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should unregister entity [33m 753[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should find nearest entity using spatial search [33m 843[2mms[22m[39m
stderr | src/tests/CombatFixes.test.js > Combat and Logic Fixes > should find target goblin
[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false
DEBUG: Heights: 10 10
DEBUG: Distance: 10
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=undefined
[Unit 0] Moving onto Rock at 1,0 H:10 (Speed Penalty)
DEBUG: Target Found: g1
DEBUG: Action: Chasing

 [32mç¬¨ãƒ»[39m src/tests/CombatFixes.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/GoblinStats.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 14[2mms[22m[39m
[90mstdout[2m | src/tests/ForceBuild.test.js[2m > [22m[2mTerrain Force Build Logic[2m > [22m[2mshould clear buildings partially in the way
[22m[39m[Terrain] addBuilding: house at 10,10. Force:false
[Terrain] Building Added: house at (10, 10) Size:2x2. Total: 1
Pre-Barracks Buildings: [ [32m'house'[39m ]
[Terrain] Clearing obstacle: house for new construction.
[Terrain] Building removed at 10,10
[Terrain] addBuilding: barracks at 9,9. Force:false
[Terrain] Building Added: barracks at (9, 9) Size:3x3. Total: 1
Post-Barracks Buildings: [ [32m'barracks'[39m ]

 [32mç¬¨ãƒ»[39m src/tests/ForceBuild.test.js [2m([22m[2m2 tests[22m[2m)[22m[33m 2931[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should clear existing buildings when placing a new one [33m 1546[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should clear buildings partially in the way [33m 1381[2mms[22m[39m
[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39mGame constructor called

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39mLoad Started...

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39mLoading slot 1, Raw length: 100
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1766911498498[39m,
  data: {
    resources: { grain: [33m999[39m, fish: [33m888[39m },
    gameTime: [33m6[39m,
    terrain: { logicalWidth: [33m10[39m, logicalDepth: [33m10[39m, grid: [], buildings: [] },
    units: [],
    camera: { position: [36m[Object][39m, target: [36m[Object][39m }
  }
}
Load Game: Data found {
  resources: { grain: [33m999[39m, fish: [33m888[39m },
  gameTime: [33m6[39m,
  terrain: { logicalWidth: [33m10[39m, logicalDepth: [33m10[39m, grid: [], buildings: [] },
  units: [],
  camera: { position: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m }, target: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m } }
}
Clearing 0 projectiles...

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[DEBUG] Terrain.setSeason: Changing from undefined to Spring
[Game] Restored Camera Zoom: 1

[90mstdout[2m | src/tests/WrapDistance.test.js[2m > [22m[2mUnit Distance Wrap Logic[2m > [22m[2mshould calculate short distance across wrap (0,0 -> 79,0)
[22m[39m[UnitCore.js] Unit Created ID:0 Role:undefined Pos:0,0 Special:false

[90mstdout[2m | src/tests/WrapDistance.test.js[2m > [22m[2mUnit Distance Wrap Logic[2m > [22m[2mshould calculate diagonal wrap correctly (0,0 -> 79,79)
[22m[39m[UnitCore.js] Unit Created ID:1 Role:undefined Pos:0,0 Special:false

 [32mç¬¨ãƒ»[39m src/tests/WrapDistance.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 20[2mms[22m[39m
[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/ShorelineLoop.test.js[2m > [22m[2mShoreline Loop Reproduction[2m > [22m[2mshould NOT target unrelated region goblin via findTargetGoblin
[22m[39m[UnitCore.js] Unit Created ID:0 Role:soldier Pos:5,5 Special:false

[90mstdout[2m | src/tests/ShorelineLoop.test.js[2m > [22m[2mShoreline Loop Reproduction[2m > [22m[2mshould NOT target land goblin when unit is in water (Region 0)
[22m[39m[UnitCore.js] Unit Created ID:1 Role:soldier Pos:5,5 Special:false

 [32mç¬¨ãƒ»[39m src/tests/ShorelineLoop.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

 [32mç¬¨ãƒ»[39m src/tests/Minimal.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 5[2mms[22m[39m
[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

 [2m[90mç«Šãƒ»[39m[22m src/tests/SafeSpawn.test.js [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m
 [32mç¬¨ãƒ»[39m src/tests/SaveLoad.test.js [2m([22m[2m2 tests[22m[2m)[22m[33m 2850[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should save game data correctly [33m 1558[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should load game data correctly [33m 1289[2mms[22m[39m
 [2m[90mç«Šãƒ»[39m[22m src/tests/UnitMigration.test.js [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m
 [32mç¬¨ãƒ»[39m src/tests/Terrain.test.js [2m([22m[2m9 tests[22m[2m)[22m[33m 6437[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should correctly sum housing population excluding farms [33m 1112[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should handle massive population overflow loop correctly [33m 811[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should grow crops using simDeltaTime (Not raw deltaTime) [33m 923[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should preserve overflow when harvesting [33m 954[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should scale farm yield based on moisture [33m 765[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should reduce food consumption at night [33m 527[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should consume normal amount during day [33m 467[2mms[22m[39m
         [33m[2mç¬¨ãƒ»[22m[39m should return different colors for seasons [33m 413[2mms[22m[39m
         [33m[2mç¬¨ãƒ»[22m[39m should keep rock color even if dry (desert override check) [33m 458[2mms[22m[39m

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ Failed Suites 2 ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯

 FAIL  src/tests/SquadMemory.test.js [ src/tests/SquadMemory.test.js ]
Error: Failed to resolve import "../BattleMemory.js" from "src/tests/SquadMemory.test.js". Does the file exist?
  Plugin: vite:import-analysis
  File: C:/Users/mooya/develop/test/src/tests/SquadMemory.test.js:115:36
  118 |          barracks.userData.memory = new (vi.mocked(module).BattleMemory)();
  119 |  
  120 |          terrain.buildings.push(barracks);
      |                 ^
  121 |  
  122 |          const unit = game.spawnUnit(12, 12, 'knight'); // Use spawnUnit to test integration
 ç¬¶ï½¯ TransformPluginContext._formatLog node_modules/vite/dist/node/chunks/config.js:29647:43
 ç¬¶ï½¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/config.js:29644:14
 ç¬¶ï½¯ normalizeUrl node_modules/vite/dist/node/chunks/config.js:27767:18
 ç¬¶ï½¯ node_modules/vite/dist/node/chunks/config.js:27825:32
 ç¬¶ï½¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/config.js:27793:4
 ç¬¶ï½¯ EnvironmentPluginContainer.transform node_modules/vite/dist/node/chunks/config.js:29445:14
 ç¬¶ï½¯ loadAndTransform node_modules/vite/dist/node/chunks/config.js:23316:26

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[1/64]ç«¡ï½¯

 FAIL  src/tests/UnitLifecycle.test.js [ src/tests/UnitLifecycle.test.js ]
Error: Failed to resolve import "../UnitRefactored.js" from "src/tests/UnitLifecycle.test.js". Does the file exist?
  Plugin: vite:import-analysis
  File: C:/Users/mooya/develop/test/src/tests/UnitLifecycle.test.js:2:22
  1  |  import { describe, it, expect, vi, beforeEach, beforeAll } from 'vitest';
  2  |  import { Unit } from '../UnitRefactored.js';
     |                         ^
  3  |  import * as THREE from 'three';
  4  |  
 ç¬¶ï½¯ TransformPluginContext._formatLog node_modules/vite/dist/node/chunks/config.js:29647:43
 ç¬¶ï½¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/config.js:29644:14
 ç¬¶ï½¯ normalizeUrl node_modules/vite/dist/node/chunks/config.js:27767:18
 ç¬¶ï½¯ node_modules/vite/dist/node/chunks/config.js:27825:32
 ç¬¶ï½¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/config.js:27793:4
 ç¬¶ï½¯ EnvironmentPluginContainer.transform node_modules/vite/dist/node/chunks/config.js:29445:14
 ç¬¶ï½¯ loadAndTransform node_modules/vite/dist/node/chunks/config.js:23316:26

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[2/64]ç«¡ï½¯


ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ Failed Tests 62 ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯

 FAIL  src/tests/AdvancedUnits.test.js > Advanced Units > should initialize Wizard with low HP and high stats
AssertionError: expected 135 to be less than 40
 ç¬¶ï½¯ src/tests/AdvancedUnits.test.js:52:27
     50| 
     51|         // Base HP ~30-50. Wizard 0.5x ~15-25.
     52|         expect(wizard.hp).toBeLessThan(40);
       |                           ^
     53|         expect(wizard.damage).toBeGreaterThan(50); // Same as Knight
     54|         expect(wizard.role).toBe('wizard');

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[3/64]ç«¡ï½¯

 FAIL  src/tests/AdvancedUnits.test.js > Advanced Units > should allow Wizard to attack from range
TypeError: window.game.reportGlobalBattle is not a function
 ç¬¶ï½¯ Unit.reportEnemy src/Unit.js:1368:25
    1366|         } else if (window.game) {
    1367|             // If no squad, report directly to Global
    1368|             window.game.reportGlobalBattle(x, z);
       |                         ^
    1369|         }
    1370| 
 ç¬¶ï½¯ Unit.attackGoblin src/Unit.js:418:14
 ç¬¶ï½¯ src/tests/AdvancedUnits.test.js:70:16

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[4/64]ç«¡ï½¯

 FAIL  src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins deal population damage to player buildings
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/BuildingDefense.test.js:47:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[5/64]ç«¡ï½¯

 FAIL  src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins deal structural damage to empty player buildings
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/BuildingDefense.test.js:58:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[6/64]ç«¡ï½¯

 FAIL  src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins destroy player buildings when HP reaches 0
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/BuildingDefense.test.js:69:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[7/64]ç«¡ï½¯

 FAIL  src/tests/BuildingDefense.test.js > Building Defense Logic > Buildings retaliate against melee goblins
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/BuildingDefense.test.js:80:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[8/64]ç«¡ï½¯

 FAIL  src/tests/BuildingDefense.test.js > Building Defense Logic > Towers have massive retaliation
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/BuildingDefense.test.js:92:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[9/64]ç«¡ï½¯

 FAIL  src/tests/BuildingDefense.test.js > Building Defense Logic > No retaliation for distant attackers (Shamans)
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/BuildingDefense.test.js:104:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[10/64]ç«¡ï½¯

 FAIL  src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins can target buildings with 0 population but > 0 structural HP
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/BuildingDefense.test.js:114:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[11/64]ç«¡ï½¯

 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should destroy building immediately when population hits 0
 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should destroy building if already 0
 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should NOT destroy building if population remains > 0
TypeError: colorAttr.setXYZ is not a function
 ç¬¶ï½¯ Terrain.updateColors src/Terrain.js:709:27
    707| 
    708|                 const color = this.getBiomeColor(height, moisture, noiçª¶ï½¦
    709|                 colorAttr.setXYZ(i, color.r, color.g, color.b);
       |                           ^
    710|             }
    711|         }
 ç¬¶ï½¯ Terrain.calculateRegions src/Terrain.js:393:14
 ç¬¶ï½¯ Terrain.generateRandomTerrain src/Terrain.js:337:14
 ç¬¶ï½¯ Terrain.initTerrain src/Terrain.js:284:14
 ç¬¶ï½¯ new Terrain src/Terrain.js:26:14
 ç¬¶ï½¯ src/tests/BuildingDestruction.test.js:75:19

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[12/64]ç«¡ï½¯

 FAIL  src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should update cave Y position when terrain height changes
 FAIL  src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should still destroy cave if submerged (height <= 0)
TypeError: Cannot read properties of undefined (reading 'torsoNormal')
 ç¬¶ï½¯ GoblinRenderer.initInstancedMeshes src/GoblinRenderer.js:55:55
     53|         // So generic box is fine.
     54|         // Let's use assets.geometries.torsoNormal as base.
     55|         this.torsoMesh = createMesh(assets.geometries.torsoNormal, thiçª¶ï½¦
       |                                                       ^
     56| 
     57|         // 2. Head
 ç¬¶ï½¯ new GoblinRenderer src/GoblinRenderer.js:27:14
 ç¬¶ï½¯ new GoblinManager src/GoblinManager.js:16:25
 ç¬¶ï½¯ src/tests/CavePersistence.test.js:55:19

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[13/64]ç«¡ï½¯

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Single Goblin (1v1) - AI Logic Check
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/CombatBalance.test.js:107:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[14/64]ç«¡ï½¯

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Wizard vs Single Goblin (1v1) - Wizard should win
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/CombatBalance.test.js:146:24

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[15/64]ç«¡ï½¯

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Swarm (1v5) - Knight should surviving
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/CombatBalance.test.js:179:23

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[16/64]ç«¡ï½¯

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Load Game Persistence - Should resume movement
TypeError: u1.triggerMove is not a function
 ç¬¶ï½¯ src/tests/CombatBalance.test.js:233:12
    231|         const u1 = new Unit(scene, terrain, 0, 0, 'knight');
    232|         u1.game = global.window.game;
    233|         u1.triggerMove(10, 10, 1000); // Start moving to 10,10 at t=10çª¶ï½¦
       |            ^
    234|         u1.updateLogic(1500, 100, false, [], [], [], []); // Move 0.5s
    235| 

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[17/64]ç«¡ï½¯

 FAIL  src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > Worker releases job when engaging in combat
AssertionError: expected "vi.fn()" to be called with arguments: [ çª¶ï½¦(2) ]

Number of calls: 0

 ç¬¶ï½¯ src/tests/CombatRequestHandoff.test.js:78:41
     76|         unitInstance.updateWorkerLogic(100, 0.1, false, []);
     77| 
     78|         expect(mockGame.releaseRequest).toHaveBeenCalledWith(unitInstaçª¶ï½¦
       |                                         ^
     79|         expect(unitInstance.targetRequest).toBeNull();
     80|     });

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[18/64]ç«¡ï½¯

 FAIL  src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > forceAssignRequest prioritizes nearby busy unit over distant idle unit
TypeError: this.assignRequestSync is not a function
 ç¬¶ï½¯ Object.forceAssignRequest src/Game.js:696:14
    694|     // Legacy method name support (Redirect to Sync but rely on loop mçª¶ï½¦
    695|     forceAssignRequest(req) {
    696|         this.assignRequestSync(req);
       |              ^
    697|     }
    698| 
 ç¬¶ï½¯ src/tests/CombatRequestHandoff.test.js:103:9

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[19/64]ç«¡ï½¯

 FAIL  src/tests/CombatVerification.test.js > Combat Logic Verification > Scenario A: Worker destroys Cave
AssertionError: expected 196 to be less than 196
 ç¬¶ï½¯ src/tests/CombatVerification.test.js:195:34
    193|         const hpBefore = cave.userData.hp;
    194|         worker.attackBuilding(cave);
    195|         expect(cave.userData.hp).toBeLessThan(hpBefore);
       |                                  ^
    196|         console.log(`Cave HP: ${cave.userData.hp}`);
    197|     });

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[20/64]ç«¡ï½¯

 FAIL  src/tests/ForceAssignment.test.js > Force Assignment Integration > should successfully triggerMove without infinite loop
TypeError: worker.triggerMove is not a function
 ç¬¶ï½¯ src/tests/ForceAssignment.test.js:123:16
    121|     it('should successfully triggerMove without infinite loop', () => {
    122|         // Test triggerMove specifically
    123|         worker.triggerMove(15, 15, 100);
       |                ^
    124| 
    125|         expect(worker.isMoving).toBe(true);

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[21/64]ç«¡ï½¯

 FAIL  src/tests/ForceAssignment.test.js > Force Assignment Integration > should handle Force Assignment logic block
TypeError: bestUnit.triggerMove is not a function
 ç¬¶ï½¯ src/tests/ForceAssignment.test.js:155:22
    153| 
    154|             // Critical Move
    155|             bestUnit.triggerMove(req.x, req.z, 200);
       |                      ^
    156|         }
    157| 

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[22/64]ç«¡ï½¯

 FAIL  src/tests/GhostHouse.test.js > Terrain Ghost House Test > should accumulate ghost buildings in entityGrid if not cleared during deserialize
TypeError: () => ({ add: __vite_ssr_import_0__.vi.fn(), remove: __vite_ssr_import_0__.vi.fn() }) is not a constructor
 ç¬¶ï½¯ src/tests/GhostHouse.test.js:31:17
     29|     beforeEach(() => {
     30|         vi.useFakeTimers();
     31|         scene = new THREE.Scene();
       |                 ^
     32|         terrain = new Terrain(scene, []);
     33|         // Manually init entityGrid if needed (Terrain constructor doeçª¶ï½¦

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[23/64]ç«¡ï½¯

 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should damage building population
 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should destroy building when population drops below 1.0
 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should destroy building even if fractional population remains (e.g. 0.5)
 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should NOT destroy building if population remains >= 1.0
 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should take retaliation damage
TypeError: this.scene.getObjectByName is not a function
 ç¬¶ï½¯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 ç¬¶ï½¯ src/tests/GoblinDestruction.test.js:43:18

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[24/64]ç«¡ï½¯

 FAIL  src/tests/GoblinFixes.test.js > Goblin Fixes Verification > Entity.getDistance should handle wrapping
 FAIL  src/tests/GoblinFixes.test.js > Goblin Fixes Verification > Terrain.findBestTarget should find wrapped targets
 FAIL  src/tests/GoblinFixes.test.js > Goblin Fixes Verification > Terrain.findBestTarget should handle non-wrapping case correctly (sanity)
 FAIL  src/tests/GoblinFixes.test.js > Goblin Fixes Verification > GoblinManager difficulty scaling increases stronger goblin probability
TypeError: colorAttr.setXYZ is not a function
 ç¬¶ï½¯ Terrain.updateColors src/Terrain.js:709:27
    707| 
    708|                 const color = this.getBiomeColor(height, moisture, noiçª¶ï½¦
    709|                 colorAttr.setXYZ(i, color.r, color.g, color.b);
       |                           ^
    710|             }
    711|         }
 ç¬¶ï½¯ Terrain.calculateRegions src/Terrain.js:393:14
 ç¬¶ï½¯ Terrain.generateRandomTerrain src/Terrain.js:337:14
 ç¬¶ï½¯ Terrain.initTerrain src/Terrain.js:284:14
 ç¬¶ï½¯ new Terrain src/Terrain.js:26:14
 ç¬¶ï½¯ src/tests/GoblinFixes.test.js:77:19

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[25/64]ç«¡ï½¯

 FAIL  src/tests/GoblinMobilization.test.js > Goblin Mobilization Verification > triggerWave should mobilize idle goblins
 FAIL  src/tests/GoblinMobilization.test.js > Goblin Mobilization Verification > mobilizeClan should rely on getClanRaidTarget fallback
TypeError: colorAttr.setXYZ is not a function
 ç¬¶ï½¯ Terrain.updateColors src/Terrain.js:709:27
    707| 
    708|                 const color = this.getBiomeColor(height, moisture, noiçª¶ï½¦
    709|                 colorAttr.setXYZ(i, color.r, color.g, color.b);
       |                           ^
    710|             }
    711|         }
 ç¬¶ï½¯ Terrain.calculateRegions src/Terrain.js:393:14
 ç¬¶ï½¯ Terrain.generateRandomTerrain src/Terrain.js:337:14
 ç¬¶ï½¯ Terrain.initTerrain src/Terrain.js:284:14
 ç¬¶ï½¯ new Terrain src/Terrain.js:26:14
 ç¬¶ï½¯ src/tests/GoblinMobilization.test.js:79:19

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[26/64]ç«¡ï½¯

 FAIL  src/tests/Hotspot.test.js > Global Battle Hotspots Logic > Mobilizes idle squads to intense hotspots (Updated Threshold)
AssertionError: expected "vi.fn()" to be called with arguments: [ 1, 100, 20 ]

Number of calls: 0

 ç¬¶ï½¯ src/tests/Hotspot.test.js:67:31
     65|         mobFn(0.1);
     66| 
     67|         expect(reportSquadFn).toHaveBeenCalledWith(1, 100, 20);
       |                               ^
     68|     });
     69| 

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[27/64]ç«¡ï½¯

 FAIL  src/tests/ManaSystem.test.js > Mana System > InputManager Integration > should consume mana on raise terrain
AssertionError: expected "vi.fn()" to be called at least once
 ç¬¶ï½¯ src/tests/ManaSystem.test.js:83:39
     81|             inputManager.handleInteraction(event);
     82| 
     83|             expect(mockTerrain.raise).toHaveBeenCalled();
       |                                       ^
     84|             expect(mockGame.consumeMana).toHaveBeenCalledWith(10);
     85|             expect(mockGame.mana).toBe(90);

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[28/64]ç«¡ï½¯

 FAIL  src/tests/MigrationImprovement.test.js > Migration Improvements > should retry migration after 30 seconds timeout
TypeError: this.terrain.getRandomPointInRegion is not a function
 ç¬¶ï½¯ Unit.migrate src/Unit.js:2153:37
    2151| 
    2152|         // 2. Find Point
    2153|         const target = this.terrain.getRandomPointInRegion(regionId, tçª¶ï½¦
       |                                     ^
    2154| 
    2155|         if (target) {
 ç¬¶ï½¯ src/tests/MigrationImprovement.test.js:87:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[29/64]ç«¡ï½¯

 FAIL  src/tests/MigrationImprovement.test.js > Migration Improvements > should interrupt migration if enemy is found (Priority)
TypeError: this.terrain.getRandomPointInRegion is not a function
 ç¬¶ï½¯ Unit.migrate src/Unit.js:2153:37
    2151| 
    2152|         // 2. Find Point
    2153|         const target = this.terrain.getRandomPointInRegion(regionId, tçª¶ï½¦
       |                                     ^
    2154| 
    2155|         if (target) {
 ç¬¶ï½¯ src/tests/MigrationImprovement.test.js:113:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[30/64]ç«¡ï½¯

 FAIL  src/tests/MigrationImprovement.test.js > Migration Improvements > should stop migrating if construction succeeds
TypeError: this.terrain.getRandomPointInRegion is not a function
 ç¬¶ï½¯ Unit.migrate src/Unit.js:2153:37
    2151| 
    2152|         // 2. Find Point
    2153|         const target = this.terrain.getRandomPointInRegion(regionId, tçª¶ï½¦
       |                                     ^
    2154| 
    2155|         if (target) {
 ç¬¶ï½¯ src/tests/MigrationImprovement.test.js:136:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[31/64]ç«¡ï½¯

 FAIL  src/tests/MinimalUnit.test.js > Minimal Unit Sanity > can instantiate Unit
TypeError: Cannot read properties of undefined (reading 'add')
 ç¬¶ï½¯ Terrain.createMesh src/Terrain.js:560:20
    558|         this.mesh.add(dotsMesh);
    559| 
    560|         this.scene.add(this.mesh);
       |                    ^
    561|         this.meshes.push(this.mesh);
    562|     }
 ç¬¶ï½¯ Terrain.initTerrain src/Terrain.js:287:14
 ç¬¶ï½¯ new Terrain src/Terrain.js:26:14
 ç¬¶ï½¯ src/tests/MinimalUnit.test.js:21:25

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[32/64]ç«¡ï½¯

 FAIL  src/tests/NightLogic.test.js > Night Logic - Shelter Entry > Worker should engage pathfinding to House but is likely blocked
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 ç¬¶ï½¯ src/tests/NightLogic.test.js:83:32
     81|         // If it moves instantly due to 0 interval, isMoving might be çª¶ï½¦
     82|         // Just check action is 'Going Home' or target is correct.
     83|         expect(u1.targetGridX).toBe(1);
       |                                ^
     84|         expect(u1.action).toBe('Going Home');
     85| 

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[33/64]ç«¡ï½¯

 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should tag new requests with createdAt timestamp
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cleanup expired pending requests
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should NOT cleanup assigned requests even if old
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cancel request via Proximity Search
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should prioritize nearest request when cancelling
TypeError: this.geometry.setAttribute is not a function
 ç¬¶ï½¯ Terrain.initTerrain src/Terrain.js:264:23
    262| 
    263|         const count = this.geometry.attributes.position.count;
    264|         this.geometry.setAttribute('color', new THREE.BufferAttribute(çª¶ï½¦
       |                       ^
    265| 
    266|         // 1.5. Apply Slight Terrain Distortion (User Request)
 ç¬¶ï½¯ new Terrain src/Terrain.js:26:14
 ç¬¶ï½¯ new Game src/Game.js:139:24
 ç¬¶ï½¯ src/tests/RequestLifecycle.test.js:89:16

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[34/64]ç«¡ï½¯

 FAIL  src/tests/SimpleRegion.test.js > Simple Region Connectivity > should identify a single island
 FAIL  src/tests/SimpleRegion.test.js > Simple Region Connectivity > should split two islands
TypeError: Cannot read properties of undefined (reading 'position')
 ç¬¶ï½¯ Terrain.initTerrain src/Terrain.js:263:48
    261|         // Or keep standard and rotate mesh. Standard is better for utçª¶ï½¦
    262| 
    263|         const count = this.geometry.attributes.position.count;
       |                                                ^
    264|         this.geometry.setAttribute('color', new THREE.BufferAttribute(çª¶ï½¦
    265| 
 ç¬¶ï½¯ new Terrain src/Terrain.js:26:14
 ç¬¶ï½¯ src/tests/SimpleRegion.test.js:23:19

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[35/64]ç«¡ï½¯

 FAIL  src/tests/StuckDebug.test.js > Unit Stuck Debugging > should log reason for blockage
TypeError: Cannot read properties of undefined (reading 'add')
 ç¬¶ï½¯ Terrain.createMesh src/Terrain.js:560:20
    558|         this.mesh.add(dotsMesh);
    559| 
    560|         this.scene.add(this.mesh);
       |                    ^
    561|         this.meshes.push(this.mesh);
    562|     }
 ç¬¶ï½¯ Terrain.initTerrain src/Terrain.js:287:14
 ç¬¶ï½¯ new Terrain src/Terrain.js:26:14
 ç¬¶ï½¯ src/tests/StuckDebug.test.js:8:25

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[36/64]ç«¡ï½¯

 FAIL  src/tests/TargetingPriority.test.js > Unit Targeting Priority > should prioritize Goblin if it is much closer than Building
TypeError: Cannot read properties of undefined (reading '0')
 ç¬¶ï½¯ Unit.updateLogic src/Unit.js:836:60
    834|                         // Strict Region Check (User Request: Stop stiçª¶ï½¦
    835|                         // Only allow targeting different regions if Açª¶ï½¦
    836|                         const myRegion = (this.terrain.grid[this.gridXçª¶ï½¦
       |                                                            ^
    837|                         const gRegion = (this.terrain.grid[g.gridX] &&çª¶ï½¦
    838| 
 ç¬¶ï½¯ src/tests/TargetingPriority.test.js:49:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[37/64]ç«¡ï½¯

 FAIL  src/tests/TargetingPriority.test.js > Unit Targeting Priority > should prioritize Building if distances are similar (Bonus check)
TypeError: Cannot read properties of undefined (reading '0')
 ç¬¶ï½¯ Unit.updateLogic src/Unit.js:836:60
    834|                         // Strict Region Check (User Request: Stop stiçª¶ï½¦
    835|                         // Only allow targeting different regions if Açª¶ï½¦
    836|                         const myRegion = (this.terrain.grid[this.gridXçª¶ï½¦
       |                                                            ^
    837|                         const gRegion = (this.terrain.grid[g.gridX] &&çª¶ï½¦
    838| 
 ç¬¶ï½¯ src/tests/TargetingPriority.test.js:65:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[38/64]ç«¡ï½¯

 FAIL  src/tests/TargetingPriority.test.js > Unit Targeting Priority > should allow Workers to target Huts at range 25 (New Range: 30)
TypeError: window.game.findBestRequest is not a function
 ç¬¶ï½¯ UnitWanderState.update src/ai/states/UnitStates.js:24:37
     22|         if (window.game) {
     23|             // Check for jobs even while moving (e.g. wandering)
     24|             const req = window.game.findBestRequest(this.actor, true);çª¶ï½¦
       |                                     ^
     25|             if (req) {
     26|                 if (window.game.claimRequest(this.actor, req)) {
 ç¬¶ï½¯ Unit.updateLogic src/Unit.js:662:24
 ç¬¶ï½¯ src/tests/TargetingPriority.test.js:78:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[39/64]ç«¡ï½¯

 FAIL  src/tests/UnitBehavior.test.js > Unit Behavior Mode > should return Exploration with coords when targetRaidPoint is set
AssertionError: expected 'Patrolling (10,20)' to be 'Exploration (10,20)' // Object.is equality

Expected: "Exploration (10,20)"
Received: "Patrolling (10,20)"

 ç¬¶ï½¯ src/tests/UnitBehavior.test.js:74:40
     72|     it('should return Exploration with coords when targetRaidPoint is çª¶ï½¦
     73|         unit.targetRaidPoint = { x: 10, z: 20 };
     74|         expect(unit.getBehaviorMode()).toBe('Exploration (10,20)');
       |                                        ^
     75|     });
     76| 

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[40/64]ç«¡ï½¯

 FAIL  src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should wait for moveInterval before first move
AssertionError: expected 2.3645422847920203 to be greater than or equal to 2000
 ç¬¶ï½¯ src/tests/UnitInit.test.js:41:26
     39|         // moveInterval is 2000-5000
     40|         const interval = unit.moveInterval;
     41|         expect(interval).toBeGreaterThanOrEqual(2000);
       |                          ^
     42| 
     43|         // Advance time by 1s (1000ms)

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[41/64]ç«¡ï½¯

 FAIL  src/tests/UnitWrapping.test.js > Unit Movement Wrapping > should move normally for short distances
TypeError: unit.triggerMove is not a function
 ç¬¶ï½¯ src/tests/UnitWrapping.test.js:39:14
     37|         unit.gridX = 10;
     38|         unit.gridZ = 10;
     39|         unit.triggerMove(15, 10, 1000);
       |              ^
     40| 
     41|         expect(unit.targetGridX).toBe(11);

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[42/64]ç«¡ï½¯

 FAIL  src/tests/UnitWrapping.test.js > Unit Movement Wrapping > should wrap LEFT if target is across right boundary
TypeError: unit.triggerMove is not a function
 ç¬¶ï½¯ src/tests/UnitWrapping.test.js:52:14
     50|         unit.gridX = 10;
     51|         unit.gridZ = 10;
     52|         unit.triggerMove(70, 10, 1000);
       |              ^
     53| 
     54|         expect(unit.targetGridX).toBe(9);

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[43/64]ç«¡ï½¯

 FAIL  src/tests/UnitWrapping.test.js > Unit Movement Wrapping > should wrap RIGHT if target is across left boundary
TypeError: unit.triggerMove is not a function
 ç¬¶ï½¯ src/tests/UnitWrapping.test.js:64:14
     62|         unit.gridX = 70;
     63|         unit.gridZ = 10;
     64|         unit.triggerMove(10, 10, 1000);
       |              ^
     65| 
     66|         expect(unit.targetGridX).toBe(71);

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[44/64]ç«¡ï½¯

 FAIL  src/tests/UnitWrapping.test.js > Unit Movement Wrapping > should handle Z axis wrapping
TypeError: unit.triggerMove is not a function
 ç¬¶ï½¯ src/tests/UnitWrapping.test.js:76:14
     74|         unit.gridX = 10;
     75|         unit.gridZ = 10;
     76|         unit.triggerMove(10, 70, 1000);
       |              ^
     77| 
     78|         expect(unit.targetGridX).toBe(10);

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[45/64]ç«¡ï½¯

 FAIL  src/tests/WorkerReachability.test.js > Worker Job Reachability > forceAssignRequest skips unreachable units
TypeError: this.assignRequestSync is not a function
 ç¬¶ï½¯ Object.forceAssignRequest src/Game.js:696:14
    694|     // Legacy method name support (Redirect to Sync but rely on loop mçª¶ï½¦
    695|     forceAssignRequest(req) {
    696|         this.assignRequestSync(req);
       |              ^
    697|     }
    698| 
 ç¬¶ï½¯ src/tests/WorkerReachability.test.js:72:15

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[46/64]ç«¡ï½¯

 FAIL  src/tests/WorkerRequest.test.js > Worker Job Logic (Unit.js) > Unit moves to target request
AssertionError: expected 'Approaching Job' to be 'Working' // Object.is equality

Expected: "Working"
Received: "Approaching Job"

 ç¬¶ï½¯ src/tests/WorkerRequest.test.js:121:29
    119|         // If triggerMove succeeds (sets isMoving), action becomes 'Apçª¶ï½¦
    120|         // Since triggerMove is MOCKED and doesn't set isMoving, actioçª¶ï½¦
    121|         expect(unit.action).toBe('Working');
       |                             ^
    122|         expect(unit.triggerMove).toHaveBeenCalledWith(10, 10, 2000);
    123|     });

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[47/64]ç«¡ï½¯

 FAIL  src/tests/WorkerRequest.test.js > Worker Job Logic (Unit.js) > Unit completes request upon arrival
AssertionError: expected "vi.fn()" to be called with arguments: [ Unit{ id: 'worker_1', çª¶ï½¦(58) }, çª¶ï½¦(1) ]

Number of calls: 0

 ç¬¶ï½¯ src/tests/WorkerRequest.test.js:140:29
    138|         unit.updateLogic(2000, 0.016, false, [], [], []);
    139| 
    140|         expect(spyComplete).toHaveBeenCalledWith(unit, req);
       |                             ^
    141|         expect(unit.targetRequest).toBeNull();
    142|         expect(unit.action).toBe('Idle');

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[48/64]ç«¡ï½¯

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ Unhandled Errors ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ Unhandled Error ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯
Error: Cannot find package 'jsdom' imported from C:\Users\mooya\develop\test\node_modules\vitest\dist\chunks\index.BspFP3mn.js
 ç¬¶ï½¯ Object.getPackageJSONURL node:internal/modules/package_json_reader:314:9
 ç¬¶ï½¯ packageResolve node:internal/modules/esm/resolve:767:81
 ç¬¶ï½¯ moduleResolve node:internal/modules/esm/resolve:853:18
 ç¬¶ï½¯ defaultResolve node:internal/modules/esm/resolve:983:11
 ç¬¶ï½¯ #cachedDefaultResolve node:internal/modules/esm/loader:731:20
 ç¬¶ï½¯ ModuleLoader.resolve node:internal/modules/esm/loader:708:38
 ç¬¶ï½¯ ModuleLoader.getModuleJobForImport node:internal/modules/esm/loader:310:38
 ç¬¶ï½¯ onImport.tracePromise.__proto__ node:internal/modules/esm/loader:664:36
 ç¬¶ï½¯ TracingChannel.tracePromise node:diagnostics_channel:350:14
 ç¬¶ï½¯ ModuleLoader.import node:internal/modules/esm/loader:663:21

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯
Serialized Error: { code: 'ERR_MODULE_NOT_FOUND' }
ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯


[2m Test Files [22m [1m[31m28 failed[39m[22m[2m | [22m[1m[32m19 passed[39m[22m[2m | [22m[33m2 skipped[39m[90m (49)[39m
[2m      Tests [22m [1m[31m62 failed[39m[22m[2m | [22m[1m[32m77 passed[39m[22m[2m | [22m[33m8 skipped[39m[90m (147)[39m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 17:44:47
[2m   Duration [22m 12.69s[2m (transform 5.64s, setup 2.35s, import 11.29s, tests 24.15s, environment 77.31s)[22m

