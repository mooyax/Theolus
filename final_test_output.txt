
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/mooya/develop/test[39m

[90mstdout[2m | src/tests/EncounterCombat.test.js[2m > [22m[2mEncounter Combat Logic[2m > [22m[2mUnit should switch target to nearby Goblin while moving to distant Building
[22m[39m[TestDebug] beforeEach finished. game.scene exists? [33mtrue[39m

[90mstdout[2m | src/tests/EncounterCombat.test.js[2m > [22m[2mEncounter Combat Logic[2m > [22m[2mUnit should switch target to nearby Goblin while moving to distant Building
[22m[39m[Unit] Constructor Start
[Entity] Constructor Start
[Entity] Constructor End
[UnitCore.js] Unit Created ID:0 Role:soldier Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:0 Role:soldier Pos:10,10
[Entity] Constructor Start
[Entity] Constructor End

[90mstdout[2m | src/tests/EncounterCombat.test.js[2m > [22m[2mEncounter Combat Logic[2m > [22m[2mGoblin should switch target to nearby Unit while moving to distant Building
[22m[39m[TestDebug] beforeEach finished. game.scene exists? [33mtrue[39m

[90mstdout[2m | src/tests/EncounterCombat.test.js[2m > [22m[2mEncounter Combat Logic[2m > [22m[2mGoblin should switch target to nearby Unit while moving to distant Building
[22m[39m[Entity] Constructor Start
[Entity] Constructor End
[Unit] Constructor Start
[Entity] Constructor Start
[Entity] Constructor End
[UnitCore.js] Unit Created ID:1 Role:soldier Pos:20,20 Special:false
[UnitCore.js] Unit Created ID:1 Role:soldier Pos:20,20
[GoblinState 3] ENTER CombatState. Target: Building
[G-EC] F:0 Pos:10.1,10.1 Target:null
[G-EC] F:1 Pos:10.3,10.3 Target:null
[G-EC] F:2 Pos:10.4,10.4 Target:null
[G-EC] F:3 Pos:10.6,10.6 Target:null
[G-EC] F:4 Pos:10.7,10.7 Target:null
[G-EC] F:5 Pos:10.8,10.8 Target:null
[G-EC] F:6 Pos:11.0,11.0 Target:null
[G-EC] F:7 Pos:11.1,11.1 Target:null
[G-EC] F:8 Pos:11.3,11.3 Target:null
[G-EC] F:9 Pos:11.4,11.4 Target:null
[G-EC] F:10 Pos:11.6,11.6 Target:null
[G-EC] F:11 Pos:11.7,11.7 Target:null
[G-EC] F:12 Pos:11.8,11.8 Target:null
[G-EC] F:13 Pos:12.0,12.0 Target:null
[G-EC] F:14 Pos:12.1,12.1 Target:null
[G-EC] F:15 Pos:12.3,12.3 Target:null
[G-EC] F:16 Pos:12.4,12.4 Target:null
[G-EC] F:17 Pos:12.5,12.5 Target:null
[G-EC] F:18 Pos:12.7,12.7 Target:null
[G-EC] F:19 Pos:12.8,12.8 Target:null
[G-EC] F:20 Pos:13.0,13.0 Target:null
[G-EC] F:21 Pos:13.1,13.1 Target:null
[G-EC] F:22 Pos:13.3,13.3 Target:null
[G-EC] F:23 Pos:13.4,13.4 Target:null
[G-EC] F:24 Pos:13.5,13.5 Target:null
[G-EC] F:25 Pos:13.7,13.7 Target:null
[G-EC] F:26 Pos:13.8,13.8 Target:null
[G-EC] F:27 Pos:14.0,14.0 Target:null
[G-EC] F:28 Pos:14.1,14.1 Target:null
[G-EC] F:29 Pos:14.2,14.2 Target:null
[G-EC] F:30 Pos:14.4,14.4 Target:null
[G-EC] F:31 Pos:14.5,14.5 Target:null
[G-EC] F:32 Pos:14.7,14.7 Target:null
[G-EC] F:33 Pos:14.8,14.8 Target:null
[G-EC] F:34 Pos:14.9,14.9 Target:null
[G-EC] F:35 Pos:15.1,15.1 Target:null
[G-EC] F:36 Pos:15.2,15.2 Target:null
[G-EC] F:37 Pos:15.4,15.4 Target:null
[G-EC] F:38 Pos:15.5,15.5 Target:null
[G-EC] F:39 Pos:15.7,15.7 Target:null
[G-EC] F:40 Pos:15.8,15.8 Target:null
[G-EC] F:41 Pos:15.9,15.9 Target:null
[G-EC] F:42 Pos:16.1,16.1 Target:null
[G-EC] F:43 Pos:16.2,16.2 Target:null
[G-EC] F:44 Pos:16.4,16.4 Target:null
[G-EC] F:45 Pos:16.5,16.5 Target:null
[GoblinState 3] Encounter! Switching from Building to Nearby Unit 4
[G-EC] F:46 Pos:16.5,16.5 Target:4

[90mstdout[2m | src/tests/EncounterCombat.test.js[2m > [22m[2mEncounter Combat Logic[2m > [22m[2mWorker should reduce scan range (Worker Aggression Fix)
[22m[39m[TestDebug] beforeEach finished. game.scene exists? [33mtrue[39m

[90mstdout[2m | src/tests/EncounterCombat.test.js[2m > [22m[2mEncounter Combat Logic[2m > [22m[2mWorker should reduce scan range (Worker Aggression Fix)
[22m[39m[Unit] Constructor Start
[Entity] Constructor Start
[Entity] Constructor End
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10

 [31mï¾ƒãƒ»[39m src/tests/EncounterCombat.test.js[2m > [22mEncounter Combat Logic[2m > [22mUnit should switch target to nearby Goblin while moving to distant Building[32m 26[2mms[22m[39m
[31m   ç«Šãƒ»this.terrain.findPathAsync is not a function[39m
 [32mç¬¨ãƒ»[39m src/tests/EncounterCombat.test.js[2m > [22mEncounter Combat Logic[2m > [22mGoblin should switch target to nearby Unit while moving to distant Building[32m 3[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/EncounterCombat.test.js[2m > [22mEncounter Combat Logic[2m > [22mWorker should reduce scan range (Worker Aggression Fix)[32m 3[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinEncounter.test.js[2m > [22m[2mGoblin Encounter Logic[2m > [22m[2mGoblin should detect Worker within range and enter CombatState
[22m[39m[Entity] Constructor Start
[Entity] Constructor End
[Unit] Constructor Start
[Entity] Constructor Start
[Entity] Constructor End
[UnitCore.js] Unit Created ID:0 Role:worker Pos:30,20 Special:false
[UnitCore.js] Unit Created ID:0 Role:worker Pos:30,20
[Test Debug] Worker keys: id,scene,terrain,game,frameCount,gridX,gridZ,type,spatialType,position,rotationY,isMoving,moveTimer,moveDuration,moveStartTime,startGridX,startGridZ,targetGridX,targetGridZ,walkAnimTimer,_spatial,path,pathIndex,stuckCount,pathFailCount,lastPathTime,isPathfinding,minDistToTarget,pathStagnation,state,simTime,role,isSpecial,squadId,lastGridX,lastGridZ,stagnationTimer,buildStagnationCount,lastTime,lastGatherTime,limbs,hp,maxHp,attackCooldown,attackRate,damage,targetGoblin,targetRaidPoint,lifespan,age,isDead,isSleeping,ignoredTargets,moveInterval,huntingCooldown,target,targetX,targetZ,action,wanderCount,migrationTarget,patrolTarget,patrolTimer,debugFrame
[GoblinState Debug] ID:100 State:Wander Update. Timer:0.50 dt:0.1000 findTarget:function
[GoblinState Debug] ID:100 Calling scanForTargets...
[Goblin 100] scanForTargets called. State:GoblinWanderState UnitTgt:No Frust:false
[Goblin 100] invoking terrain.findBestTarget (Units)...
[Terrain Debug] findBestTarget CALL. Type:unit At:20.0,20.0 Range:20
[Goblin 100] Found Unit Candidate: 200 Dist:?
[Goblin 100] Simple Choice: 200
[Goblin 100] Target LOCKED: 200 Type:worker State:GoblinWanderState
[GoblinState 100] ENTER CombatState. Target: Unit 200
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0
[Goblin 100] ExecCombat. Tgt:200 State:GoblinCombatState Dist:10.0

 [32mç¬¨ãƒ»[39m src/tests/GoblinEncounter.test.js[2m > [22mGoblin Encounter Logic[2m > [22mGoblin should detect Worker within range and enter CombatState[33m 653[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinEncounter.test.js[2m > [22m[2mGoblin Encounter Logic[2m > [22m[2mGoblin should prioritize Worker if Building is far, or attack Building if close
[22m[39m[Entity] Constructor Start
[Entity] Constructor End
[Unit] Constructor Start
[Entity] Constructor Start
[Entity] Constructor End
[UnitCore.js] Unit Created ID:1 Role:worker Pos:30,20 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:30,20
[Terrain Debug] findBestTarget CALL. Type:unit At:20.0,20.0 Range:20
[Goblin 101] Found Unit Candidate: 201 Dist:?
[Goblin 101] Simple Choice: 201
[Goblin 101] Target LOCKED: 201 Type:worker State:GoblinWanderState
[GoblinState 101] ENTER CombatState. Target: Unit 201

 [32mç¬¨ãƒ»[39m src/tests/GoblinEncounter.test.js[2m > [22mGoblin Encounter Logic[2m > [22mGoblin should prioritize Worker if Building is far, or attack Building if close[33m 665[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (2)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (5)[39m
[2m   Start at [22m 08:37:19
[2m   Duration [22m 2.26s[2m (transform 325ms, setup 90ms, import 447ms, tests 1.35s, environment 878ms)[22m

