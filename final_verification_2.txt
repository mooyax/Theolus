
 RUN  v4.0.15 C:/Users/mooya/develop/test

 笶ｯ src/tests/GhostHouse.test.js (1 test | 1 failed) 36ms
     ﾃ・should accumulate ghost buildings in entityGrid if not cleared during deserialize 35ms
 笶ｯ src/tests/SimpleRegion.test.js (2 tests | 2 failed) 45ms
     ﾃ・should identify a single island 37ms
     ﾃ・should split two islands 6ms
stdout | src/tests/TargetingPriority.test.js > Unit Targeting Priority > should prioritize Goblin if it is much closer than Building
[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false

stdout | src/tests/TargetingPriority.test.js > Unit Targeting Priority > should prioritize Goblin if it is much closer than Building
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=undefined
[ActorDebug] Grid: 0,0 Target: 10,0 Diff: 10,0
[ActorDebug] Next: 1,0
[ActorDebug] Check Move 1,0 -> true

stdout | src/tests/TargetingPriority.test.js > Unit Targeting Priority > should prioritize Building if distances are similar (Bonus check)
[UnitCore.js] Unit Created ID:1 Role:knight Pos:0,0 Special:false

stdout | src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should NOT freeze if started at time 0
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
Debug Unit: Interval = 2.9844876509924374, LastTime = 0, Role = worker 
[ActorDebug] Grid: 10,10 Target: 5,5 Diff: -5,-5
[ActorDebug] Next: 10,9
[ActorDebug] Check Move 10,9 -> true
Debug Unit: MoveRandomly Called ? 1 

stdout | src/tests/TargetingPriority.test.js > Unit Targeting Priority > should prioritize Building if distances are similar (Bonus check)
[ActorDebug] Grid: 0,0 Target: 10,0 Diff: 10,0
[ActorDebug] Next: 1,0
[ActorDebug] Check Move 1,0 -> true

stdout | src/tests/NightLogic.test.js > Night Logic - Shelter Entry > Worker should engage pathfinding to House but is likely blocked
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false

 笶ｯ src/tests/UnitInit.test.js (1 test | 1 failed) 21ms
     ﾃ・should NOT freeze if started at time 0 19ms
stdout | src/tests/TargetingPriority.test.js > Unit Targeting Priority > should allow Workers to target Huts at range 25 (New Range: 30)
[UnitCore.js] Unit Created ID:2 Role:knight Pos:0,0 Special:false

 笶ｯ src/tests/TargetingPriority.test.js (3 tests | 2 failed) 28ms
     笨・should prioritize Goblin if it is much closer than Building 7ms
     ﾃ・should prioritize Building if distances are similar (Bonus check) 15ms
     ﾃ・should allow Workers to target Huts at range 25 (New Range: 30) 3ms
 笶ｯ src/tests/CavePersistence.test.js (2 tests | 2 failed) 27ms
     ﾃ・should update cave Y position when terrain height changes 23ms
     ﾃ・should destroy cave if submerged (height <= 0) 2ms
 笶ｯ src/tests/GoblinDestruction.test.js (5 tests | 5 failed) 27ms
     ﾃ・should damage building population 20ms
     ﾃ・should destroy building when population drops below 1.0 2ms
     ﾃ・should destroy building even if fractional population remains (e.g. 0.5) 1ms
     ﾃ・should NOT destroy building if population remains >= 1.0 1ms
     ﾃ・should take retaliation damage 1ms
stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins deal population damage to player buildings
Goblin 0 attacking house. Pop: 9.00

 笶ｯ src/tests/NightLogic.test.js (1 test | 1 failed) 27ms
     ﾃ・Worker should engage pathfinding to House but is likely blocked 24ms
stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins deal structural damage to empty player buildings
Goblin 1 hitting Empty house. HP: 40

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins destroy player buildings when HP reaches 0
Goblin 2 hitting Empty house. HP: 0
Goblin 2 destroyed house!

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Buildings retaliate against melee goblins
Goblin 3 attacking house. Pop: 9.92

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Towers have massive retaliation
Goblin 4 attacking tower. Pop: 4.92

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > No retaliation for distant attackers (Shamans)
Goblin 5 attacking house. Pop: 9.20

stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Single Goblin (1v1) - AI Logic Check
[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=undefined
[Unit Debug] ATTACKING Goblin 0
Goblin (normal) died. ID:0

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Standard HP logic for Goblin buildings
[UnitCore.js] Unit Created ID:0 Role:knight Pos:20,20 Special:false
Unit 0 attacking cave. HP: 150

 笶ｯ src/tests/StuckDebug.test.js (1 test | 1 failed) 38ms
     ﾃ・should log reason for blockage 36ms
stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Wizard vs Single Goblin (1v1) - Wizard should win
[UnitCore.js] Unit Created ID:1 Role:wizard Pos:0,0 Special:false
[Unit Debug] ATTACKING Goblin 1
Goblin (normal) died. ID:1

 笨・src/tests/BuildingDefense.test.js (8 tests) 26ms
stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Swarm (1v5) - Knight should surviving
[UnitCore.js] Unit Created ID:2 Role:knight Pos:0,0 Special:false
[Unit Debug] ATTACKING Goblin g0
Goblin (normal) died. ID:g0

stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Load Game Persistence - Should resume movement
[UnitCore.js] Unit Created ID:3 Role:knight Pos:0,0 Special:false
[ActorDebug] Grid: 0,0 Target: 10,10 Diff: 10,10
[ActorDebug] Next: 0,1
[Unit 3] Moving onto Rock at 0,1 H:10 (Speed Penalty)
[ActorDebug] Check Move 0,1 -> true

 笶ｯ src/tests/CombatBalance.test.js (4 tests | 4 failed) 50ms
     ﾃ・Knight vs Single Goblin (1v1) - AI Logic Check 39ms
     ﾃ・Wizard vs Single Goblin (1v1) - Wizard should win 3ms
     ﾃ・Knight vs Swarm (1v5) - Knight should surviving 3ms
     ﾃ・Load Game Persistence - Should resume movement 3ms
stderr | src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > forceAssignRequest prioritizes nearby busy unit over distant idle unit
[Game] forceAssignRequest: assignRequestSync not found.

 笶ｯ src/tests/CombatRequestHandoff.test.js (2 tests | 2 failed) 351ms
     ﾃ・Worker releases job when engaging in combat 191ms
     ﾃ・forceAssignRequest prioritizes nearby busy unit over distant idle unit 158ms
stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should tag new requests with createdAt timestamp
Game constructor called

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cleanup expired pending requests
Game constructor called

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should NOT cleanup assigned requests even if old
Game constructor called

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cancel request via Proximity Search
Game constructor called

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should prioritize nearest request when cancelling
Game constructor called

 笶ｯ src/tests/RequestLifecycle.test.js (5 tests | 5 failed) 29ms
     ﾃ・should tag new requests with createdAt timestamp 23ms
     ﾃ・should cleanup expired pending requests 2ms
     ﾃ・should NOT cleanup assigned requests even if old 1ms
     ﾃ・should cancel request via Proximity Search 1ms
     ﾃ・should prioritize nearest request when cancelling 1ms
 笶ｯ src/tests/BuildingDestruction.test.js (3 tests | 3 failed) 202ms
     ﾃ・should destroy building immediately when population hits 0 103ms
     ﾃ・should destroy building if already 0 54ms
     ﾃ・should NOT destroy building if population remains > 0 42ms

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ Failed Tests 29 竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ

 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should destroy building immediately when population hits 0
 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should destroy building if already 0
 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should NOT destroy building if population remains > 0
TypeError: this.scene.getObjectByName is not a function
 笶ｯ new Goblin src/Goblin.js:73:39
     71| 
     72|         // Ensure mesh group exists
     73|         if (this.scene && !this.scene.getObjectByName('GoblinGroup')) {
       |                                       ^
     74|             // managed by GoblinRenderer usually
     75|         }
 笶ｯ src/tests/BuildingDestruction.test.js:93:18

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[1/29]竡ｯ

 FAIL  src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should update cave Y position when terrain height changes
 FAIL  src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should destroy cave if submerged (height <= 0)
Error: [vitest] No "Sphere" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

vi.mock(import("three"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

 笶ｯ new GoblinRenderer src/GoblinRenderer.js:22:41
     20|         this._dummy = new THREE.Object3D();
     21|         this._scratchVector = new THREE.Vector3();
     22|         this._scratchSphere = new THREE.Sphere(new THREE.Vector3(), 2.窶ｦ
       |                                         ^
     23| 
     24|         this.meshGroup = new THREE.Group();
 笶ｯ new GoblinManager src/GoblinManager.js:16:25
 笶ｯ src/tests/CavePersistence.test.js:110:19

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[2/29]竡ｯ

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Single Goblin (1v1) - AI Logic Check
AssertionError: AI CRASH: window.game.reportGlobalBattle is not a function 
 TypeError: window.game.reportGlobalBattle is not a function
    at Unit.reportEnemy (C:/Users/mooya/develop/test/src/Unit.js:1369:25)
    at Unit.attackGoblin (C:/Users/mooya/develop/test/src/Unit.js:418:14)
    at Unit.updateLogic (C:/Users/mooya/develop/test/src/Unit.js:962:22)
    at C:/Users/mooya/develop/test/src/tests/CombatBalance.test.js:132:24
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1650:37
 笶ｯ Unit.reportEnemy src/Unit.js:1369:25
    1367|         } else if (window.game) {
    1368|             // If no squad, report directly to Global
    1369|             window.game.reportGlobalBattle(x, z);
       |                         ^
    1370|         }
    1371| 
 笶ｯ Unit.attackGoblin src/Unit.js:418:14
 笶ｯ Unit.updateLogic src/Unit.js:962:22
 笶ｯ src/tests/CombatBalance.test.js:132:24
 笶ｯ src/tests/CombatBalance.test.js:145:20

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[3/29]竡ｯ

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Wizard vs Single Goblin (1v1) - Wizard should win
AssertionError: Wiz CRASH: window.game.reportGlobalBattle is not a function
 笶ｯ src/tests/CombatBalance.test.js:180:30
    178|                 time += dt;
    179|             }
    180|         } catch (e) { expect.fail(`Wiz CRASH: ${e.message}`); }
       |                              ^
    181| 
    182|         expect(goblin.isDead).toBe(true);

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[4/29]竡ｯ

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Swarm (1v5) - Knight should surviving
AssertionError: Swarm CRASH: window.game.reportGlobalBattle is not a function 
 TypeError: window.game.reportGlobalBattle is not a function
    at Unit.reportEnemy (C:/Users/mooya/develop/test/src/Unit.js:1369:25)
    at Unit.attackGoblin (C:/Users/mooya/develop/test/src/Unit.js:418:14)
    at C:/Users/mooya/develop/test/src/tests/CombatBalance.test.js:210:32
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1206:10)
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1650:37
    at Traces.$ (file:///C:/Users/mooya/develop/test/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
 笶ｯ Unit.reportEnemy src/Unit.js:1369:25
    1367|         } else if (window.game) {
    1368|             // If no squad, report directly to Global
    1369|             window.game.reportGlobalBattle(x, z);
       |                         ^
    1370|         }
    1371| 
 笶ｯ Unit.attackGoblin src/Unit.js:418:14
 笶ｯ src/tests/CombatBalance.test.js:210:32
 笶ｯ src/tests/CombatBalance.test.js:228:20

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[5/29]竡ｯ

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Load Game Persistence - Should resume movement
TypeError: this.terrain.getRegion is not a function
 笶ｯ Unit.moveRandomly src/Unit.js:2065:44
    2063| 
    2064|         // 1. Get Current Region
    2065|         const currentRegion = this.terrain.getRegion(this.gridX, this.窶ｦ
       |                                            ^
    2066| 
    2067|         // 2. Determine Patrol Radius (Larger for Knights)
 笶ｯ Unit.updateLogic src/Unit.js:1166:18
 笶ｯ src/tests/CombatBalance.test.js:247:12

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[6/29]竡ｯ

 FAIL  src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > Worker releases job when engaging in combat
AssertionError: expected "vi.fn()" to be called at least once
 笶ｯ src/tests/CombatRequestHandoff.test.js:84:41
     82|         // Job release occurs in JobState.update (Night/Defense) OR Un窶ｦ
     83| 
     84|         expect(mockGame.releaseRequest).toHaveBeenCalled();
       |                                         ^
     85|         expect(unitInstance.targetRequest).toBeNull();
     86|     });

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[7/29]竡ｯ

 FAIL  src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > forceAssignRequest prioritizes nearby busy unit over distant idle unit
AssertionError: expected "vi.fn()" to be called at least once
 笶ｯ src/tests/CombatRequestHandoff.test.js:112:39
    110|         vi.runAllTimers();
    111| 
    112|         expect(mockGame.claimRequest).toHaveBeenCalled();
       |                                       ^
    113|         // Check if Unit 1 was the one claimed (mockGame.claimRequest 窶ｦ
    114|         const calls = mockGame.claimRequest.mock.calls;

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[8/29]竡ｯ

 FAIL  src/tests/GhostHouse.test.js > Terrain Ghost House Test > should accumulate ghost buildings in entityGrid if not cleared during deserialize
Error: [vitest] No "PlaneGeometry" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

vi.mock(import("three"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

 笶ｯ Terrain.initTerrain src/Terrain.js:259:35
    257|         // We want the "Center" 40x40 to be at World 0,0.
    258|         // PlaneGeometry is centered.
    259|         this.geometry = new THREE.PlaneGeometry(this.width, this.depth窶ｦ
       |                                   ^
    260|         // Rotate to XZ plane immediately to simplify logic? 
    261|         // Or keep standard and rotate mesh. Standard is better for ut窶ｦ
 笶ｯ new Terrain src/Terrain.js:26:14
 笶ｯ src/tests/GhostHouse.test.js:45:19

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[9/29]竡ｯ

 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should damage building population
TypeError: window.game.reportGlobalBattle is not a function
 笶ｯ Goblin.attackBuilding src/Goblin.js:896:29
    894|             // 0. Report Attack to Global Hotspots (Help needed!)
    895|             if (window.game) {
    896|                 window.game.reportGlobalBattle(building.userData.gridX窶ｦ
       |                             ^
    897|             }
    898| 
 笶ｯ src/tests/GoblinDestruction.test.js:59:16

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[10/29]竡ｯ

 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should destroy building when population drops below 1.0
TypeError: window.game.reportGlobalBattle is not a function
 笶ｯ Goblin.attackBuilding src/Goblin.js:896:29
    894|             // 0. Report Attack to Global Hotspots (Help needed!)
    895|             if (window.game) {
    896|                 window.game.reportGlobalBattle(building.userData.gridX窶ｦ
       |                             ^
    897|             }
    898| 
 笶ｯ src/tests/GoblinDestruction.test.js:66:16

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[11/29]竡ｯ

 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should destroy building even if fractional population remains (e.g. 0.5)
TypeError: window.game.reportGlobalBattle is not a function
 笶ｯ Goblin.attackBuilding src/Goblin.js:896:29
    894|             // 0. Report Attack to Global Hotspots (Help needed!)
    895|             if (window.game) {
    896|                 window.game.reportGlobalBattle(building.userData.gridX窶ｦ
       |                             ^
    897|             }
    898| 
 笶ｯ src/tests/GoblinDestruction.test.js:76:16

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[12/29]竡ｯ

 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should NOT destroy building if population remains >= 1.0
TypeError: window.game.reportGlobalBattle is not a function
 笶ｯ Goblin.attackBuilding src/Goblin.js:896:29
    894|             // 0. Report Attack to Global Hotspots (Help needed!)
    895|             if (window.game) {
    896|                 window.game.reportGlobalBattle(building.userData.gridX窶ｦ
       |                             ^
    897|             }
    898| 
 笶ｯ src/tests/GoblinDestruction.test.js:85:16

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[13/29]竡ｯ

 FAIL  src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should take retaliation damage
TypeError: window.game.reportGlobalBattle is not a function
 笶ｯ Goblin.attackBuilding src/Goblin.js:896:29
    894|             // 0. Report Attack to Global Hotspots (Help needed!)
    895|             if (window.game) {
    896|                 window.game.reportGlobalBattle(building.userData.gridX窶ｦ
       |                             ^
    897|             }
    898| 
 笶ｯ src/tests/GoblinDestruction.test.js:95:16

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[14/29]竡ｯ

 FAIL  src/tests/NightLogic.test.js > Night Logic - Shelter Entry > Worker should engage pathfinding to House but is likely blocked
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 笶ｯ src/tests/NightLogic.test.js:83:32
     81|         // If it moves instantly due to 0 interval, isMoving might be 窶ｦ
     82|         // Just check action is 'Going Home' or target is correct.
     83|         expect(u1.targetGridX).toBe(1);
       |                                ^
     84|         expect(u1.action).toBe('Going Home');
     85| 

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[15/29]竡ｯ

 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should tag new requests with createdAt timestamp
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cleanup expired pending requests
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should NOT cleanup assigned requests even if old
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cancel request via Proximity Search
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should prioritize nearest request when cancelling
TypeError: Cannot read properties of undefined (reading 'isVector3')
 笶ｯ OrthographicCamera.lookAt node_modules/three/build/three.core.js:13900:10
 笶ｯ new Game src/Game.js:98:21
     96|         this.camera = new THREE.OrthographicCamera(-d * aspect, d * as窶ｦ
     97|         this.camera.position.set(20, 20, 20); // Isometric
     98|         this.camera.lookAt(this.scene.position);
       |                     ^
     99| 
    100|         // 2. Setup Renderer
 笶ｯ src/tests/RequestLifecycle.test.js:113:16

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[16/29]竡ｯ

 FAIL  src/tests/SimpleRegion.test.js > Simple Region Connectivity > should identify a single island
 FAIL  src/tests/SimpleRegion.test.js > Simple Region Connectivity > should split two islands
TypeError: posAttr.getX is not a function
 笶ｯ Terrain.initTerrain src/Terrain.js:270:31
    268|         const posAttr = this.geometry.attributes.position;
    269|         for (let i = 0; i < count; i++) {
    270|             const x = posAttr.getX(i);
       |                               ^
    271|             const y = posAttr.getY(i);
    272| 
 笶ｯ new Terrain src/Terrain.js:26:14
 笶ｯ src/tests/SimpleRegion.test.js:54:19

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[17/29]竡ｯ

 FAIL  src/tests/StuckDebug.test.js > Unit Stuck Debugging > should log reason for blockage
TypeError: posAttr.getX is not a function
 笶ｯ Terrain.initTerrain src/Terrain.js:270:31
    268|         const posAttr = this.geometry.attributes.position;
    269|         for (let i = 0; i < count; i++) {
    270|             const x = posAttr.getX(i);
       |                               ^
    271|             const y = posAttr.getY(i);
    272| 
 笶ｯ new Terrain src/Terrain.js:26:14
 笶ｯ src/tests/StuckDebug.test.js:56:25

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[18/29]竡ｯ

 FAIL  src/tests/TargetingPriority.test.js > Unit Targeting Priority > should prioritize Building if distances are similar (Bonus check)
AssertionError: expected null to be { userData: { 窶ｦ(4) }, gridX: 12, 窶ｦ(1) } // Object.is equality

- Expected: 
{
  "gridX": 12,
  "gridZ": 0,
  "userData": {
    "gridX": 12,
    "gridZ": 0,
    "hp": 100,
    "type": "goblin_hut",
  },
}

+ Received: 
null

 笶ｯ src/tests/TargetingPriority.test.js:96:37
     94| 
     95|         // AI logic: If Building distance < 15, PRIORITIZE it over Uni窶ｦ
     96|         expect(unit.targetBuilding).toBe(hut);
       |                                     ^
     97|         expect(unit.targetGoblin).toBeNull();
     98|     });

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[19/29]竡ｯ

 FAIL  src/tests/TargetingPriority.test.js > Unit Targeting Priority > should allow Workers to target Huts at range 25 (New Range: 30)
AssertionError: expected undefined to be { userData: { 窶ｦ(4) }, gridX: 25, 窶ｦ(1) } // Object.is equality

- Expected: 
{
  "gridX": 25,
  "gridZ": 0,
  "userData": {
    "gridX": 25,
    "gridZ": 0,
    "hp": 100,
    "type": "goblin_hut",
  },
}

+ Received: 
undefined

 笶ｯ src/tests/TargetingPriority.test.js:112:37
    110|         unit.updateLogic(1000, 0.1, false, [], [], []);
    111| 
    112|         expect(unit.targetBuilding).toBe(hut);
       |                                     ^
    113|     });
    114| });

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[20/29]竡ｯ

 FAIL  src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should NOT freeze if started at time 0
AssertionError: expected +0 to be 6 // Object.is equality

- Expected
+ Received

- 6
+ 0

 笶ｯ src/tests/UnitInit.test.js:52:31
     50|         expect(unit.moveRandomly).toHaveBeenCalled();
     51|         // lastTime should be updated (to seconds)
     52|         expect(unit.lastTime).toBe(6);
       |                               ^
     53|     });
     54| 

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[21/29]竡ｯ


 Test Files  12 failed | 1 passed (13)
      Tests  29 failed | 9 passed (38)
   Start at  20:35:00
   Duration  1.67s (transform 2.66s, setup 558ms, import 3.82s, tests 907ms, environment 9.97s)

