
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/mooya/develop/test[39m

[90mstdout[2m | src/tests/NightLoadJob.test.js[2m > [22m[2mNight Loading Job Assignment[2m > [22m[2mshould correctly resume manual job when loaded at night
[22m[39mCreating Terrain...
Terrain created: [33mtrue[39m
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 16,74. Force:false
[Terrain] Building Added: cave at (16, 74) Size:1x1. Total: 1
GoblinManager: Cave registered at 16,74 
[GoblinManager] Clan clan_cave_16_74 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 30,112. Force:false
[Terrain] Building Added: cave at (30, 112) Size:1x1. Total: 2
GoblinManager: Cave registered at 30,112 
[GoblinManager] Clan clan_cave_30_112 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 50,127. Force:false
[Terrain] Building Added: cave at (50, 127) Size:1x1. Total: 3
GoblinManager: Cave registered at 50,127 
[GoblinManager] Clan clan_cave_50_127 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 22,99. Force:false
[Terrain] Building Added: cave at (22, 99) Size:1x1. Total: 4
GoblinManager: Cave registered at 22,99 
[GoblinManager] Clan clan_cave_22_99 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 5,44. Force:false
[Terrain] Building Added: cave at (5, 44) Size:1x1. Total: 5
GoblinManager: Cave registered at 5,44 
[GoblinManager] Clan clan_cave_5_44 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 7 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

[90mstdout[2m | src/tests/NightLoadJob.test.js[2m > [22m[2mNight Loading Job Assignment[2m > [22m[2mshould correctly resume manual job when loaded at night
[22m[39m[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[Game] Request Added: raise at (15,15) ID:req_0
[Game] forceAssignRequest FOUND Unit 0 (DistSq:50). Scanned:1
[JobState] Entered. Target: raise. ResumeCtx: Approaching Job
[Game] Request req_0 assigned/switched to Unit 0
[Game] saveGame: Starting serialization...
[Terrain] serialize: Starting...
[Terrain] serialize: Grid Size 160x160
[Terrain] serialize: Grid processed. Processing buildings...
[Terrain] serialize: Done.
[Game] saveGame: CRASHED! TypeError: Cannot read properties of undefined (reading 'target')
    at Game.saveGame (C:/Users/mooya/develop/test/src/Game.js:1637:48)
    at C:/Users/mooya/develop/test/src/tests/NightLoadJob.test.js:191:34
    at [90mfile:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///C:/Users/mooya/develop/test/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///C:/Users/mooya/develop/test/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m

[90mstdout[2m | src/tests/NightLoadJob.test.js[2m > [22m[2mNight Loading Job Assignment[2m > [22m[2mshould wake up unit if they were saved while sleeping but had a job assigned (manual)
[22m[39mCreating Terrain...
Terrain created: [33mtrue[39m
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 91,4. Force:false
[Terrain] Building Added: cave at (91, 4) Size:1x1. Total: 1
GoblinManager: Cave registered at 91,4 
[GoblinManager] Clan clan_cave_91_4 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 79,41. Force:false
[Terrain] Building Added: cave at (79, 41) Size:1x1. Total: 2
GoblinManager: Cave registered at 79,41 
[GoblinManager] Clan clan_cave_79_41 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 32,120. Force:false
[Terrain] Building Added: cave at (32, 120) Size:1x1. Total: 3
GoblinManager: Cave registered at 32,120 
[GoblinManager] Clan clan_cave_32_120 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 137,159. Force:false
[Terrain] Building Added: cave at (137, 159) Size:1x1. Total: 4
GoblinManager: Cave registered at 137,159 
[GoblinManager] Clan clan_cave_137_159 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 130,72. Force:false
[Terrain] Building Added: cave at (130, 72) Size:1x1. Total: 5
GoblinManager: Cave registered at 130,72 
[GoblinManager] Clan clan_cave_130_72 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 16 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

 [31mï¾ƒãƒ»[39m src/tests/NightLoadJob.test.js[2m > [22mNight Loading Job Assignment[2m > [22mshould correctly resume manual job when loaded at night[33m 496[2mms[22m[39m
[31m   ç«Šãƒ»expected false to be true // Object.is equality[39m
[90mstdout[2m | src/tests/NightLoadJob.test.js[2m > [22m[2mNight Loading Job Assignment[2m > [22m[2mshould wake up unit if they were saved while sleeping but had a job assigned (manual)
[22m[39m[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10
[SleepState] Entering Sleep logic.
[Defense Debug 0] shouldScan:true isBusy:false force:false PassedGoblins:None
[Game] Request Added: raise at (15,15) ID:req_0
[Game] forceAssignRequest FOUND Unit 0 (DistSq:50). Scanned:1
[JobState] Entered. Target: raise. ResumeCtx: Approaching Job
[Game] Request req_0 assigned/switched to Unit 0
[Game] saveGame: Starting serialization...
[Terrain] serialize: Starting...
[Terrain] serialize: Grid Size 160x160
[Terrain] serialize: Grid processed. Processing buildings...
[Terrain] serialize: Done.
[Game] saveGame: CRASHED! TypeError: Cannot read properties of undefined (reading 'target')
    at Game.saveGame (C:/Users/mooya/develop/test/src/Game.js:1637:48)
    at C:/Users/mooya/develop/test/src/tests/NightLoadJob.test.js:240:14
    at [90mfile:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m
    at [90mfile:///C:/Users/mooya/develop/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1650:37
    at Traces.$ [90m(file:///C:/Users/mooya/develop/test/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///C:/Users/mooya/develop/test/[39mnode_modules/[4mvitest[24m/dist/chunks/test.BT8LKgU9.js:239:21[90m)[39m
Creating Terrain...
Terrain created: [33mtrue[39m
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 89,102. Force:false
[Terrain] Building Added: cave at (89, 102) Size:1x1. Total: 1
GoblinManager: Cave registered at 89,102 
[GoblinManager] Clan clan_cave_89_102 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 17,16. Force:false
[Terrain] Building Added: cave at (17, 16) Size:1x1. Total: 2
GoblinManager: Cave registered at 17,16 
[GoblinManager] Clan clan_cave_17_16 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 27,48. Force:false
[Terrain] Building Added: cave at (27, 48) Size:1x1. Total: 3
GoblinManager: Cave registered at 27,48 
[GoblinManager] Clan clan_cave_27_48 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 79,129. Force:false
[Terrain] Building Added: cave at (79, 129) Size:1x1. Total: 4
GoblinManager: Cave registered at 79,129 
[GoblinManager] Clan clan_cave_79_129 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 143,4. Force:false
[Terrain] Building Added: cave at (143, 4) Size:1x1. Total: 5
GoblinManager: Cave registered at 143,4 
[GoblinManager] Clan clan_cave_143_4 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 7 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material
Load Started...

 [31mï¾ƒãƒ»[39m src/tests/NightLoadJob.test.js[2m > [22mNight Loading Job Assignment[2m > [22mshould wake up unit if they were saved while sleeping but had a job assigned (manual)[33m 606[2mms[22m[39m
[31m   ç«Šãƒ»Cannot read properties of undefined (reading 'state')[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[90m (2)[39m
[2m   Start at [22m 10:52:39
[2m   Duration [22m 2.40s[2m (transform 382ms, setup 42ms, import 528ms, tests 1.10s, environment 483ms)[22m

