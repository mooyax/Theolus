
 RUN  v4.0.15 C:/Users/mooya/develop/test

 笶ｯ src/tests/GhostHouse.test.js (1 test | 1 failed) 120ms
     ﾃ・should accumulate ghost buildings in entityGrid if not cleared during deserialize 118ms
stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should retry migration after 30 seconds timeout
[UnitCore.js] Unit Created ID:0 Role:worker Pos:50,50 Special:false

stdout | src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should NOT freeze if started at time 0
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
Debug Unit: Interval = 2.7123379716172478, LastTime = 0, Role = worker 
[ActorDebug] Grid: 10,10 Target: 5,5 Diff: -5,-5
[ActorDebug] Next: 10,9
[ActorDebug] Check Move 10,9 -> true
Debug Unit: MoveRandomly Called ? 1 

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should retry migration after 30 seconds timeout
Unit test-migrant migrating to 50,50 (Region undefined)
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should interrupt migration if enemy is found (Priority)
[UnitCore.js] Unit Created ID:1 Role:worker Pos:50,50 Special:false

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should interrupt migration if enemy is found (Priority)
Unit test-migrant migrating to 50,50 (Region undefined)
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true

stderr | src/tests/MigrationImprovement.test.js > Migration Improvements > should interrupt migration if enemy is found (Priority)
[Unit] Long-term Stuck (>20s). Forcing Reset. ID:test-migrant Pos:50,50

stdout | src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should destroy cave if submerged (height <= 0)
[GoblinManager] Cave destroyed: SUBMERGED(H = -1)
[GoblinRenderer] Updating 0 goblins.

 笶ｯ src/tests/UnitInit.test.js (1 test | 1 failed) 20ms
     ﾃ・should NOT freeze if started at time 0 18ms
stderr | src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should destroy cave if submerged (height <= 0)
[GoblinManager] Removing invalid cave at 10,10

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should stop migrating if construction succeeds
[UnitCore.js] Unit Created ID:2 Role:worker Pos:50,50 Special:false

stdout | src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > Worker releases job when engaging in combat
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
Run Logic...
[JobState] Entered. Target: undefined. Resume: UnitWanderState
Simulate Attacked...

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should stop migrating if construction succeeds
Unit test-migrant migrating to 50,50 (Region undefined)
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true
Unit test-migrant built structure during migration. Stopping.

stdout | src/tests/CombatVerification.test.js > Combat Logic Verification > Scenario A: Worker destroys Cave
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[MockTerrain] Searching 1 buildings. Range:25 Center:10,10
  - Checking Building at 12,10. Dist:2
    -> Score: 2
Unit 1 found Base via Spatial Search!
Approach Point: 11,10
Unit 1 attacking cave. HP: 196
Cave HP: 196 (Was: 200)

 笶ｯ src/tests/CavePersistence.test.js (2 tests | 1 failed) 33ms
     ﾃ・should update cave Y position when terrain height changes 17ms
     笨・should destroy cave if submerged (height <= 0) 7ms
stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > DEBUG: should log blockage reasons correctly
[UnitCore.js] Unit Created ID:3 Role:worker Pos:50,50 Special:false

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > DEBUG: should log blockage reasons correctly
--- DEBUG: Testing Slope Block ---
[Unit test-migrant] Blocked by Slope at 21,20 H:2->6
--- DEBUG: Testing Water Block ---
--- DEBUG: Testing Building Pass ---

 笶ｯ src/tests/MigrationImprovement.test.js (4 tests | 1 failed) 30ms
     笨・should retry migration after 30 seconds timeout 8ms
     ﾃ・should interrupt migration if enemy is found (Priority) 18ms
     笨・should stop migrating if construction succeeds 2ms
     笨・DEBUG: should log blockage reasons correctly 1ms
stdout | src/tests/CombatVerification.test.js > Combat Logic Verification > Scenario B: Goblin destroys House
Goblin 0 SPAWNED FOR RAIDING! Target: NaN,NaN
[Goblin 0] ENTER RaidState. Goal: NaN,NaN
[MockTerrain] Searching 1 buildings. Range:25 Center:20,20
  - Checking Building at 22,20. Dist:2
    -> Score: 2
[ActorDebug] Grid: 20,20 Target: 21,20 Diff: 1,0
[ActorDebug] Next: 21,20
[ActorDebug] Check Move 21,20 -> true
Goblin 0 attacking house. Pop: 1.92
Goblin 0 attacking house. Pop: 1.84
House Pop: 1.8399999999999999

stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Single Goblin (1v1) - AI Logic Check
[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=undefined
[Unit Debug] ATTACKING Goblin 0
Goblin (normal) died. ID:0
[AI CHECK] KnightAction: Idle GoblinHP: -62

stdout | src/tests/CombatVerification.test.js > Combat Logic Verification > Scenario C: Goblin finds and destroys House
[MockTerrain] Searching 1 buildings. Range:12 Center:8,8
  - Checking Building at 10,10. Dist:2.8284271247461903
    -> Score: 2.8284271247461903
[ActorDebug] Grid: 9,9 Target: 9,9 Diff: 0,0
[ActorDebug] Next: 9,9
[ActorDebug] Check Move 9,9 -> true
Goblin 1 hitting Empty house. HP: 92
[ActorDebug] Grid: 10,9 Target: 10,9 Diff: 0,0
[ActorDebug] Next: 10,9
[ActorDebug] Check Move 10,9 -> true
Goblin 1 hitting Empty house. HP: 84
[Test] House HP reduced to 84

stdout | src/tests/NightLogic.test.js > Night Logic - Shelter Entry > Worker should engage pathfinding to House but is likely blocked
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false

stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Wizard vs Single Goblin (1v1) - Wizard should win
[UnitCore.js] Unit Created ID:1 Role:wizard Pos:0,0 Special:false
[Unit Debug] ATTACKING Goblin 1
Goblin (normal) died. ID:1

 笨・src/tests/CombatVerification.test.js (3 tests) 19ms
stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Swarm (1v5) - Knight should surviving
[UnitCore.js] Unit Created ID:2 Role:knight Pos:0,0 Special:false
[Unit Debug] ATTACKING Goblin g0
Goblin (normal) died. ID:g0
[Unit Debug] ATTACKING Goblin g1
Goblin (normal) died. ID:g1
[Unit Debug] ATTACKING Goblin g2
Goblin (normal) died. ID:g2
[Unit Debug] ATTACKING Goblin g3
Goblin (normal) died. ID:g3
[Unit Debug] ATTACKING Goblin g4
Goblin (normal) died. ID:g4

stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Load Game Persistence - Should resume movement
[UnitCore.js] Unit Created ID:3 Role:knight Pos:0,0 Special:false
[ActorDebug] Grid: 0,0 Target: 10,10 Diff: 10,10
[ActorDebug] Next: 0,1
[Unit 3] Moving onto Rock at 0,1 H:10 (Speed Penalty)
[ActorDebug] Check Move 0,1 -> true
[ActorDebug] Grid: 0,0 Target: 0,0 Diff: 0,0
[ActorDebug] Next: 0,0
[Unit 3] Moving onto Rock at 0,0 H:10 (Speed Penalty)
[ActorDebug] Check Move 0,0 -> true
Unit 3 migrating to 0,0 (Region undefined)
[ActorDebug] Grid: 0,0 Target: 0,0 Diff: 0,0
[ActorDebug] Next: 0,0
[Unit 3] Moving onto Rock at 0,0 H:10 (Speed Penalty)
[ActorDebug] Check Move 0,0 -> true
[UnitCore.js] Unit Created ID:4 Role:knight Pos:0,0 Special:false

 笶ｯ src/tests/NightLogic.test.js (1 test | 1 failed) 21ms
     ﾃ・Worker should engage pathfinding to House but is likely blocked 19ms
 笶ｯ src/tests/CombatBalance.test.js (4 tests | 1 failed) 32ms
     笨・Knight vs Single Goblin (1v1) - AI Logic Check 9ms
     笨・Wizard vs Single Goblin (1v1) - Wizard should win 3ms
     笨・Knight vs Swarm (1v5) - Knight should surviving 4ms
     ﾃ・Load Game Persistence - Should resume movement 14ms
 笶ｯ src/tests/SimpleRegion.test.js (2 tests | 2 failed) 182ms
     ﾃ・should identify a single island 104ms
     ﾃ・should split two islands 76ms
stdout | src/tests/BuildingDestruction.test.js > Building Destruction Logic > should destroy building immediately when population hits 0
Goblin 0 attacking house. Pop: 9.92

 笶ｯ src/tests/StuckDebug.test.js (1 test | 1 failed) 115ms
     ﾃ・should log reason for blockage 109ms
stdout | src/tests/BuildingDestruction.test.js > Building Destruction Logic > should destroy building if already 0
Goblin 1 hitting Empty house. HP: 42

stderr | src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > forceAssignRequest prioritizes nearby busy unit over distant idle unit
[Game] forceAssignRequest: assignRequestSync not found.

 笶ｯ src/tests/CombatRequestHandoff.test.js (2 tests | 2 failed) 478ms
     ﾃ・Worker releases job when engaging in combat 301ms
     ﾃ・forceAssignRequest prioritizes nearby busy unit over distant idle unit 175ms
stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should tag new requests with createdAt timestamp
Game constructor called

stdout | src/tests/BuildingDestruction.test.js > Building Destruction Logic > should NOT destroy building if population remains > 0
Goblin 2 attacking house. Pop: 49.92
Goblin (normal) died. ID:2

 笶ｯ src/tests/BuildingDestruction.test.js (3 tests | 3 failed) 250ms
     ﾃ・should destroy building immediately when population hits 0 122ms
     ﾃ・should destroy building if already 0 74ms
     ﾃ・should NOT destroy building if population remains > 0 51ms
stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cleanup expired pending requests
Game constructor called

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should NOT cleanup assigned requests even if old
Game constructor called

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cancel request via Proximity Search
Game constructor called

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should prioritize nearest request when cancelling
Game constructor called

 笶ｯ src/tests/RequestLifecycle.test.js (5 tests | 5 failed) 40ms
     ﾃ・should tag new requests with createdAt timestamp 31ms
     ﾃ・should cleanup expired pending requests 3ms
     ﾃ・should NOT cleanup assigned requests even if old 2ms
     ﾃ・should cancel request via Proximity Search 1ms
     ﾃ・should prioritize nearest request when cancelling 1ms
 笶ｯ src/tests/MinimalUnit.test.js (1 test | 1 failed) 512ms
     ﾃ・can instantiate Unit 511ms

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ Failed Tests 20 竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ

 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should destroy building immediately when population hits 0
AssertionError: expected 9.92 to be less than or equal to 0
 笶ｯ src/tests/BuildingDestruction.test.js:117:43
    115|         goblin.attackBuilding(house);
    116| 
    117|         expect(house.userData.population).toBeLessThanOrEqual(0);
       |                                           ^
    118|         expect(goblin.destroyBuilding).toHaveBeenCalled();
    119|         expect(goblin.destroyBuilding).toHaveBeenCalledWith(house);

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[1/20]竡ｯ

 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should destroy building if already 0
AssertionError: expected "vi.fn()" to be called at least once
 笶ｯ src/tests/BuildingDestruction.test.js:125:40
    123|         house.userData.population = 0;
    124|         goblin.attackBuilding(house);
    125|         expect(goblin.destroyBuilding).toHaveBeenCalled();
       |                                        ^
    126|     });
    127| 

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[2/20]竡ｯ

 FAIL  src/tests/BuildingDestruction.test.js > Building Destruction Logic > should NOT destroy building if population remains > 0
AssertionError: expected 49.92 to be 30 // Object.is equality

- Expected
+ Received

- 30
+ 49.92

 笶ｯ src/tests/BuildingDestruction.test.js:132:43
    130|         goblin.attackBuilding(house); // -20
    131| 
    132|         expect(house.userData.population).toBe(30);
       |                                           ^
    133|         expect(goblin.destroyBuilding).not.toHaveBeenCalled();
    134|     });

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[3/20]竡ｯ

 FAIL  src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should update cave Y position when terrain height changes
TypeError: cave.mesh.updateMatrix is not a function
 笶ｯ src/GoblinManager.js:260:27
    258|                 cave.originalHeight = currentHeight;
    259|                 cave.mesh.position.y = currentHeight;
    260|                 cave.mesh.updateMatrix();
       |                           ^
    261|             }
    262| 
 笶ｯ GoblinManager.update src/GoblinManager.js:221:20
 笶ｯ src/tests/CavePersistence.test.js:129:17

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[4/20]竡ｯ

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Load Game Persistence - Should resume movement
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 笶ｯ src/tests/CombatBalance.test.js:269:29
    267|         // Verify Restoration
    268|         // Verify Restoration
    269|         expect(u2.isMoving).toBe(true);
       |                             ^
    270|         // Note: triggerMove calculates NEXT TILE, not final destinati窶ｦ
    271|         // From 0,0 to 10,10. dx=10, dz=10. 10 > 10 is false. Z increm窶ｦ

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[5/20]竡ｯ

 FAIL  src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > Worker releases job when engaging in combat
TypeError: window.game.reportGlobalBattle is not a function
 笶ｯ Unit.takeDamage src/Unit.js:287:29
    285|             } else {
    286|                 // Workers also report their distress
    287|                 window.game.reportGlobalBattle(this.gridX, this.gridZ);
       |                             ^
    288|             }
    289|         }
 笶ｯ src/tests/CombatRequestHandoff.test.js:111:14

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[6/20]竡ｯ

 FAIL  src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > forceAssignRequest prioritizes nearby busy unit over distant idle unit
AssertionError: expected "vi.fn()" to be called at least once
 笶ｯ src/tests/CombatRequestHandoff.test.js:141:39
    139|         vi.runAllTimers();
    140| 
    141|         expect(mockGame.claimRequest).toHaveBeenCalled();
       |                                       ^
    142|         // Check if Unit 1 was the one claimed (mockGame.claimRequest 窶ｦ
    143|         const calls = mockGame.claimRequest.mock.calls;

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[7/20]竡ｯ

 FAIL  src/tests/GhostHouse.test.js > Terrain Ghost House Test > should accumulate ghost buildings in entityGrid if not cleared during deserialize
TypeError: gridGeo.setIndex is not a function
 笶ｯ Terrain.createMesh src/Terrain.js:531:17
    529|             }
    530|         }
    531|         gridGeo.setIndex(indices);
       |                 ^
    532| 
    533|         const gridMat = new THREE.LineBasicMaterial({
 笶ｯ Terrain.initTerrain src/Terrain.js:287:14
 笶ｯ new Terrain src/Terrain.js:26:14
 笶ｯ src/tests/GhostHouse.test.js:66:19

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[8/20]竡ｯ

 FAIL  src/tests/MigrationImprovement.test.js > Migration Improvements > should interrupt migration if enemy is found (Priority)
AssertionError: expected 'Migrating' to be 'Idle' // Object.is equality

Expected: "Idle"
Received: "Migrating"

 笶ｯ src/tests/MigrationImprovement.test.js:132:29
    130|         Math.random = originalRandom; // Restore
    131| 
    132|         expect(unit.action).toBe('Idle'); // Should reset to Idle to l窶ｦ
       |                             ^
    133|         expect(unit.migrationTarget).toBeNull();
    134|         expect(unit.targetGoblin).toBeTruthy();

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[9/20]竡ｯ

 FAIL  src/tests/MinimalUnit.test.js > Minimal Unit Sanity > can instantiate Unit
TypeError: Cannot read properties of undefined (reading 'add')
 笶ｯ Terrain.createMesh src/Terrain.js:560:20
    558|         this.mesh.add(dotsMesh);
    559| 
    560|         this.scene.add(this.mesh);
       |                    ^
    561|         this.meshes.push(this.mesh);
    562|     }
 笶ｯ Terrain.initTerrain src/Terrain.js:287:14
 笶ｯ new Terrain src/Terrain.js:26:14
 笶ｯ src/tests/MinimalUnit.test.js:27:25

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[10/20]竡ｯ

 FAIL  src/tests/NightLogic.test.js > Night Logic - Shelter Entry > Worker should engage pathfinding to House but is likely blocked
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 笶ｯ src/tests/NightLogic.test.js:83:32
     81|         // If it moves instantly due to 0 interval, isMoving might be 窶ｦ
     82|         // Just check action is 'Going Home' or target is correct.
     83|         expect(u1.targetGridX).toBe(1);
       |                                ^
     84|         expect(u1.action).toBe('Going Home');
     85| 

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[11/20]竡ｯ

 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should tag new requests with createdAt timestamp
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cleanup expired pending requests
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should NOT cleanup assigned requests even if old
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cancel request via Proximity Search
 FAIL  src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should prioritize nearest request when cancelling
TypeError: gl.getExtension is not a function
 笶ｯ getExtension node_modules/three/build/three.module.js:3954:24
 笶ｯ Object.init node_modules/three/build/three.module.js:3972:4
 笶ｯ initGLContext node_modules/three/build/three.module.js:15508:15
 笶ｯ new WebGLRenderer node_modules/three/build/three.module.js:15623:3
 笶ｯ new Game src/Game.js:101:25
     99| 
    100|         // 2. Setup Renderer
    101|         this.renderer = new THREE.WebGLRenderer({ antialias: true, pow窶ｦ
       |                         ^
    102|         this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 窶ｦ
    103|         this.renderer.setSize(window.innerWidth, window.innerHeight);
 笶ｯ src/tests/RequestLifecycle.test.js:121:16

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[12/20]竡ｯ

 FAIL  src/tests/SimpleRegion.test.js > Simple Region Connectivity > should identify a single island
 FAIL  src/tests/SimpleRegion.test.js > Simple Region Connectivity > should split two islands
TypeError: color.lerp is not a function
 笶ｯ Terrain.getBiomeColor src/Terrain.js:779:19
    777|             let sandFactor = 1.0;
    778|             if (moisture > 0.35) sandFactor = 1.0 - ((moisture - 0.35)窶ｦ
    779|             color.lerp(sandColor, sandFactor);
       |                   ^
    780|         }
    781| 
 笶ｯ Terrain.updateColors src/Terrain.js:708:36
 笶ｯ Terrain.calculateRegions src/Terrain.js:393:14
 笶ｯ Terrain.generateRandomTerrain src/Terrain.js:337:14
 笶ｯ Terrain.initTerrain src/Terrain.js:284:14
 笶ｯ new Terrain src/Terrain.js:26:14
 笶ｯ src/tests/SimpleRegion.test.js:57:19

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[13/20]竡ｯ

 FAIL  src/tests/StuckDebug.test.js > Unit Stuck Debugging > should log reason for blockage
Error: [vitest] No "BufferGeometry" export is defined on the "three" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

vi.mock(import("three"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

 笶ｯ Terrain.createMesh src/Terrain.js:516:35
    514| 
    515|         // 1. Grid Lines (Gray) - User Request
    516|         const gridGeo = new THREE.BufferGeometry();
       |                                   ^
    517|         gridGeo.setAttribute('position', this.geometry.attributes.posi窶ｦ
    518| 
 笶ｯ Terrain.initTerrain src/Terrain.js:287:14
 笶ｯ new Terrain src/Terrain.js:26:14
 笶ｯ src/tests/StuckDebug.test.js:59:25

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[14/20]竡ｯ

 FAIL  src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should NOT freeze if started at time 0
AssertionError: expected +0 to be 6 // Object.is equality

- Expected
+ Received

- 6
+ 0

 笶ｯ src/tests/UnitInit.test.js:52:31
     50|         expect(unit.moveRandomly).toHaveBeenCalled();
     51|         // lastTime should be updated (to seconds)
     52|         expect(unit.lastTime).toBe(6);
       |                               ^
     53|     });
     54| 

竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ竡ｯ[15/20]竡ｯ


 Test Files  12 failed | 1 passed (13)
      Tests  20 failed | 10 passed (30)
   Start at  20:59:41
   Duration  2.05s (transform 2.31s, setup 444ms, import 3.83s, tests 1.85s, environment 10.61s)

