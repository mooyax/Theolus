
 RUN  v4.0.15 C:/Users/mooya/develop/test

stdout | src/tests/GhostHouse.test.js > Terrain Ghost House Test > should NOT accumulate ghost buildings (cleared during deserialize)
[Terrain] addBuilding: house at 5,5. Force:false
[Terrain] Building Added: house at (5, 5) Size:2x2. Total: 1
Debug: Buildings Count: 1

stdout | src/tests/GhostHouse.test.js > Terrain Ghost House Test > should NOT accumulate ghost buildings (cleared during deserialize)
[Terrain] Deserializing Legacy Format...

stdout | src/tests/GhostHouse.test.js > Terrain Ghost House Test > should NOT accumulate ghost buildings (cleared during deserialize)
[Terrain] addBuilding: house at 5,5. Force:true
[Terrain] Building Added: house at (5, 5) Size:2x2. Total: 1

 ç¬¨ãƒ»src/tests/GhostHouse.test.js (1 test) 360ms
     ç¬¨ãƒ»should NOT accumulate ghost buildings (cleared during deserialize)  356ms
stdout | src/tests/GoblinMobilization.test.js > Goblin Mobilization Verification > triggerWave should mobilize idle goblins
GoblinManager: Generation started...
GoblinManager: Generated 0 goblin caves after 5000 attempts.

stdout | src/tests/GoblinMobilization.test.js > Goblin Mobilization Verification > triggerWave should mobilize idle goblins
[GoblinManager] TRIGGERING WAVE Level 1 for Clan test_clan!
[Wave] Spawning 1 goblins at cave 10,10 (Lvl 1)
[GoblinManager] Mobilized 2 idle goblins from Clan test_clan to raid target!

 ç¬¨ãƒ»src/tests/UnitVisibility.test.js (2 tests) 223ms
stdout | src/tests/StuckDebug.test.js > Unit Stuck Debugging > should log reason for blockage
[UnitCore.js] Unit Created ID:0 Role:undefined Pos:undefined,undefined Special:false
--- Testing Slope Block ---
[Unit 0] Blocked by Slope at 11,10 H:2->6
--- Testing Building Pass ---
--- Testing Water Block ---
[Unit 0] Blocked by Water at 30,30 H:0

stdout | src/tests/BuildingDestruction.test.js > Building Destruction Logic > should successfully remove a building from the list
[Terrain] addBuilding: house at 10,10. Force:true
[Terrain] Building Added: house at (10, 10) Size:2x2. Total: 1
[Terrain] Building removed at 10,10

 ç¬¨ãƒ»src/tests/StuckDebug.test.js (1 test) 256ms
 ç¬¨ãƒ»src/tests/SafeSpawn.test.js (1 test) 186ms
stdout | src/tests/BuildingDestruction.test.js > Building Destruction Logic > should allow a goblin to destroy a building
[Terrain] addBuilding: house at 10,10. Force:true
[Terrain] Building Added: house at (10, 10) Size:2x2. Total: 1
Goblin 0 hitting Empty house. HP: 2
Goblin 0 hitting Empty house. HP: -7
[Terrain] Building removed at 10,10
Goblin 0 destroyed house!

stdout | src/tests/GoblinMobilization.test.js > Goblin Mobilization Verification > mobilizeClan should rely on getClanRaidTarget fallback
GoblinManager: Generation started...
GoblinManager: Generated 0 goblin caves after 5000 attempts.

stdout | src/tests/GoblinMobilization.test.js > Goblin Mobilization Verification > mobilizeClan should rely on getClanRaidTarget fallback
[GoblinManager] Mobilized 1 idle goblins from Clan test_clan_fallback to raid target!

stderr | src/tests/GoblinMobilization.test.js
[GoblinManager] Aborting spawn: Grid cell has no building. Self-healing/Destroying Cave.
[GoblinManager] Removing invalid cave at 10,10

 ç¬¨ãƒ»src/tests/GoblinMobilization.test.js (2 tests) 367ms
stdout | src/tests/Hotspot.test.js > Global Battle Hotspots Logic > Clusters nearby battle reports
[Game] New Battle Hotspot at 10,10 (Region:1)

stdout | src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > forceAssignRequest prioritizes idle unit over busy unit
[Game] forceAssignRequest FOUND Unit 2 (DistSq:2888). Scanned:2
[Game] Force-Assigned Request req_hot to Unit 2 (Score: 2888.0)

stdout | src/tests/Hotspot.test.js > Global Battle Hotspots Logic > Decays intensity
[Game] New Battle Hotspot at 10,10 (Region:1)

stdout | src/tests/Hotspot.test.js > Global Battle Hotspots Logic > Mobilizes idle squads to intense hotspots (Updated Threshold)
[Game] Mobilizing Squad 1 to Hotspot at 100,20 (Intensity:100.0)

 ç¬¨ãƒ»src/tests/WorkerReachability.test.js (2 tests) 755ms
     ç¬¨ãƒ»findBestRequest filters out unreachable jobs  740ms
stdout | src/tests/Hotspot.test.js > Global Battle Hotspots Logic > Mobilizes idle squads
[Game] Mobilizing Squad 1 to Hotspot at 50,50 (Intensity:100.0)

 ç¬¶ï½¯ src/tests/CombatRequestHandoff.test.js (2 tests | 1 failed) 758ms
     ï¾ƒãƒ»Worker releases job when died 326ms
     ç¬¨ãƒ»forceAssignRequest prioritizes idle unit over busy unit  427ms
 ç¬¨ãƒ»src/tests/Hotspot.test.js (6 tests) 630ms
     ç¬¨ãƒ»Clusters nearby battle reports  612ms
stdout | src/tests/BuildingDestruction.test.js > Building Destruction Logic > should handle identity mismatch (Ghost Building)
[Terrain] addBuilding: house at 20,20. Force:true
[Terrain] Building Added: house at (20, 20) Size:2x2. Total: 1
[Terrain] removeBuilding: Identity mismatch! searching by coord 20,20
[Terrain] Swapping ghost building object for authoritative one.
[Terrain] Building removed at 20,20

 ç¬¨ãƒ»src/tests/BuildingDestruction.test.js (3 tests) 500ms
     ç¬¨ãƒ»should successfully remove a building from the list  310ms
stdout | src/tests/GoblinFixes.test.js > Goblin Fixes Verification > GoblinManager difficulty scaling increases stronger goblin probability
GoblinManager: Generation started...
GoblinManager: Generated 0 goblin caves after 5000 attempts.
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
Lvl 1 - King: 5, Shaman: 38, Hob: 90
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
Lvl 20 - King: 69, Shaman: 130, Hob: 289

 ç¬¨ãƒ»src/tests/GoblinFixes.test.js (4 tests) 548ms
stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should tag new requests with createdAt timestamp
Game constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 123,140. Force:false
[Terrain] Building Added: cave at (123, 140) Size:1x1. Total: 1
GoblinManager: Cave registered at 123,140 
[GoblinManager] Clan clan_cave_123_140 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 36,117. Force:false
[Terrain] Building Added: cave at (36, 117) Size:1x1. Total: 2
GoblinManager: Cave registered at 36,117 
[GoblinManager] Clan clan_cave_36_117 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 46,154. Force:false
[Terrain] Building Added: cave at (46, 154) Size:1x1. Total: 3
GoblinManager: Cave registered at 46,154 
[GoblinManager] Clan clan_cave_46_154 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 16,11. Force:false
[Terrain] Building Added: cave at (16, 11) Size:1x1. Total: 4
GoblinManager: Cave registered at 16,11 
[GoblinManager] Clan clan_cave_16_11 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 0,26. Force:false
[Terrain] Building Added: cave at (0, 26) Size:1x1. Total: 5
GoblinManager: Cave registered at 0,26 
[GoblinManager] Clan clan_cave_0_26 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 14 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should tag new requests with createdAt timestamp
[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should save game data correctly
Game constructor called

stdout | src/tests/SaveLoad.test.js > Save/Load System > should save game data correctly
Saving Game Data: {
  slotId: [33m1[39m,
  timestamp: [33m1767078497273[39m,
  resources: { grain: [33m100[39m, fish: [33m50[39m, meat: [33m25[39m },
  gameTime: [33m12[39m,
  gameTotalTime: [33m0[39m,
  currentSeasonIndex: [90mundefined[39m,
  daysPassed: [90mundefined[39m,
  terrain: {
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m2[39m,
    h: [
      [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-4[39m, [33m-4[39m, [33m-3[39m, [33m-3[39m, [33m-2[39m, [33m-2[39m, [33m-2[39m,
      [33m-1[39m, [33m-1[39m, [33m-0[39m, [33m-0[39m, [33m-0[39m, [33m-0[39m,  [33m0[39m,  [33m1[39m,  [33m1[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,
       [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m4[39m,  [33m3[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m3[39m,
       [33m3[39m,  [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,
       [33m7[39m,  [33m7[39m,  [33m8[39m,  [33m8[39m,  [33m9[39m,  [33m9[39m, [33m10[39m, [33m10[39m, [33m10[39m, [33m10[39m,  [33m9[39m,  [33m8[39m,
       [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m8[39m,
       [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m9[39m,
       [33m9[39m,  [33m9[39m,  [33m9[39m,  [33m9[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,
       [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,
      ... 25500 more items
    ],
    n: [
       [33m0.02[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.02[39m,  [33m0.01[39m,    [33m-0[39m,  [33m0.02[39m,  [33m0.02[39m,    [33m-0[39m,
       [33m0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.02[39m, [33m-0.01[39m, [33m-0.01[39m,
       [33m0.01[39m, [33m-0.02[39m,     [33m0[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m,  [33m0.02[39m, [33m-0.01[39m, [33m-0.01[39m,
          [33m0[39m,    [33m-0[39m,  [33m0.01[39m,  [33m0.02[39m, [33m-0.01[39m, [33m-0.02[39m,  [33m0.02[39m,     [33m0[39m,  [33m0.02[39m,
       [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m, [33m-0.02[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.02[39m,  [33m0.01[39m,  [33m0.02[39m,
      [33m-0.02[39m,  [33m0.01[39m, [33m-0.02[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.01[39m,
      [33m-0.02[39m,  [33m0.01[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.01[39m,
       [33m0.01[39m,  [33m0.01[39m, [33m-0.02[39m,    [33m-0[39m, [33m-0.01[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.02[39m,    [33m-0[39m,
      [33m-0.02[39m,    [33m-0[39m, [33m-0.01[39m,     [33m0[39m,  [33m0.01[39m,  [33m0.02[39m,    [33m-0[39m, [33m-0.01[39m, [33m-0.01[39m,
       [33m0.01[39m,    [33m-0[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.02[39m, [33m-0.01[39m,  [33m0.01[39m,  [33m0.01[39m, [33m-0.02[39m,
       [33m0.01[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.01[39m,
       [33m0.01[39m,
      ... 25500 more items
    ],
    b: [],
    m: [
      [33m0.19[39m,  [33m0.2[39m, [33m0.22[39m, [33m0.24[39m, [33m0.27[39m, [33m0.28[39m,  [33m0.3[39m, [33m0.31[39m, [33m0.32[39m, [33m0.34[39m,
      [33m0.36[39m, [33m0.37[39m, [33m0.38[39m, [33m0.38[39m, [33m0.39[39m,  [33m0.4[39m, [33m0.41[39m, [33m0.42[39m, [33m0.44[39m, [33m0.46[39m,
      [33m0.48[39m, [33m0.48[39m, [33m0.46[39m, [33m0.44[39m, [33m0.43[39m, [33m0.43[39m, [33m0.42[39m, [33m0.42[39m, [33m0.42[39m, [33m0.42[39m,
      [33m0.43[39m, [33m0.44[39m, [33m0.44[39m, [33m0.44[39m, [33m0.44[39m, [33m0.44[39m, [33m0.45[39m, [33m0.46[39m, [33m0.48[39m, [33m0.49[39m,
       [33m0.5[39m, [33m0.49[39m, [33m0.47[39m, [33m0.45[39m, [33m0.43[39m,  [33m0.4[39m, [33m0.39[39m, [33m0.37[39m, [33m0.36[39m, [33m0.35[39m,
      [33m0.34[39m, [33m0.33[39m, [33m0.33[39m, [33m0.31[39m, [33m0.29[39m, [33m0.27[39m, [33m0.26[39m, [33m0.25[39m, [33m0.25[39m, [33m0.25[39m,
      [33m0.25[39m, [33m0.26[39m, [33m0.27[39m, [33m0.27[39m, [33m0.27[39m, [33m0.27[39m, [33m0.27[39m, [33m0.27[39m, [33m0.27[39m, [33m0.28[39m,
       [33m0.3[39m, [33m0.33[39m, [33m0.35[39m, [33m0.37[39m, [33m0.38[39m, [33m0.39[39m, [33m0.41[39m, [33m0.43[39m, [33m0.45[39m, [33m0.47[39m,
      [33m0.48[39m, [33m0.48[39m, [33m0.47[39m, [33m0.47[39m, [33m0.46[39m, [33m0.45[39m, [33m0.46[39m, [33m0.46[39m, [33m0.45[39m, [33m0.43[39m,
      [33m0.41[39m, [33m0.39[39m, [33m0.38[39m, [33m0.37[39m, [33m0.36[39m, [33m0.35[39m, [33m0.35[39m, [33m0.35[39m, [33m0.35[39m, [33m0.36[39m,
      ... 25500 more items
    ]
  },
  units: [],
  goblinManager: {},
  camera: {
    position: { x: [33m20[39m, y: [33m20[39m, z: [33m20[39m },
    zoom: [33m1[39m,
    target: { x: [90mundefined[39m, y: [90mundefined[39m, z: [90mundefined[39m }
  },
  requests: []
}
Saved to slot 1 (Compressed). Size: 23941 chars (Original: 307869)

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cleanup expired pending requests
Game constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 103,127. Force:false
[Terrain] Building Added: cave at (103, 127) Size:1x1. Total: 1
GoblinManager: Cave registered at 103,127 
[GoblinManager] Clan clan_cave_103_127 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 86,35. Force:false
[Terrain] Building Added: cave at (86, 35) Size:1x1. Total: 2
GoblinManager: Cave registered at 86,35 
[GoblinManager] Clan clan_cave_86_35 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 7,44. Force:false
[Terrain] Building Added: cave at (7, 44) Size:1x1. Total: 3
GoblinManager: Cave registered at 7,44 
[GoblinManager] Clan clan_cave_7_44 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 151,45. Force:false
[Terrain] Building Added: cave at (151, 45) Size:1x1. Total: 4
GoblinManager: Cave registered at 151,45 
[GoblinManager] Clan clan_cave_151_45 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 55,39. Force:false
[Terrain] Building Added: cave at (55, 39) Size:1x1. Total: 5
GoblinManager: Cave registered at 55,39 
[GoblinManager] Clan clan_cave_55_39 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 18 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cleanup expired pending requests
[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Added: raise at (20,20) ID:req_1
[Game] forceAssignRequest FAILED for Req req_1. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] forceAssignRequest FAILED for Req req_1. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request req_0 pending for 0.3s.
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Timed Out: raise ID:req_0

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should NOT cleanup assigned requests even if old
Game constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 120,14. Force:false
[Terrain] Building Added: cave at (120, 14) Size:1x1. Total: 1
GoblinManager: Cave registered at 120,14 
[GoblinManager] Clan clan_cave_120_14 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 146,94. Force:false
[Terrain] Building Added: cave at (146, 94) Size:1x1. Total: 2
GoblinManager: Cave registered at 146,94 
[GoblinManager] Clan clan_cave_146_94 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 32,77. Force:false
[Terrain] Building Added: cave at (32, 77) Size:1x1. Total: 3
GoblinManager: Cave registered at 32,77 
[GoblinManager] Clan clan_cave_32_77 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 3,146. Force:false
[Terrain] Building Added: cave at (3, 146) Size:1x1. Total: 4
GoblinManager: Cave registered at 3,146 
[GoblinManager] Clan clan_cave_3_146 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 119,32. Force:false
[Terrain] Building Added: cave at (119, 32) Size:1x1. Total: 5
GoblinManager: Cave registered at 119,32 
[GoblinManager] Clan clan_cave_119_32 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 19 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should NOT cleanup assigned requests even if old
[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins deal population damage to player buildings
Goblin 0 attacking house. Pop: 9.00

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins deal structural damage to empty player buildings
Goblin 1 hitting Empty house. HP: 40

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Goblins destroy player buildings when HP reaches 0
Goblin 2 hitting Empty house. HP: 0
Goblin 2 destroyed house!

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Buildings retaliate against melee goblins
Goblin 3 attacking house. Pop: 9.92

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Towers have massive retaliation
Goblin 4 attacking tower. Pop: 4.92

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > No retaliation for distant attackers (Shamans)
Goblin 5 attacking house. Pop: 9.20

stdout | src/tests/BuildingDefense.test.js > Building Defense Logic > Standard HP logic for Goblin buildings
[UnitCore.js] Unit Created ID:0 Role:knight Pos:20,20 Special:false

 ç¬¨ãƒ»src/tests/BuildingDefense.test.js (8 tests) 31ms
stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Single Goblin (1v1) - AI Logic Check
[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false
[Unit.js] ENTERED updateLogic. Dead=false
[Unit Debug V2] Start Logic. Night=false, Stag=0.0, Age=20.0, H=10, Action=undefined
[Unit Heartbeat] ID:0 Action:undefined Moving:false T:0.0 dt:0.1000 Int:0
[Unit Debug] ATTACKING Goblin 0
Goblin (normal) died. ID:0
[Unit Debug] Executing Logic. Role: knight
[AI CHECK] KnightAction: Idle GoblinHP: -69

stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Wizard vs Single Goblin (1v1) - Wizard should win
[UnitCore.js] Unit Created ID:1 Role:wizard Pos:0,0 Special:false
[Unit Debug] ATTACKING Goblin 1
Goblin (normal) died. ID:1

stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Knight vs Swarm (1v5) - Knight should surviving
[UnitCore.js] Unit Created ID:2 Role:knight Pos:0,0 Special:false
[Unit Debug] ATTACKING Goblin g0
Goblin (normal) died. ID:g0
[Unit Debug] ATTACKING Goblin g1
Goblin (normal) died. ID:g1
[Unit Debug] ATTACKING Goblin g2
Goblin (normal) died. ID:g2
[Unit Debug] ATTACKING Goblin g3
Goblin (normal) died. ID:g3
[Unit Debug] ATTACKING Goblin g4
Goblin (normal) died. ID:g4

stdout | src/tests/CombatBalance.test.js > Combat Balance Simulation > Load Game Persistence - Should resume movement
[UnitCore.js] Unit Created ID:3 Role:knight Pos:0,0 Special:false
[Unit 3] Moving onto Rock at 0,1 H:10 (Speed Penalty)
[Unit 3] Moving onto Rock at 0,0 H:10 (Speed Penalty)
[UnitCore.js] Unit Created ID:4 Role:knight Pos:0,0 Special:false

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
Game constructor called

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
Load Started...

 ç¬¶ï½¯ src/tests/CombatBalance.test.js (4 tests | 1 failed) 55ms
     ç¬¨ãƒ»Knight vs Single Goblin (1v1) - AI Logic Check 16ms
     ç¬¨ãƒ»Wizard vs Single Goblin (1v1) - Wizard should win 7ms
     ç¬¨ãƒ»Knight vs Swarm (1v5) - Knight should surviving 5ms
     ï¾ƒãƒ»Load Game Persistence - Should resume movement 24ms
stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
Loading slot 1, Raw length: 101
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1767078498557[39m,
  data: {
    resources: { grain: [33m999[39m, fish: [33m888[39m },
    gameTime: [33m6[39m,
    terrain: { logicalWidth: [33m10[39m, logicalDepth: [33m10[39m, grid: [], buildings: [] },
    units: [],
    camera: { position: [36m[Object][39m, target: [36m[Object][39m }
  }
}
Load Game: Data found {
  resources: { grain: [33m999[39m, fish: [33m888[39m },
  gameTime: [33m6[39m,
  terrain: { logicalWidth: [33m10[39m, logicalDepth: [33m10[39m, grid: [], buildings: [] },
  units: [],
  camera: { position: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m }, target: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m } }
}
Clearing 0 projectiles...

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[DEBUG] Terrain.setSeason: Changing from undefined to Spring
[Game] Restored Camera Zoom: 1

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/WorkerRequest.test.js > Worker Job Logic (Unit.js + States) > Unit finds and claims request when idle
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false

stdout | src/tests/WorkerRequest.test.js > Worker Job Logic (Unit.js + States) > Unit moves to target request
[UnitCore.js] Unit Created ID:1 Role:worker Pos:0,0 Special:false

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/WorkerRequest.test.js > Worker Job Logic (Unit.js + States) > Unit completes request upon arrival
[UnitCore.js] Unit Created ID:2 Role:worker Pos:0,0 Special:false

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0

 ç¬¨ãƒ»src/tests/WorkerRequest.test.js (3 tests) 26ms
stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cancel request via Proximity Search
Game constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 30,43. Force:false
[Terrain] Building Added: cave at (30, 43) Size:1x1. Total: 1
GoblinManager: Cave registered at 30,43 
[GoblinManager] Clan clan_cave_30_43 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 27,22. Force:false
[Terrain] Building Added: cave at (27, 22) Size:1x1. Total: 2
GoblinManager: Cave registered at 27,22 
[GoblinManager] Clan clan_cave_27_22 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 93,14. Force:false
[Terrain] Building Added: cave at (93, 14) Size:1x1. Total: 3
GoblinManager: Cave registered at 93,14 
[GoblinManager] Clan clan_cave_93_14 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 148,28. Force:false
[Terrain] Building Added: cave at (148, 28) Size:1x1. Total: 4
GoblinManager: Cave registered at 148,28 
[GoblinManager] Clan clan_cave_148_28 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 76,33. Force:false
[Terrain] Building Added: cave at (76, 33) Size:1x1. Total: 5
GoblinManager: Cave registered at 76,33 
[GoblinManager] Clan clan_cave_76_33 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 12 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should cancel request via Proximity Search
[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Added: raise at (20,20) ID:req_1
[Game] forceAssignRequest FAILED for Req req_1. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Canceled at 10,10 (Target: 11,11)

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should load game data correctly
[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should retry migration after 30 seconds timeout
[UnitCore.js] Unit Created ID:0 Role:worker Pos:50,50 Special:false

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should retry migration after 30 seconds timeout
Unit test-migrant migrating to 50,50 (Region undefined)
Unit test-migrant migration timed out. Retrying.
Unit test-migrant migrating to 50,50 (Region undefined)

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should interrupt migration if enemy is found (Priority)
[UnitCore.js] Unit Created ID:1 Role:worker Pos:50,50 Special:false

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should interrupt migration if enemy is found (Priority)
Unit test-migrant migrating to 50,50 (Region undefined)
Unit test-migrant interrupted migration for combat.

stdout | src/tests/CombatVerification.test.js > Combat Logic Verification > Scenario A: Worker destroys Cave
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
Approach Point: 11,10
Cave HP: 196 (Was: 200)

stdout | src/tests/CombatVerification.test.js > Combat Logic Verification > Scenario B: Goblin destroys House
Goblin 0 SPAWNED FOR RAIDING! Target: NaN,NaN
[Goblin 0] ENTER RaidState. Goal: NaN,NaN
[MockTerrain] Searching 1 buildings. Range:25 Center:20,20
  - Checking Building at 22,20. Dist:2
    -> Score: 2
Goblin 0 attacking house. Pop: 1.92
Goblin 0 attacking house. Pop: 1.84
House Pop: 1.8399999999999999

stdout | src/tests/CombatVerification.test.js > Combat Logic Verification > Scenario C: Goblin finds and destroys House
[MockTerrain] Searching 1 buildings. Range:12 Center:8,8
  - Checking Building at 10,10. Dist:2.8284271247461903
    -> Score: 2.8284271247461903
Goblin 1 hitting Empty house. HP: 92
Goblin 1 hitting Empty house. HP: 84
[Test] House HP reduced to 84

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should stop migrating if construction succeeds
[UnitCore.js] Unit Created ID:2 Role:worker Pos:50,50 Special:false

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > should stop migrating if construction succeeds
Unit test-migrant migrating to 50,50 (Region undefined)

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > DEBUG: should log blockage reasons correctly
[UnitCore.js] Unit Created ID:3 Role:worker Pos:50,50 Special:false

stdout | src/tests/MigrationImprovement.test.js > Migration Improvements > DEBUG: should log blockage reasons correctly
[Unit test-migrant] Blocked by Slope at 21,20 H:2->6

 ç¬¨ãƒ»src/tests/CombatVerification.test.js (3 tests) 24ms
 ç¬¶ï½¯ src/tests/MigrationImprovement.test.js (4 tests | 1 failed) 37ms
     ç¬¨ãƒ»should retry migration after 30 seconds timeout 11ms
     ï¾ƒãƒ»should interrupt migration if enemy is found (Priority) 18ms
     ç¬¨ãƒ»should stop migrating if construction succeeds 3ms
     ç¬¨ãƒ»DEBUG: should log blockage reasons correctly 2ms
stdout | src/tests/MigrationConflict.test.js > Migration Conflict Regression (Jitabata Bug) > should handle basic Unit update without crash
[UnitCore.js] Unit Created ID:0 Role:worker Pos:20,20 Special:false

stdout | src/tests/MigrationConflict.test.js > Migration Conflict Regression (Jitabata Bug) > should handle basic Unit update without crash
[Unit.js] ENTERED updateLogic. Dead=false

stdout | src/tests/MigrationConflict.test.js > Migration Conflict Regression (Jitabata Bug) > should NOT allow WanderState to interfere with Migration Movement
[UnitCore.js] Unit Created ID:1 Role:worker Pos:20,20 Special:false

stdout | src/tests/MigrationConflict.test.js > Migration Conflict Regression (Jitabata Bug) > should NOT allow WanderState to interfere with Migration Movement
Unit 1 migrating to 30,30 (Region 1)

stdout | src/tests/MigrationConflict.test.js > Migration Conflict Regression (Jitabata Bug) > should allow Migration Logic to control repeated movement
[UnitCore.js] Unit Created ID:2 Role:worker Pos:20,20 Special:false

stdout | src/tests/MigrationConflict.test.js > Migration Conflict Regression (Jitabata Bug) > should allow Migration Logic to control repeated movement
Unit 2 migrating to 30,30 (Region 1)

 ç¬¶ï½¯ src/tests/MigrationConflict.test.js (3 tests | 1 failed) 141ms
     ç¬¨ãƒ»should handle basic Unit update without crash 9ms
     ç¬¨ãƒ»should NOT allow WanderState to interfere with Migration Movement 5ms
     ï¾ƒãƒ»should allow Migration Logic to control repeated movement 124ms
stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should prioritize nearest request when cancelling
Game constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 144,140. Force:false
[Terrain] Building Added: cave at (144, 140) Size:1x1. Total: 1
GoblinManager: Cave registered at 144,140 
[GoblinManager] Clan clan_cave_144_140 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 126,145. Force:false
[Terrain] Building Added: cave at (126, 145) Size:1x1. Total: 2
GoblinManager: Cave registered at 126,145 
[GoblinManager] Clan clan_cave_126_145 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 34,44. Force:false
[Terrain] Building Added: cave at (34, 44) Size:1x1. Total: 3
GoblinManager: Cave registered at 34,44 
[GoblinManager] Clan clan_cave_34_44 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 156,102. Force:false
[Terrain] Building Added: cave at (156, 102) Size:1x1. Total: 4
GoblinManager: Cave registered at 156,102 
[GoblinManager] Clan clan_cave_156_102 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 36,28. Force:false
[Terrain] Building Added: cave at (36, 28) Size:1x1. Total: 5
GoblinManager: Cave registered at 36,28 
[GoblinManager] Clan clan_cave_36_28 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 6 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

stdout | src/tests/RequestLifecycle.test.js > Game Request Lifecycle > should prioritize nearest request when cancelling
[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Added: raise at (12,12) ID:req_1
[Game] forceAssignRequest FAILED for Req req_1. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Canceled at 10,10 (Target: 10,11)

 ç¬¨ãƒ»src/tests/RequestLifecycle.test.js (5 tests) 3170ms
     ç¬¨ãƒ»should tag new requests with createdAt timestamp  936ms
     ç¬¨ãƒ»should cleanup expired pending requests  434ms
     ç¬¨ãƒ»should NOT cleanup assigned requests even if old  573ms
     ç¬¨ãƒ»should cancel request via Proximity Search  690ms
     ç¬¨ãƒ»should prioritize nearest request when cancelling  534ms
 ç¬¨ãƒ»src/tests/SpatialSearch.test.js (4 tests) 3823ms
     ç¬¨ãƒ»should register and retrieve an entity  1152ms
     ç¬¨ãƒ»should move entity correctly between cells  854ms
     ç¬¨ãƒ»should unregister entity  772ms
     ç¬¨ãƒ»should find nearest entity using spatial search  1041ms
stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
Game constructor called

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
Load Started...

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
Loading slot 1, Raw length: 112
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1767078499954[39m,
  data: {
    resources: {},
    gameTime: [33m10[39m,
    terrain: { logicalWidth: [33m80[39m, grid: [], buildings: [] },
    units: [],
    requests: [ [36m[Object][39m, [36m[Object][39m ]
  }
}
Load Game: Data found {
  resources: {},
  gameTime: [33m10[39m,
  terrain: { logicalWidth: [33m80[39m, grid: [], buildings: [] },
  units: [],
  requests: [
    { id: [32m'req_1'[39m, type: [32m'raise'[39m, x: [33m5[39m, z: [33m5[39m, status: [32m'pending'[39m },
    { id: [32m'req_2'[39m, type: [32m'lower'[39m, x: [33m10[39m, z: [33m10[39m, status: [32m'completed'[39m }
  ]
}
Clearing 0 projectiles...

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Terrain] Deserializing Legacy Format...

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[DEBUG] Terrain.setSeason: Changing from undefined to Spring
[Game] Restoring 2 requests...

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1,"Unnamed_CylinderGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1,"Unnamed_CylinderGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1,"Unnamed_CylinderGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

stdout | src/tests/SaveLoad.test.js > Save/Load System > should restore request markers with correct renderOrder
[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1,"Unnamed_CylinderGeometry":2}

 ç¬¨ãƒ»src/tests/SaveLoad.test.js (3 tests) 4060ms
     ç¬¨ãƒ»should save game data correctly  1307ms
     ç¬¨ãƒ»should load game data correctly  1462ms
     ç¬¨ãƒ»should restore request markers with correct renderOrder  1288ms
stdout | src/tests/ForceBuild.test.js > Terrain Force Build Logic > should clear existing buildings when placing a new one
[Terrain] addBuilding: house at 10,10. Force:false
[Terrain] Building Added: house at (10, 10) Size:2x2. Total: 1
[Terrain] Clearing obstacle: house for new construction.
[Terrain] Building removed at 10,10
[Terrain] addBuilding: barracks at 10,10. Force:false
[Terrain] Building Added: barracks at (10, 10) Size:3x3. Total: 1

stdout | src/tests/Pathfinding.test.js > Terrain Pathfinding Costs > Prefers a longer flat route over a shorter mountain route
Path Length: 31
Goes through gap: true
Goes through mountain: false

 ç¬¨ãƒ»src/tests/Pathfinding.test.js (1 test) 116ms
stdout | src/tests/SimpleRegion.test.js > Simple Region Connectivity > should identify a single island
Running calculateRegions...
Done.
Region ID at 5,5: 1

 ç¬¨ãƒ»src/tests/SimpleRegion.test.js (2 tests) 328ms
stdout | src/tests/UnitSnatch.test.js > Unit Snatching and Race Conditions > should stop and wander if another unit snatches its job
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] Moving onto Rock at 11,10 H:10 (Speed Penalty)
[JobState] smartMove failed (Wait). Budget? undefined
[JobState] Entered. Target: build. Resume: None
[Unit.js] ENTERED updateLogic. Dead=false
[JobState] Ownership LOST for Job job1. Someone snatched it or it was unassigned. Switching to Wander.

stdout | src/tests/UnitSnatch.test.js > Unit Snatching and Race Conditions > should stop if the job is completed by someone else
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] Moving onto Rock at 11,10 H:10 (Speed Penalty)
[JobState] smartMove failed (Wait). Budget? undefined
[JobState] Entered. Target: build. Resume: None
[Unit.js] ENTERED updateLogic. Dead=false
[JobState] Job job1 is completed. Resuming.

 ç¬¨ãƒ»src/tests/UnitSnatch.test.js (2 tests) 20ms
stdout | src/tests/SquadAi.test.js > Squad AI & Region Logic > should share targets among squad members
[UnitCore.js] Unit Created ID:0 Role:knight Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:knight Pos:20,20 Special:false

stdout | src/tests/SquadAi.test.js > Squad AI & Region Logic > Regression: Migration Stagnation Fix (Knight)
[UnitCore.js] Unit Created ID:2 Role:knight Pos:10,10 Special:false
Unit 2 (knight) finished migrating. Resuming Idle.

stdout | src/tests/SquadAi.test.js > Squad AI & Region Logic > Regression: Migration Stagnation Fix (Worker)
[UnitCore.js] Unit Created ID:3 Role:worker Pos:10,10 Special:false
Unit 3 (Worker) migration target invalid for build. Searching nearby...

stdout | src/tests/SquadAi.test.js > Squad AI & Region Logic > should allow cross-region movement if target is very close (Self Defense)
[UnitCore.js] Unit Created ID:4 Role:knight Pos:10,10 Special:false

 ç¬¨ãƒ»src/tests/SquadAi.test.js (5 tests) 24ms
stdout | src/tests/RubberBanding.test.js > Rubber-banding and Chaining Verification > should NOT snap back when arriving at a job during mid-move
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false

stdout | src/tests/RubberBanding.test.js > Rubber-banding and Chaining Verification > should NOT snap back when arriving at a job during mid-move
[JobState] smartMove failed (Wait). Budget? undefined
[JobState] Entered. Target: build. Resume: None

stdout | src/tests/RubberBanding.test.js > Rubber-banding and Chaining Verification > should use visual position for chaining the next job
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false

stdout | src/tests/ForceBuild.test.js > Terrain Force Build Logic > should clear buildings partially in the way
[Terrain] addBuilding: house at 10,10. Force:false
[Terrain] Building Added: house at (10, 10) Size:2x2. Total: 1
Pre-Barracks Buildings: [ [32m'house'[39m ]
[Terrain] Clearing obstacle: house for new construction.
[Terrain] Building removed at 10,10
[Terrain] addBuilding: barracks at 9,9. Force:false
[Terrain] Building Added: barracks at (9, 9) Size:3x3. Total: 1
Post-Barracks Buildings: [ [32m'barracks'[39m ]

 ç¬¶ï½¯ src/tests/RubberBanding.test.js (2 tests | 1 failed) 59ms
     ç¬¨ãƒ»should NOT snap back when arriving at a job during mid-move 9ms
     ï¾ƒãƒ»should use visual position for chaining the next job 47ms
stdout | src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should update cave Y position when terrain height changes
[GoblinRenderer] Updating 0 goblins.

stdout | src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should destroy cave if submerged (height <= 0)
[GoblinManager] Cave destroyed: SUBMERGED(H = -1)
[GoblinRenderer] Updating 0 goblins.

stderr | src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should destroy cave if submerged (height <= 0)
[GoblinManager] Removing invalid cave at 10,10

 ç¬¨ãƒ»src/tests/ForceBuild.test.js (2 tests) 2303ms
     ç¬¨ãƒ»should clear existing buildings when placing a new one  1283ms
     ç¬¨ãƒ»should clear buildings partially in the way  1017ms
 ç¬¨ãƒ»src/tests/CavePersistence.test.js (2 tests) 15ms
stdout | src/tests/AdvancedUnits.test.js > Advanced Units > should initialize Knight with high stats
[UnitCore.js] Unit Created ID:0 Role:knight Pos:10,10 Special:false

stdout | src/tests/AdvancedUnits.test.js > Advanced Units > should initialize Wizard with low HP and high stats
[UnitCore.js] Unit Created ID:1 Role:wizard Pos:10,10 Special:false

stdout | src/tests/AdvancedUnits.test.js > Advanced Units > should allow Wizard to attack from range
[UnitCore.js] Unit Created ID:2 Role:wizard Pos:10,10 Special:false
[Unit Debug] ATTACKING Goblin g1

 ç¬¨ãƒ»src/tests/AdvancedUnits.test.js (3 tests) 16ms
stdout | src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should damage building population
Goblin 0 attacking house. Pop: 9.92

stdout | src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should destroy building when Population AND HP are depleted
Goblin 1 attacking house. Pop: 0.00
Goblin 1 hitting Empty house. HP: -5
Goblin 1 destroyed house!

stdout | src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should destroy building even if fractional population remains (e.g. 0.5)
Goblin 2 attacking house. Pop: 0.00
Goblin 2 hitting Empty house. HP: -5
Goblin 2 destroyed house!

stdout | src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should NOT destroy building if population remains >= 1.0
Goblin 3 attacking house. Pop: 6.92

stdout | src/tests/GoblinDestruction.test.js > Goblin Building Destruction > should take retaliation damage
Goblin 4 attacking house. Pop: 19.92

 ç¬¨ãƒ»src/tests/GoblinDestruction.test.js (5 tests) 28ms
stdout | src/tests/ForceAssignment.test.js > Force Assignment Integration > should successfully triggerMove without infinite loop
Game constructor called
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false

stdout | src/tests/ForceAssignment.test.js > Force Assignment Integration > should handle Force Assignment logic block
Game constructor called
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false

 ç¬¨ãƒ»src/tests/ForceAssignment.test.js (2 tests) 21ms
stdout | src/tests/WorkerDiversity.test.js > Worker Diversity Spawning > should spawn diverse roles (Worker/Hunter/Fisher) from a House
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:1 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:3 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:4 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:5 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:6 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:7 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:8 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:9 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:10 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:11 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:12 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:13 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:14 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:15 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:16 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:17 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:18 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:19 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:20 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:21 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:22 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:23 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:24 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:25 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:26 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:27 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:28 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:29 Role:fisher Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:30 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:31 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:32 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:33 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:34 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:35 Role:fisher Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:36 Role:hunter Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:37 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:38 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:39 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:40 Role:fisher Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:41 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:42 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:43 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:44 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:45 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:46 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:47 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:48 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:49 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:50 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:51 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:52 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:53 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:54 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:55 Role:fisher Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:56 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:57 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:58 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:59 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:60 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:61 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:62 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:63 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:64 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:65 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:66 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:67 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:68 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:69 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:70 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:71 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:72 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:73 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:74 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:75 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:76 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:77 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:78 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:79 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:80 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:81 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:82 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:83 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:84 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:85 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:86 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:87 Role:hunter Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:88 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:89 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:90 Role:hunter Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:91 Role:fisher Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:92 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:93 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:94 Role:worker Pos:10,10 Special:false
Spawned fisher linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:95 Role:fisher Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:96 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:97 Role:worker Pos:10,10 Special:false
Spawned worker linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:98 Role:worker Pos:10,10 Special:false
Spawned hunter linked to house at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:99 Role:hunter Pos:10,10 Special:false
Spawn Distribution (100 runs): { worker: [33m61[39m, hunter: [33m14[39m, fisher: [33m25[39m }

stdout | src/tests/WorkerDiversity.test.js > Worker Diversity Spawning > should spawn Knights from Barracks
Spawned knight linked to barracks at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:100 Role:knight Pos:10,10 Special:false

stdout | src/tests/WorkerDiversity.test.js > Worker Diversity Spawning > should spawn Wizards from Towers
Spawned wizard linked to tower at 10,10 SquadID:null
[UnitCore.js] Unit Created ID:101 Role:wizard Pos:10,10 Special:false

 ç¬¨ãƒ»src/tests/WorkerDiversity.test.js (3 tests) 21ms
 ç¬¨ãƒ»src/tests/Terrain.test.js (9 tests) 7209ms
       ç¬¨ãƒ»should correctly sum housing population excluding farms  1338ms
       ç¬¨ãƒ»should handle massive population overflow loop correctly  798ms
       ç¬¨ãƒ»should grow crops using simDeltaTime (Not raw deltaTime)  740ms
       ç¬¨ãƒ»should preserve overflow when harvesting  837ms
       ç¬¨ãƒ»should scale farm yield based on moisture  690ms
       ç¬¨ãƒ»should reduce food consumption at night  624ms
       ç¬¨ãƒ»should consume normal amount during day  687ms
         ç¬¨ãƒ»should return different colors for seasons  650ms
         ç¬¨ãƒ»should keep rock color even if dry (desert override check)  841ms
stdout | src/tests/MultiJob.test.js > Multi-Job Juggling Verification > should NOT interrupt busy units when a new job is added
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:0,0 Special:false
Game constructor called
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 151,2. Force:false
[Terrain] Building Added: cave at (151, 2) Size:1x1. Total: 1
GoblinManager: Cave registered at 151,2 
[GoblinManager] Clan clan_cave_151_2 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 97,146. Force:false
[Terrain] Building Added: cave at (97, 146) Size:1x1. Total: 2
GoblinManager: Cave registered at 97,146 
[GoblinManager] Clan clan_cave_97_146 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 108,77. Force:false
[Terrain] Building Added: cave at (108, 77) Size:1x1. Total: 3
GoblinManager: Cave registered at 108,77 
[GoblinManager] Clan clan_cave_108_77 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 112,52. Force:false
[Terrain] Building Added: cave at (112, 52) Size:1x1. Total: 4
GoblinManager: Cave registered at 112,52 
[GoblinManager] Clan clan_cave_112_52 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 83,156. Force:false
[Terrain] Building Added: cave at (83, 156) Size:1x1. Total: 5
GoblinManager: Cave registered at 83,156 
[GoblinManager] Clan clan_cave_83_156 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

stdout | src/tests/MultiJob.test.js > Multi-Job Juggling Verification > should NOT interrupt busy units when a new job is added
[Game] forceAssignRequest FOUND Unit 1 (DistSq:400). Scanned:2
[Game] Force-Assigned Request 101 to Unit 1 (Score: 400.0)
[Game] forceAssignRequest FOUND Unit 2 (DistSq:400). Scanned:2
[Game] Force-Assigned Request 102 to Unit 2 (Score: 400.0)
[Game] Request Added: build at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:2 (RoleSkipped:0) Busy:2 Valid:0. TotalUnits:2
[Game] forceAssignRequest FAILED for Req req_0. Scanned:2 (RoleSkipped:0) Busy:2 Valid:0. TotalUnits:2

 ç¬¨ãƒ»src/tests/MultiJob.test.js (1 test) 3642ms
     ç¬¨ãƒ»should NOT interrupt busy units when a new job is added  3639ms
 ç¬¨ãƒ»src/tests/MovementReset.test.js (2 tests) 11ms
stdout | src/tests/Lighting.test.js > BuildingRenderer Lighting > should turn on barracks lights at night
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

 ç¬¨ãƒ»src/tests/Lighting.test.js (1 test) 44ms
stdout | src/tests/StartupCrash.test.js > Startup Crash Verification > UnitRenderer update should not crash with active units
[UnitCore.js] Unit Created ID:0 Role:knight Pos:10,10 Special:false

 ç¬¨ãƒ»src/tests/StartupCrash.test.js (3 tests) 125ms
stdout | src/tests/UnitBehavior.test.js > Unit Behavior Mode > should return Patrol for Knight/Wizard when idle
[UnitCore.js] Unit Created ID:0 Role:undefined Pos:5,5 Special:false

stdout | src/tests/UnitBehavior.test.js > Unit Behavior Mode > should return Wander for Worker when idle
[UnitCore.js] Unit Created ID:1 Role:undefined Pos:5,5 Special:false

stdout | src/tests/UnitBehavior.test.js > Unit Behavior Mode > should return Combat when targetGoblin is set
[UnitCore.js] Unit Created ID:2 Role:undefined Pos:5,5 Special:false

stdout | src/tests/UnitBehavior.test.js > Unit Behavior Mode > should return Siege when targetBuilding is set
[UnitCore.js] Unit Created ID:3 Role:undefined Pos:5,5 Special:false

stdout | src/tests/UnitBehavior.test.js > Unit Behavior Mode > should return Working when targetRequest is set
[UnitCore.js] Unit Created ID:4 Role:undefined Pos:5,5 Special:false

stdout | src/tests/UnitBehavior.test.js > Unit Behavior Mode > should return Patrolling with coords when targetRaidPoint is set
[UnitCore.js] Unit Created ID:5 Role:undefined Pos:5,5 Special:false

stdout | src/tests/UnitBehavior.test.js > Unit Behavior Mode > should return Migrating when action is Migrating
[UnitCore.js] Unit Created ID:6 Role:undefined Pos:5,5 Special:false

stdout | src/tests/UnitBehavior.test.js > Unit Behavior Mode > should prioritize Combat over Exploration
[UnitCore.js] Unit Created ID:7 Role:undefined Pos:5,5 Special:false

 ç¬¨ãƒ»src/tests/UnitBehavior.test.js (8 tests) 17ms
stdout | src/tests/ManaSystem.test.js > Mana System > InputManager Integration > should consume mana on raise terrain
[Input] Request Queued: Raise at 0,0

stderr | src/tests/ManaSystem.test.js > Mana System > InputManager Integration > should consume mana on raise terrain
THREE.Raycaster: Unsupported camera type: undefined
THREE.Raycaster: Unsupported camera type: undefined

stderr | src/tests/ManaSystem.test.js > Mana System > InputManager Integration > should block raise terrain if mana is negative
THREE.Raycaster: Unsupported camera type: undefined
Action Blocked: Not enough Mana (Negative)

 ç¬¨ãƒ»src/tests/ManaSystem.test.js (5 tests) 22ms
stdout | src/tests/ShorelineLoop.test.js > Shoreline Loop Reproduction > should NOT target unrelated region goblin via findTargetGoblin
[UnitCore.js] Unit Created ID:0 Role:soldier Pos:5,5 Special:false

stdout | src/tests/ShorelineLoop.test.js > Shoreline Loop Reproduction > should NOT target land goblin when unit is in water (Region 0)
[UnitCore.js] Unit Created ID:1 Role:soldier Pos:5,5 Special:false

 ç¬¨ãƒ»src/tests/ShorelineLoop.test.js (2 tests) 13ms
stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should initialize with age 20
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should increment age when updateLogic is called
[UnitCore.js] Unit Created ID:1 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should die when age exceeds lifespan
[UnitCore.js] Unit Created ID:2 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should age slower for Knights and Wizards (0.02 rate)
[UnitCore.js] Unit Created ID:3 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should age slower for Knights and Wizards (0.02 rate)
[UnitCore.js] Unit Created ID:4 Role:knight Pos:0,0 Special:false
[UnitCore.js] Unit Created ID:5 Role:wizard Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should have longer lifespan for Special units
[UnitCore.js] Unit Created ID:6 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitLifecycle.test.js > Unit Lifecycle and Aging > should have longer lifespan for Special units
[UnitCore.js] Unit Created ID:7 Role:worker Pos:0,0 Special:false

 ç¬¨ãƒ»src/tests/UnitLifecycle.test.js (5 tests) 21ms
stdout | src/tests/UnitWrapping.test.js > Unit Movement Wrapping > should move normally for short distances
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitWrapping.test.js > Unit Movement Wrapping > should wrap LEFT if target is across right boundary
[UnitCore.js] Unit Created ID:1 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitWrapping.test.js > Unit Movement Wrapping > should wrap RIGHT if target is across left boundary
[UnitCore.js] Unit Created ID:2 Role:worker Pos:0,0 Special:false

stdout | src/tests/UnitWrapping.test.js > Unit Movement Wrapping > should handle Z axis wrapping
[UnitCore.js] Unit Created ID:3 Role:worker Pos:0,0 Special:false

 ç¬¨ãƒ»src/tests/UnitWrapping.test.js (4 tests) 17ms
stdout | src/tests/JobPathFailure.test.js > Job Pathfinding Failure Handling > should abandon job if smartMove fails repeatedly
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false
Game constructor called
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 47,24. Force:false
[Terrain] Building Added: cave at (47, 24) Size:1x1. Total: 1
GoblinManager: Cave registered at 47,24 
[GoblinManager] Clan clan_cave_47_24 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 26,41. Force:false
[Terrain] Building Added: cave at (26, 41) Size:1x1. Total: 2
GoblinManager: Cave registered at 26,41 
[GoblinManager] Clan clan_cave_26_41 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 23,115. Force:false
[Terrain] Building Added: cave at (23, 115) Size:1x1. Total: 3
GoblinManager: Cave registered at 23,115 
[GoblinManager] Clan clan_cave_23_115 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 77,64. Force:false
[Terrain] Building Added: cave at (77, 64) Size:1x1. Total: 4
GoblinManager: Cave registered at 77,64 
[GoblinManager] Clan clan_cave_77_64 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 55,8. Force:false
[Terrain] Building Added: cave at (55, 8) Size:1x1. Total: 5
GoblinManager: Cave registered at 55,8 
[GoblinManager] Clan clan_cave_55_8 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 11 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

stdout | src/tests/JobPathFailure.test.js > Job Pathfinding Failure Handling > should abandon job if smartMove fails repeatedly
[Game] forceAssignRequest FAILED for Req 101. Scanned:1 (RoleSkipped:0) Busy:1 Valid:0. TotalUnits:1
Success: Job released after repeated failures.

 ç¬¨ãƒ»src/tests/JobPathFailure.test.js (1 test) 2254ms
     ç¬¨ãƒ»should abandon job if smartMove fails repeatedly  2251ms
stdout | src/tests/UnitAISearch.test.js > Unit AI Search Optimization > should use Spatial Search to find goblin
[UnitCore.js] Unit Created ID:0 Role:guard Pos:0,0 Special:false

 ç¬¨ãƒ»src/tests/UnitAISearch.test.js (2 tests) 21ms
stdout | src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should NOT freeze if started at time 0
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit.js] ENTERED updateLogic. Dead=false
[Unit Debug V2] Start Logic. Night=false, Stag=0.0, Age=20.0, H=1, Action=undefined
[Unit Heartbeat] ID:0 Action:undefined Moving:false T:1.0 dt:1.0000 Int:3636
[Unit Debug] Executing Logic. Role: worker
[Unit.js] ENTERED updateLogic. Dead=false
[Unit Debug V2] Start Logic. Night=false, Stag=1.0, Age=20.2, H=1, Action=Idle
[Unit Heartbeat] ID:0 Action:Idle Moving:false T:6.0 dt:1.0000 Int:2769
[Unit Debug] Executing Logic. Role: worker
Debug Unit Action after 6s: Idle

stdout | src/tests/UnitInit.test.js > Unit Initialization and Movement Start > should NOT freeze if started at time 0
[Unit.js] ENTERED updateLogic. Dead=false
[Unit Debug V2] Start Logic. Night=false, Stag=2.0, Age=20.4, H=1, Action=Idle
[Unit Heartbeat] ID:0 Action:Idle Moving:false T:0.0 dt:0.1000 Int:2154
[Unit Debug] Executing Logic. Role: worker
[Unit.js] ENTERED updateLogic. Dead=false
[Unit Debug V2] Start Logic. Night=false, Stag=2.1, Age=20.4, H=1, Action=Idle
[Unit Heartbeat] ID:0 Action:Idle Moving:false T:5.0 dt:0.1000 Int:4165
[Unit Debug] Executing Logic. Role: worker

 ç¬¨ãƒ»src/tests/UnitInit.test.js (1 test) 13ms
stdout | src/tests/MinimalUnit.test.js > Minimal Unit Sanity > can instantiate Unit
[UnitCore.js] Unit Created ID:0 Role:knight Pos:0,0 Special:false

 ç¬¨ãƒ»src/tests/MinimalUnit.test.js (1 test) 8ms
 ç¬¨ãƒ»src/tests/WanderBehavior.test.js (2 tests) 12ms
 ç¬¨ãƒ»src/tests/JobAssignment.test.js (3 tests) 11ms
 ç¬¨ãƒ»src/tests/SquadMemory.test.js (2 tests) 7ms
stdout | src/tests/WrapDistance.test.js > Unit Distance Wrap Logic > should calculate short distance across wrap (0,0 -> 79,0)
[UnitCore.js] Unit Created ID:0 Role:undefined Pos:0,0 Special:false

stdout | src/tests/WrapDistance.test.js > Unit Distance Wrap Logic > should calculate diagonal wrap correctly (0,0 -> 79,79)
[UnitCore.js] Unit Created ID:1 Role:undefined Pos:0,0 Special:false

 ç¬¨ãƒ»src/tests/WrapDistance.test.js (2 tests) 11ms
stdout | src/tests/ComplexInteraction.test.js > Complex Job Interaction and Cancellation > should immediately stop unit when job is cancelled mid-approach
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false
Game constructor called
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 114,68. Force:false
[Terrain] Building Added: cave at (114, 68) Size:1x1. Total: 1
GoblinManager: Cave registered at 114,68 
[GoblinManager] Clan clan_cave_114_68 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 63,103. Force:false
[Terrain] Building Added: cave at (63, 103) Size:1x1. Total: 2
GoblinManager: Cave registered at 63,103 
[GoblinManager] Clan clan_cave_63_103 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 50,146. Force:false
[Terrain] Building Added: cave at (50, 146) Size:1x1. Total: 3
GoblinManager: Cave registered at 50,146 
[GoblinManager] Clan clan_cave_50_146 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 1,17. Force:false
[Terrain] Building Added: cave at (1, 17) Size:1x1. Total: 4
GoblinManager: Cave registered at 1,17 
[GoblinManager] Clan clan_cave_1_17 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 149,13. Force:false
[Terrain] Building Added: cave at (149, 13) Size:1x1. Total: 5
GoblinManager: Cave registered at 149,13 
[GoblinManager] Clan clan_cave_149_13 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 8 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

 ç¬¨ãƒ»src/tests/Minimal.test.js (1 test) 3ms
stdout | src/tests/ComplexInteraction.test.js > Complex Job Interaction and Cancellation > should immediately stop unit when job is cancelled mid-approach
[Game] Request Added: build at (20,0) ID:req_0
[Game] forceAssignRequest FOUND Unit 1 (DistSq:400). Scanned:1
[Game] Force-Assigned Request req_0 to Unit 1 (Score: 400.0)
[Game] Cancelling active job for Unit 1
[Game] forceAssignRequest FAILED for Req req_0. Scanned:1 (RoleSkipped:0) Busy:1 Valid:0. TotalUnits:1
[Game] Request Canceled at 20,0 (Target: 20,0)

stdout | src/tests/ComplexInteraction.test.js > Complex Job Interaction and Cancellation > should pickup NEXT job if current is cancelled
[UnitCore.js] Unit Created ID:1 Role:worker Pos:0,0 Special:false
Game constructor called
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 65,79. Force:false
[Terrain] Building Added: cave at (65, 79) Size:1x1. Total: 1
GoblinManager: Cave registered at 65,79 
[GoblinManager] Clan clan_cave_65_79 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 117,69. Force:false
[Terrain] Building Added: cave at (117, 69) Size:1x1. Total: 2
GoblinManager: Cave registered at 117,69 
[GoblinManager] Clan clan_cave_117_69 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 98,62. Force:false
[Terrain] Building Added: cave at (98, 62) Size:1x1. Total: 3
GoblinManager: Cave registered at 98,62 
[GoblinManager] Clan clan_cave_98_62 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 117,51. Force:false
[Terrain] Building Added: cave at (117, 51) Size:1x1. Total: 4
GoblinManager: Cave registered at 117,51 
[GoblinManager] Clan clan_cave_117_51 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 73,64. Force:false
[Terrain] Building Added: cave at (73, 64) Size:1x1. Total: 5
GoblinManager: Cave registered at 73,64 
[GoblinManager] Clan clan_cave_73_64 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 7 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

stdout | src/tests/ComplexInteraction.test.js > Complex Job Interaction and Cancellation > should pickup NEXT job if current is cancelled
[Game] Request Added: build at (20,0) ID:req_0
[Game] forceAssignRequest FOUND Unit 1 (DistSq:400). Scanned:1
[Game] Force-Assigned Request req_0 to Unit 1 (Score: 400.0)
[Game] Request Added: build at (-20,0) ID:req_1
[Game] forceAssignRequest FAILED for Req req_1. Scanned:1 (RoleSkipped:0) Busy:1 Valid:0. TotalUnits:1
[Game] forceAssignRequest FAILED for Req req_1. Scanned:1 (RoleSkipped:0) Busy:1 Valid:0. TotalUnits:1
[Game] Cancelling active job for Unit 1
[Game] forceAssignRequest FAILED for Req req_0. Scanned:1 (RoleSkipped:0) Busy:1 Valid:0. TotalUnits:1
[Game] Request Canceled at 20,0 (Target: 20,0)

stdout | src/tests/JobIdempotency.test.js > Job Assignment Idempotency > should NOT reset movement if claiming the same job twice
[UnitCore.js] Unit Created ID:0 Role:worker Pos:0,0 Special:false
Game constructor called
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 93,13. Force:false
[Terrain] Building Added: cave at (93, 13) Size:1x1. Total: 1
GoblinManager: Cave registered at 93,13 
[GoblinManager] Clan clan_cave_93_13 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 2,147. Force:false
[Terrain] Building Added: cave at (2, 147) Size:1x1. Total: 2
GoblinManager: Cave registered at 2,147 
[GoblinManager] Clan clan_cave_2_147 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 56,127. Force:false
[Terrain] Building Added: cave at (56, 127) Size:1x1. Total: 3
GoblinManager: Cave registered at 56,127 
[GoblinManager] Clan clan_cave_56_127 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 105,22. Force:false
[Terrain] Building Added: cave at (105, 22) Size:1x1. Total: 4
GoblinManager: Cave registered at 105,22 
[GoblinManager] Clan clan_cave_105_22 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 13,13. Force:false
[Terrain] Building Added: cave at (13, 13) Size:1x1. Total: 5
GoblinManager: Cave registered at 13,13 
[GoblinManager] Clan clan_cave_13_13 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 6 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

stderr | src/tests/JobIdempotency.test.js > Job Assignment Idempotency > should NOT reset movement if claiming the same job twice
Compass Error: TypeError: ctx.clearRect is not a function
    at Compass.update (C:/Users/mooya/develop/test/src/Compass.js:43:13)
    at Game.animate (C:/Users/mooya/develop/test/src/Game.js:1390:30)
    at new Game (C:/Users/mooya/develop/test/src/Game.js:237:14)
    at C:/Users/mooya/develop/test/src/tests/JobIdempotency.test.js:51:20
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1240:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1206:10)
    at runHook (file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1511:51)
    at callSuiteHook (file:///C:/Users/mooya/develop/test/node_modules/@vitest/runner/dist/index.js:1517:25)

stderr | src/tests/JobIdempotency.test.js
Compass Error: TypeError: ctx.clearRect is not a function
    at Compass.update (C:/Users/mooya/develop/test/src/Compass.js:43:13)
    at Game.animate (C:/Users/mooya/develop/test/src/Game.js:1390:30)
    at Immediate._onImmediate (file:///C:/Users/mooya/develop/test/node_modules/happy-dom/lib/window/BrowserWindow.js:1354:17)
    at processImmediate (node:internal/timers:485:21)

stderr | src/tests/JobIdempotency.test.js
Compass Error: TypeError: ctx.clearRect is not a function
    at Compass.update (C:/Users/mooya/develop/test/src/Compass.js:43:13)
    at Game.animate (C:/Users/mooya/develop/test/src/Game.js:1390:30)
    at Immediate._onImmediate (file:///C:/Users/mooya/develop/test/node_modules/happy-dom/lib/window/BrowserWindow.js:1354:17)
    at processImmediate (node:internal/timers:485:21)

stderr | src/tests/JobIdempotency.test.js
Compass Error: TypeError: ctx.clearRect is not a function
    at Compass.update (C:/Users/mooya/develop/test/src/Compass.js:43:13)
    at Game.animate (C:/Users/mooya/develop/test/src/Game.js:1390:30)
    at Immediate._onImmediate (file:///C:/Users/mooya/develop/test/node_modules/happy-dom/lib/window/BrowserWindow.js:1354:17)
    at processImmediate (node:internal/timers:485:21)

 ç¬¨ãƒ»src/tests/JobIdempotency.test.js (1 test) 5156ms
     ç¬¨ãƒ»should NOT reset movement if claiming the same job twice  5154ms
stderr | Game.animate (C:\Users\mooya\develop\test\src\Game.js:1391:35)
Compass Error: TypeError: ctx.clearRect is not a function
    at Compass.update (C:/Users/mooya/develop/test/src/Compass.js:43:13)
    at Game.animate (C:/Users/mooya/develop/test/src/Game.js:1390:30)
    at Immediate._onImmediate (file:///C:/Users/mooya/develop/test/node_modules/happy-dom/lib/window/BrowserWindow.js:1354:17)
    at processImmediate (node:internal/timers:485:21)

stderr | Game.animate (C:\Users\mooya\develop\test\src\Game.js:1391:35)
Compass Error: TypeError: ctx.clearRect is not a function
    at Compass.update (C:/Users/mooya/develop/test/src/Compass.js:43:13)
    at Game.animate (C:/Users/mooya/develop/test/src/Game.js:1390:30)
    at Immediate._onImmediate (file:///C:/Users/mooya/develop/test/node_modules/happy-dom/lib/window/BrowserWindow.js:1354:17)
    at processImmediate (node:internal/timers:485:21)

stdout | src/tests/ComplexInteraction.test.js > Complex Job Interaction and Cancellation > should handle cancellation while Working (arrived)
[UnitCore.js] Unit Created ID:2 Role:worker Pos:0,0 Special:false
Game constructor called
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 54,147. Force:false
[Terrain] Building Added: cave at (54, 147) Size:1x1. Total: 1
GoblinManager: Cave registered at 54,147 
[GoblinManager] Clan clan_cave_54_147 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 42,156. Force:false
[Terrain] Building Added: cave at (42, 156) Size:1x1. Total: 2
GoblinManager: Cave registered at 42,156 
[GoblinManager] Clan clan_cave_42_156 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 45,24. Force:false
[Terrain] Building Added: cave at (45, 24) Size:1x1. Total: 3
GoblinManager: Cave registered at 45,24 
[GoblinManager] Clan clan_cave_45_24 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 114,149. Force:false
[Terrain] Building Added: cave at (114, 149) Size:1x1. Total: 4
GoblinManager: Cave registered at 114,149 
[GoblinManager] Clan clan_cave_114_149 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 76,117. Force:false
[Terrain] Building Added: cave at (76, 117) Size:1x1. Total: 5
GoblinManager: Cave registered at 76,117 
[GoblinManager] Clan clan_cave_76_117 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 9 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

stdout | src/tests/ComplexInteraction.test.js > Complex Job Interaction and Cancellation > should handle cancellation while Working (arrived)
[Game] Request Added: build at (20,0) ID:req_0
[Game] forceAssignRequest FOUND Unit 1 (DistSq:400). Scanned:1
[Game] Force-Assigned Request req_0 to Unit 1 (Score: 400.0)

 ç¬¶ï½¯ src/tests/ComplexInteraction.test.js (3 tests | 2 failed) 10687ms
     ï¾ƒãƒ»should immediately stop unit when job is cancelled mid-approach 6824ms
     ï¾ƒãƒ»should pickup NEXT job if current is cancelled 1534ms
     ç¬¨ãƒ»should handle cancellation while Working (arrived)  2326ms

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ Failed Suites 10 ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯

 FAIL  src/tests/CombatFixes.test.js [ src/tests/CombatFixes.test.js ]
 FAIL  src/tests/GoblinSpawn.test.js [ src/tests/GoblinSpawn.test.js ]
 FAIL  src/tests/GoblinStats.test.js [ src/tests/GoblinStats.test.js ]
 FAIL  src/tests/GoblinTypes.test.js [ src/tests/GoblinTypes.test.js ]
 FAIL  src/tests/Movement.test.js [ src/tests/Movement.test.js ]
 FAIL  src/tests/NightLogic.test.js [ src/tests/NightLogic.test.js ]
 FAIL  src/tests/ReproductionJitabata.test.js [ src/tests/ReproductionJitabata.test.js ]
 FAIL  src/tests/TargetingPriority.test.js [ src/tests/TargetingPriority.test.js ]
 FAIL  src/tests/Unit.test.js [ src/tests/Unit.test.js ]
 FAIL  src/tests/UnitMigration.test.js [ src/tests/UnitMigration.test.js ]
Error: Failed to parse source for import analysis because the content contains invalid JS syntax. If you are using JSX, make sure to name the file with the .jsx or .tsx extension.
  Plugin: vite:import-analysis
  File: C:/Users/mooya/develop/test/src/tests/TestHelper.js:227:4
  237 |  
  238 |  findPath(sx, sz, ex, ez) {
  239 |      return [{ x: sx, z: sz }, { x: ex, z: ez }];
      |  ^
  240 |  }
  241 |  }
 ç¬¶ï½¯ TransformPluginContext._formatLog node_modules/vite/dist/node/chunks/config.js:29647:43
 ç¬¶ï½¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/config.js:29644:14
 ç¬¶ï½¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/config.js:27730:10
 ç¬¶ï½¯ EnvironmentPluginContainer.transform node_modules/vite/dist/node/chunks/config.js:29445:14
 ç¬¶ï½¯ loadAndTransform node_modules/vite/dist/node/chunks/config.js:23316:26
 ç¬¶ï½¯ fetchModule node_modules/vite/dist/node/chunks/config.js:34641:15

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[1/17]ç«¡ï½¯


ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ Failed Tests 7 ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯

 FAIL  src/tests/CombatBalance.test.js > Combat Balance Simulation > Load Game Persistence - Should resume movement
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 ç¬¶ï½¯ src/tests/CombatBalance.test.js:269:29
    267|         // Verify Restoration
    268|         // Verify Restoration
    269|         expect(u2.isMoving).toBe(true); // Should resume movement
       |                             ^
    270|         // Note: triggerMove calculates NEXT TILE, not final destinatiçª¶ï½¦
    271|         // From 0,0 to 10,10. dx=10, dz=10. 10 > 10 is false. Z incremçª¶ï½¦

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[2/17]ç«¡ï½¯

 FAIL  src/tests/CombatRequestHandoff.test.js > Request Responsiveness & Combat Handoff > Worker releases job when died
Error: Failed to parse source for import analysis because the content contains invalid JS syntax. If you are using JSX, make sure to name the file with the .jsx or .tsx extension.
  Plugin: vite:import-analysis
  File: C:/Users/mooya/develop/test/src/tests/TestHelper.js:227:4
  237 |  
  238 |  findPath(sx, sz, ex, ez) {
  239 |      return [{ x: sx, z: sz }, { x: ex, z: ez }];
      |  ^
  240 |  }
  241 |  }
 ç¬¶ï½¯ TransformPluginContext._formatLog node_modules/vite/dist/node/chunks/config.js:29647:43
 ç¬¶ï½¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/config.js:29644:14
 ç¬¶ï½¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/config.js:27730:10
 ç¬¶ï½¯ EnvironmentPluginContainer.transform node_modules/vite/dist/node/chunks/config.js:29445:14
 ç¬¶ï½¯ loadAndTransform node_modules/vite/dist/node/chunks/config.js:23316:26

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[3/17]ç«¡ï½¯

 FAIL  src/tests/ComplexInteraction.test.js > Complex Job Interaction and Cancellation > should immediately stop unit when job is cancelled mid-approach
TypeError: this.terrain.checkFlatArea is not a function
 ç¬¶ï½¯ Unit.tryBuildStructure src/Unit.js:2066:34
    2064|         if (lowFood || lowFarms) {
    2065|             if (Math.random() < 0.3) {
    2066|                 if (this.terrain.checkFlatArea(x, z, 2)) {
       |                                  ^
    2067|                     if (this.buildFarm(time)) return true;
    2068|                 }
 ç¬¶ï½¯ Unit.onMoveFinished src/Unit.js:1561:28
 ç¬¶ï½¯ Unit.updateMovement src/Entity.js:216:22
 ç¬¶ï½¯ Unit.updateLogic src/Unit.js:587:26
 ç¬¶ï½¯ src/tests/ComplexInteraction.test.js:72:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[4/17]ç«¡ï½¯

 FAIL  src/tests/ComplexInteraction.test.js > Complex Job Interaction and Cancellation > should pickup NEXT job if current is cancelled
TypeError: this.terrain.checkFlatArea is not a function
 ç¬¶ï½¯ Unit.tryBuildStructure src/Unit.js:2073:26
    2071| 
    2072|         // 4. House Logic (Now 2x2)
    2073|         if (this.terrain.checkFlatArea(x, z, 2)) {
       |                          ^
    2074|             if (cell.moisture > 0.8) {
    2075|                 return false;
 ç¬¶ï½¯ Unit.onMoveFinished src/Unit.js:1561:28
 ç¬¶ï½¯ Unit.updateMovement src/Entity.js:216:22
 ç¬¶ï½¯ Unit.updateLogic src/Unit.js:587:26
 ç¬¶ï½¯ src/tests/ComplexInteraction.test.js:107:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[5/17]ç«¡ï½¯

 FAIL  src/tests/MigrationConflict.test.js > Migration Conflict Regression (Jitabata Bug) > should allow Migration Logic to control repeated movement
TypeError: this.terrain.checkFlatArea is not a function
 ç¬¶ï½¯ Unit.tryBuildStructure src/Unit.js:2073:26
    2071| 
    2072|         // 4. House Logic (Now 2x2)
    2073|         if (this.terrain.checkFlatArea(x, z, 2)) {
       |                          ^
    2074|             if (cell.moisture > 0.8) {
    2075|                 return false;

 ç¬¶ï½¯ Unit.onMoveFinished src/Unit.js:1561:28
 ç¬¶ï½¯ Unit.updateMovement src/Entity.js:216:22
 ç¬¶ï½¯ Unit.updateLogic src/Unit.js:587:26
 ç¬¶ï½¯ src/tests/MigrationConflict.test.js:103:18

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[6/17]ç«¡ï½¯

 FAIL  src/tests/MigrationImprovement.test.js > Migration Improvements > should interrupt migration if enemy is found (Priority)
AssertionError: expected 'Idle' to be 'Fighting' // Object.is equality

Expected: "Fighting"
Received: "Idle"

 ç¬¶ï½¯ src/tests/MigrationImprovement.test.js:138:29
    136|         unit.updateLogic(1, 1.0, false, [], [], []);
    137| 
    138|         expect(unit.action).toBe('Fighting');
       |                             ^
    139|         expect(unit.migrationTarget).toBeNull();
    140| 

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[7/17]ç«¡ï½¯

 FAIL  src/tests/RubberBanding.test.js > Rubber-banding and Chaining Verification > should use visual position for chaining the next job
TypeError: Cannot read properties of undefined (reading '20')
 ç¬¶ï½¯ Unit.tryBuildStructure src/Unit.js:2020:39
    2018|         const x = this.gridX;
    2019|         const z = this.gridZ;
    2020|         const cell = this.terrain.grid[x][z];
       |                                       ^
    2021| 
    2022|         if (cell.hasBuilding) return;
 ç¬¶ï½¯ Unit.onMoveFinished src/Unit.js:1561:28
 ç¬¶ï½¯ Unit.updateMovement src/Entity.js:216:22
 ç¬¶ï½¯ src/tests/RubberBanding.test.js:104:14

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[8/17]ç«¡ï½¯

 Test Files  16 failed | 45 passed (61)
      Tests  7 failed | 142 passed (149)
   Start at  16:08:13
   Duration  16.57s (transform 5.98s, setup 2.67s, import 12.04s, tests 48.20s, environment 83.32s)

