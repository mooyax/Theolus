
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/mooya/develop/test[39m

[90mstdout[2m | src/tests/RubberBanding.test.js[2m > [22m[2mRubber-banding and Chaining Verification[2m > [22m[2mshould NOT snap back when arriving at a job during mid-move
[22m[39m[JobState] Entered. Target: build. Resume: UnitWanderState
[JobState] Ownership LOST for Job 1. Someone snatched it or it was unassigned. Switching to Idle.

 [31mç¬¶ï½¯[39m src/tests/RubberBanding.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 33[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should NOT snap back when arriving at a job during mid-move[39m[32m 23[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should use visual position for chaining the next job[39m[32m 8[2mms[22m[39m
[90mstdout[2m | src/tests/UnitSnatch.test.js[2m > [22m[2mUnit Snatching and Race Conditions[2m > [22m[2mshould stop and wander if another unit snatches its job
[22m[39m[JobState] Entered. Target: build. Resume: UnitWanderState
[JobState] Ownership LOST for Job job1. Someone snatched it or it was unassigned. Switching to Idle.
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=Wandering

 [31mç¬¶ï½¯[39m src/tests/WorkerRequest.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 44[2mms[22m[39m
     [32mç¬¨ãƒ»[39m Unit finds and claims request when idle[32m 21[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Unit moves to target request[39m[32m 16[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m Unit completes request upon arrival[39m[32m 5[2mms[22m[39m
[90mstdout[2m | src/tests/UnitSnatch.test.js[2m > [22m[2mUnit Snatching and Race Conditions[2m > [22m[2mshould stop if the job is completed by someone else
[22m[39m[JobState] Entered. Target: build. Resume: UnitWanderState
[JobState] Job job1 already finished elsewhere. Switching to Idle.
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=Wandering

 [31mç¬¶ï½¯[39m src/tests/UnitAISearch.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 29[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should use Spatial Search to find goblin[32m 11[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should find Base using Spatial Search[39m[32m 16[2mms[22m[39m
 [31mç¬¶ï½¯[39m src/tests/UnitSnatch.test.js [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 43[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should stop and wander if another unit snatches its job[39m[32m 38[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should stop if the job is completed by someone else[32m 3[2mms[22m[39m
[90mstdout[2m | src/tests/CombatRequestHandoff.test.js[2m > [22m[2mRequest Responsiveness & Combat Handoff[2m > [22m[2mWorker releases job when died
[22m[39mRun Logic...
[JobState] Entered. Target: undefined. Resume: UnitWanderState
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=Going to Work
Simulate Death...
Unit 0 died. Releasing job req_1
Unit died.

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Goblin if it is much closer than Building
[22m[39m[DEBUG] Calling updateLogic...
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=undefined
[ActorDebug] Grid: 0,0 Target: 10,0 Diff: 10,0
[ActorDebug] Next: 1,0
[Unit 0] Moving onto Rock at 1,0 H:10 (Speed Penalty)
[ActorDebug] Check Move 1,0 -> true
[DEBUG] updateLogic finished.
[DEBUG] Targets: G=g1, B=undefined

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould prioritize Building if distances are very close (Siege Mode)
[22m[39m[ActorDebug] Grid: 0,0 Target: 7,0 Diff: 7,0
[ActorDebug] Next: 1,0
[Unit 2] Moving onto Rock at 1,0 H:10 (Speed Penalty)
[ActorDebug] Check Move 1,0 -> true

[90mstdout[2m | src/tests/TargetingPriority.test.js[2m > [22m[2mUnit Targeting Priority[2m > [22m[2mshould NOT auto-target Huts without orders (Workers are passive)
[22m[39mUnit 4 attacking goblin_hut. HP: 96

[90mstdout[2m | src/tests/SimpleRegion.test.js[2m > [22m[2mSimple Region Connectivity[2m > [22m[2mshould identify a single island
[22m[39mRunning calculateRegions...
Done.
Region ID at 5,5: 1

 [31mç¬¶ï½¯[39m src/tests/TargetingPriority.test.js [2m([22m[2m3 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 50[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should prioritize Goblin if it is much closer than Building[32m 12[2mms[22m[39m
     [32mç¬¨ãƒ»[39m should prioritize Building if distances are very close (Siege Mode)[32m 6[2mms[22m[39m
[31m     [31mï¾ƒãƒ»[31m should NOT auto-target Huts without orders (Workers are passive)[39m[32m 28[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/SimpleRegion.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 274[2mms[22m[39m
[90mstdout[2m | src/tests/Hotspot.test.js[2m > [22m[2mGlobal Battle Hotspots Logic[2m > [22m[2mClusters nearby battle reports
[22m[39m[Game] New Battle Hotspot at 10,10 (Region:1)

[90mstdout[2m | src/tests/CombatRequestHandoff.test.js[2m > [22m[2mRequest Responsiveness & Combat Handoff[2m > [22m[2mforceAssignRequest prioritizes idle unit over busy unit
[22m[39m[Game] forceAssignRequest FOUND Unit 2 (DistSq:2888). Scanned:2
[Game] Force-Assigned Request req_hot to Unit 2 (Score: 2888.0)

[90mstdout[2m | src/tests/Hotspot.test.js[2m > [22m[2mGlobal Battle Hotspots Logic[2m > [22m[2mDecays intensity
[22m[39m[Game] New Battle Hotspot at 10,10 (Region:1)

[90mstdout[2m | src/tests/Hotspot.test.js[2m > [22m[2mGlobal Battle Hotspots Logic[2m > [22m[2mMobilizes idle squads to intense hotspots (Updated Threshold)
[22m[39m[Game] Mobilizing Squad 1 to Hotspot at 100,20 (Intensity:100.0)

 [32mç¬¨ãƒ»[39m src/tests/CombatRequestHandoff.test.js [2m([22m[2m2 tests[22m[2m)[22m[33m 643[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m forceAssignRequest prioritizes idle unit over busy unit [33m 383[2mms[22m[39m
[90mstdout[2m | src/tests/Hotspot.test.js[2m > [22m[2mGlobal Battle Hotspots Logic[2m > [22m[2mMobilizes idle squads
[22m[39m[Game] Mobilizing Squad 1 to Hotspot at 50,50 (Intensity:100.0)

 [32mç¬¨ãƒ»[39m src/tests/WorkerReachability.test.js [2m([22m[2m2 tests[22m[2m)[22m[33m 655[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m findBestRequest filters out unreachable jobs [33m 637[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/Hotspot.test.js [2m([22m[2m6 tests[22m[2m)[22m[33m 551[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m Clusters nearby battle reports [33m 530[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinFixes.test.js[2m > [22m[2mGoblin Fixes Verification[2m > [22m[2mGoblinManager difficulty scaling increases stronger goblin probability
[22m[39mGoblinManager: Generation started...
GoblinManager: Generated 0 goblin caves after 5000 attempts.
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
Lvl 1 - King: 15, Shaman: 49, Hob: 82
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
îžè˜ Goblin King Spawned!
Lvl 20 - King: 55, Shaman: 134, Hob: 281

 [32mç¬¨ãƒ»[39m src/tests/GoblinFixes.test.js [2m([22m[2m4 tests[22m[2m)[22m[33m 658[2mms[22m[39m
[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould tag new requests with createdAt timestamp
[22m[39mGame constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 88,81. Force:false
[Terrain] Building Added: cave at (88, 81) Size:1x1. Total: 1
GoblinManager: Cave registered at 88,81 
[GoblinManager] Clan clan_cave_88_81 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 21,81. Force:false
[Terrain] Building Added: cave at (21, 81) Size:1x1. Total: 2
GoblinManager: Cave registered at 21,81 
[GoblinManager] Clan clan_cave_21_81 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 149,92. Force:false
[Terrain] Building Added: cave at (149, 92) Size:1x1. Total: 3
GoblinManager: Cave registered at 149,92 
[GoblinManager] Clan clan_cave_149_92 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 53,48. Force:false
[Terrain] Building Added: cave at (53, 48) Size:1x1. Total: 4
GoblinManager: Cave registered at 53,48 
[GoblinManager] Clan clan_cave_53_48 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 155,65. Force:false
[Terrain] Building Added: cave at (155, 65) Size:1x1. Total: 5
GoblinManager: Cave registered at 155,65 
[GoblinManager] Clan clan_cave_155_65 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 17 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould tag new requests with createdAt timestamp
[22m[39m[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0

[90mstdout[2m | src/tests/ForceBuild.test.js[2m > [22m[2mTerrain Force Build Logic[2m > [22m[2mshould clear existing buildings when placing a new one
[22m[39m[Terrain] addBuilding: house at 10,10. Force:false
[Terrain] Building Added: house at (10, 10) Size:2x2. Total: 1
[Terrain] Clearing obstacle: house for new construction.
[Terrain] Building removed at 10,10
[Terrain] addBuilding: barracks at 10,10. Force:false
[Terrain] Building Added: barracks at (10, 10) Size:3x3. Total: 1

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould cleanup expired pending requests
[22m[39mGame constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 91,129. Force:false
[Terrain] Building Added: cave at (91, 129) Size:1x1. Total: 1
GoblinManager: Cave registered at 91,129 
[GoblinManager] Clan clan_cave_91_129 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 18,39. Force:false
[Terrain] Building Added: cave at (18, 39) Size:1x1. Total: 2
GoblinManager: Cave registered at 18,39 
[GoblinManager] Clan clan_cave_18_39 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 51,112. Force:false
[Terrain] Building Added: cave at (51, 112) Size:1x1. Total: 3
GoblinManager: Cave registered at 51,112 
[GoblinManager] Clan clan_cave_51_112 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 78,61. Force:false
[Terrain] Building Added: cave at (78, 61) Size:1x1. Total: 4
GoblinManager: Cave registered at 78,61 
[GoblinManager] Clan clan_cave_78_61 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 39,13. Force:false
[Terrain] Building Added: cave at (39, 13) Size:1x1. Total: 5
GoblinManager: Cave registered at 39,13 
[GoblinManager] Clan clan_cave_39_13 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 13 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould cleanup expired pending requests
[22m[39m[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Added: raise at (20,20) ID:req_1
[Game] forceAssignRequest FAILED for Req req_1. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] forceAssignRequest FAILED for Req req_1. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request req_0 pending for 0.3s.
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Timed Out: raise ID:req_0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould save game data correctly
[22m[39mGame constructor called

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould save game data correctly
[22m[39mSaving Game Data: {
  slotId: [33m1[39m,
  timestamp: [33m1766974462193[39m,
  resources: { grain: [33m100[39m, fish: [33m50[39m, meat: [33m25[39m },
  gameTime: [33m12[39m,
  gameTotalTime: [33m0[39m,
  currentSeasonIndex: [90mundefined[39m,
  daysPassed: [90mundefined[39m,
  terrain: {
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m2[39m,
    h: [
       [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m5[39m,  [33m5[39m,  [33m4[39m,  [33m4[39m,  [33m3[39m,  [33m2[39m,  [33m2[39m,  [33m1[39m,
       [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m0[39m,  [33m0[39m, [33m-0[39m, [33m-1[39m, [33m-1[39m, [33m-2[39m, [33m-3[39m,
      [33m-3[39m, [33m-3[39m, [33m-2[39m, [33m-2[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m, [33m-1[39m, [33m-0[39m,  [33m0[39m,
       [33m0[39m,  [33m0[39m,  [33m0[39m,  [33m0[39m, [33m-0[39m, [33m-0[39m, [33m-1[39m, [33m-1[39m, [33m-2[39m, [33m-2[39m, [33m-3[39m, [33m-3[39m,
      [33m-3[39m, [33m-2[39m, [33m-2[39m, [33m-1[39m, [33m-0[39m,  [33m0[39m,  [33m1[39m,  [33m1[39m,  [33m2[39m,  [33m2[39m,  [33m3[39m,  [33m4[39m,
       [33m4[39m,  [33m4[39m,  [33m4[39m,  [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,
       [33m6[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m4[39m,  [33m4[39m,  [33m4[39m,  [33m3[39m,  [33m3[39m,  [33m2[39m,  [33m2[39m,  [33m1[39m,
       [33m1[39m, [33m-0[39m, [33m-1[39m, [33m-2[39m, [33m-2[39m, [33m-3[39m, [33m-4[39m, [33m-4[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m,
      [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m,
      ... 25500 more items
    ],
    n: [
       [33m0.02[39m, [33m-0.01[39m,  [33m0.02[39m,    [33m-0[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.01[39m,
      [33m-0.01[39m,    [33m-0[39m, [33m-0.01[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.02[39m,  [33m0.02[39m,
       [33m0.01[39m, [33m-0.02[39m,     [33m0[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.01[39m,    [33m-0[39m,
      [33m-0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.01[39m,     [33m0[39m,    [33m-0[39m,     [33m0[39m,
         [33m-0[39m, [33m-0.02[39m,    [33m-0[39m,     [33m0[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.02[39m, [33m-0.01[39m, [33m-0.02[39m,
       [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m, [33m-0.02[39m,     [33m0[39m,  [33m0.01[39m,    [33m-0[39m,  [33m0.02[39m,    [33m-0[39m,
       [33m0.01[39m, [33m-0.01[39m,    [33m-0[39m,  [33m0.01[39m,    [33m-0[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.02[39m, [33m-0.01[39m,
       [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.02[39m,    [33m-0[39m,  [33m0.01[39m, [33m-0.02[39m,  [33m0.02[39m,
      [33m-0.01[39m, [33m-0.02[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.02[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m,
          [33m0[39m,     [33m0[39m, [33m-0.01[39m, [33m-0.02[39m,  [33m0.01[39m,  [33m0.01[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.02[39m,
         [33m-0[39m,  [33m0.01[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.02[39m, [33m-0.02[39m,    [33m-0[39m,     [33m0[39m,  [33m0.02[39m,
         [33m-0[39m,
      ... 25500 more items
    ],
    b: [],
    m: [
      [33m0.34[39m, [33m0.35[39m, [33m0.38[39m, [33m0.41[39m, [33m0.44[39m, [33m0.47[39m, [33m0.49[39m, [33m0.51[39m, [33m0.53[39m, [33m0.55[39m,
      [33m0.57[39m, [33m0.59[39m, [33m0.61[39m, [33m0.62[39m, [33m0.63[39m, [33m0.65[39m, [33m0.66[39m, [33m0.66[39m, [33m0.66[39m, [33m0.66[39m,
      [33m0.66[39m, [33m0.67[39m, [33m0.68[39m, [33m0.69[39m,  [33m0.7[39m,  [33m0.7[39m, [33m0.71[39m, [33m0.72[39m, [33m0.72[39m, [33m0.72[39m,
      [33m0.72[39m, [33m0.71[39m, [33m0.71[39m, [33m0.71[39m, [33m0.69[39m, [33m0.68[39m, [33m0.66[39m, [33m0.64[39m, [33m0.63[39m, [33m0.62[39m,
      [33m0.62[39m, [33m0.61[39m, [33m0.61[39m, [33m0.62[39m, [33m0.62[39m, [33m0.62[39m, [33m0.62[39m, [33m0.61[39m, [33m0.61[39m,  [33m0.6[39m,
       [33m0.6[39m, [33m0.61[39m, [33m0.61[39m, [33m0.61[39m, [33m0.62[39m, [33m0.62[39m, [33m0.62[39m, [33m0.61[39m,  [33m0.6[39m, [33m0.58[39m,
      [33m0.57[39m, [33m0.57[39m, [33m0.56[39m, [33m0.56[39m, [33m0.56[39m, [33m0.56[39m, [33m0.57[39m, [33m0.57[39m, [33m0.56[39m, [33m0.54[39m,
      [33m0.51[39m, [33m0.48[39m, [33m0.46[39m, [33m0.45[39m, [33m0.43[39m, [33m0.41[39m,  [33m0.4[39m, [33m0.39[39m, [33m0.39[39m, [33m0.38[39m,
      [33m0.38[39m, [33m0.39[39m,  [33m0.4[39m, [33m0.41[39m, [33m0.42[39m, [33m0.43[39m, [33m0.44[39m, [33m0.45[39m, [33m0.46[39m, [33m0.47[39m,
      [33m0.48[39m, [33m0.49[39m, [33m0.49[39m, [33m0.49[39m, [33m0.48[39m, [33m0.47[39m, [33m0.47[39m, [33m0.47[39m, [33m0.48[39m, [33m0.49[39m,
      ... 25500 more items
    ]
  },
  units: [],
  goblinManager: {},
  camera: {
    position: { x: [33m20[39m, y: [33m20[39m, z: [33m20[39m },
    zoom: [33m1[39m,
    target: { x: [90mundefined[39m, y: [90mundefined[39m, z: [90mundefined[39m }
  },
  requests: []
}
Saved to slot 1 (Compressed). Size: 24001 chars (Original: 307298)

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould NOT cleanup assigned requests even if old
[22m[39mGame constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 90,70. Force:false
[Terrain] Building Added: cave at (90, 70) Size:1x1. Total: 1
GoblinManager: Cave registered at 90,70 
[GoblinManager] Clan clan_cave_90_70 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 14,91. Force:false
[Terrain] Building Added: cave at (14, 91) Size:1x1. Total: 2
GoblinManager: Cave registered at 14,91 
[GoblinManager] Clan clan_cave_14_91 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 113,134. Force:false
[Terrain] Building Added: cave at (113, 134) Size:1x1. Total: 3
GoblinManager: Cave registered at 113,134 
[GoblinManager] Clan clan_cave_113_134 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 25,108. Force:false
[Terrain] Building Added: cave at (25, 108) Size:1x1. Total: 4
GoblinManager: Cave registered at 25,108 
[GoblinManager] Clan clan_cave_25_108 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 29,126. Force:false
[Terrain] Building Added: cave at (29, 126) Size:1x1. Total: 5
GoblinManager: Cave registered at 29,126 
[GoblinManager] Clan clan_cave_29_126 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 9 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould NOT cleanup assigned requests even if old
[22m[39m[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0

[90mstdout[2m | src/tests/GhostHouse.test.js[2m > [22m[2mTerrain Ghost House Test[2m > [22m[2mshould NOT accumulate ghost buildings (cleared during deserialize)
[22m[39m[Terrain] addBuilding: house at 5,5. Force:false
[Terrain] Building Added: house at (5, 5) Size:2x2. Total: 1
Debug: Buildings Count: 1

[90mstdout[2m | src/tests/GhostHouse.test.js[2m > [22m[2mTerrain Ghost House Test[2m > [22m[2mshould NOT accumulate ghost buildings (cleared during deserialize)
[22m[39m[Terrain] Deserializing Legacy Format...

[90mstdout[2m | src/tests/GhostHouse.test.js[2m > [22m[2mTerrain Ghost House Test[2m > [22m[2mshould NOT accumulate ghost buildings (cleared during deserialize)
[22m[39m[Terrain] addBuilding: house at 5,5. Force:true
[Terrain] Building Added: house at (5, 5) Size:2x2. Total: 1

[90mstdout[2m | src/tests/StuckDebug.test.js[2m > [22m[2mUnit Stuck Debugging[2m > [22m[2mshould log reason for blockage
[22m[39m--- Testing Slope Block ---
[Unit 0] Blocked by Slope at 11,10 H:2->6
--- Testing Building Pass ---
--- Testing Water Block ---

 [32mç¬¨ãƒ»[39m src/tests/GhostHouse.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 202[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/StuckDebug.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 171[2mms[22m[39m
[90mstdout[2m | src/tests/ForceBuild.test.js[2m > [22m[2mTerrain Force Build Logic[2m > [22m[2mshould clear buildings partially in the way
[22m[39m[Terrain] addBuilding: house at 10,10. Force:false
[Terrain] Building Added: house at (10, 10) Size:2x2. Total: 1
Pre-Barracks Buildings: [ [32m'house'[39m ]
[Terrain] Clearing obstacle: house for new construction.
[Terrain] Building removed at 10,10
[Terrain] addBuilding: barracks at 9,9. Force:false
[Terrain] Building Added: barracks at (9, 9) Size:3x3. Total: 1
Post-Barracks Buildings: [ [32m'barracks'[39m ]

 [32mç¬¨ãƒ»[39m src/tests/ForceBuild.test.js [2m([22m[2m2 tests[22m[2m)[22m[33m 2309[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should clear existing buildings when placing a new one [33m 1271[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should clear buildings partially in the way [33m 1033[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinMobilization.test.js[2m > [22m[2mGoblin Mobilization Verification[2m > [22m[2mtriggerWave should mobilize idle goblins
[22m[39mGoblinManager: Generation started...
GoblinManager: Generated 0 goblin caves after 5000 attempts.

[90mstdout[2m | src/tests/GoblinMobilization.test.js[2m > [22m[2mGoblin Mobilization Verification[2m > [22m[2mtriggerWave should mobilize idle goblins
[22m[39m[GoblinManager] TRIGGERING WAVE Level 1 for Clan test_clan!
[Wave] Spawning 1 goblins at cave 10,10 (Lvl 1)
[GoblinManager] Mobilized 2 idle goblins from Clan test_clan to raid target!

 [32mç¬¨ãƒ»[39m src/tests/UnitVisibility.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 115[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinMobilization.test.js[2m > [22m[2mGoblin Mobilization Verification[2m > [22m[2mmobilizeClan should rely on getClanRaidTarget fallback
[22m[39mGoblinManager: Generation started...
GoblinManager: Generated 0 goblin caves after 5000 attempts.

[90mstdout[2m | src/tests/GoblinMobilization.test.js[2m > [22m[2mGoblin Mobilization Verification[2m > [22m[2mmobilizeClan should rely on getClanRaidTarget fallback
[22m[39m[GoblinManager] Mobilized 1 idle goblins from Clan test_clan_fallback to raid target!

stderr | src/tests/GoblinMobilization.test.js
[GoblinManager] Aborting spawn: Grid cell has no building. Self-healing/Destroying Cave.
[GoblinManager] Removing invalid cave at 10,10

 [32mç¬¨ãƒ»[39m src/tests/GoblinMobilization.test.js [2m([22m[2m2 tests[22m[2m)[22m[33m 399[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/SafeSpawn.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 164[2mms[22m[39m
[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould cancel request via Proximity Search
[22m[39mGame constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 117,137. Force:false
[Terrain] Building Added: cave at (117, 137) Size:1x1. Total: 1
GoblinManager: Cave registered at 117,137 
[GoblinManager] Clan clan_cave_117_137 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 34,99. Force:false
[Terrain] Building Added: cave at (34, 99) Size:1x1. Total: 2
GoblinManager: Cave registered at 34,99 
[GoblinManager] Clan clan_cave_34_99 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 87,148. Force:false
[Terrain] Building Added: cave at (87, 148) Size:1x1. Total: 3
GoblinManager: Cave registered at 87,148 
[GoblinManager] Clan clan_cave_87_148 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 109,126. Force:false
[Terrain] Building Added: cave at (109, 126) Size:1x1. Total: 4
GoblinManager: Cave registered at 109,126 
[GoblinManager] Clan clan_cave_109_126 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 46,19. Force:false
[Terrain] Building Added: cave at (46, 19) Size:1x1. Total: 5
GoblinManager: Cave registered at 46,19 
[GoblinManager] Clan clan_cave_46_19 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 7 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

[90mstdout[2m | src/tests/Pathfinding.test.js[2m > [22m[2mTerrain Pathfinding Costs[2m > [22m[2mPrefers a longer flat route over a shorter mountain route
[22m[39mPath Length: 31
Goes through gap: true
Goes through mountain: false

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould cancel request via Proximity Search
[22m[39m[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Added: raise at (20,20) ID:req_1
[Game] forceAssignRequest FAILED for Req req_1. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Canceled at 10,10 (Target: 11,11)

 [32mç¬¨ãƒ»[39m src/tests/Pathfinding.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 112[2mms[22m[39m
[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39mGame constructor called

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39mLoad Started...

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39mLoading slot 1, Raw length: 101
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1766974463345[39m,
  data: {
    resources: { grain: [33m999[39m, fish: [33m888[39m },
    gameTime: [33m6[39m,
    terrain: { logicalWidth: [33m10[39m, logicalDepth: [33m10[39m, grid: [], buildings: [] },
    units: [],
    camera: { position: [36m[Object][39m, target: [36m[Object][39m }
  }
}
Load Game: Data found {
  resources: { grain: [33m999[39m, fish: [33m888[39m },
  gameTime: [33m6[39m,
  terrain: { logicalWidth: [33m10[39m, logicalDepth: [33m10[39m, grid: [], buildings: [] },
  units: [],
  camera: { position: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m }, target: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m } }
}
Clearing 0 projectiles...

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[DEBUG] Terrain.setSeason: Changing from undefined to Spring
[Game] Restored Camera Zoom: 1

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mBuild Priority (Famine)[2m > [22m[2mshould prioritize Farm and ABORT house if farm fails during famine
[22m[39m[ActorDebug] Grid: 5,5 Target: 6,6 Diff: 1,1
[ActorDebug] Next: 5,6
[Unit 2] Moving onto Rock at 5,6 H:10 (Speed Penalty)
[Unit 2] Blocked by Slope at 5,6 H:1->10
[ActorDebug] Check Move 5,6 -> false

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mBuild Priority (Famine)[2m > [22m[2mshould fallback to House if NOT in famine
[22m[39m[ActorDebug] Grid: 5,5 Target: 6,6 Diff: 1,1
[ActorDebug] Next: 5,6
[Unit 3] Moving onto Rock at 5,6 H:10 (Speed Penalty)
[Unit 3] Blocked by Slope at 5,6 H:1->10
[ActorDebug] Check Move 5,6 -> false

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mAdvanced Mechanics - Unit[2m > [22m[2mshould FAIL buildFarm and IMPROVE LAND if moisture is poor (simulated)
[22m[39mFarm construction failed due to soil conditions (Moisture: 0.00, Chance: 0%). Improving Land.
Unit improved land at 5,5. Moisture 0.50 -> 0.50
[ActorDebug] Grid: 5,5 Target: 6,6 Diff: 1,1
[ActorDebug] Next: 5,6
[Unit 8] Moving onto Rock at 5,6 H:10 (Speed Penalty)
[ActorDebug] Check Move 5,6 -> true

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mAdvanced Mechanics - Unit[2m > [22m[2mshould succeed buildFarm if moisture is optimal
[22m[39m[ActorDebug] Grid: 5,5 Target: 6,6 Diff: 1,1
[ActorDebug] Next: 5,6
[Unit 9] Moving onto Rock at 5,6 H:10 (Speed Penalty)
[ActorDebug] Check Move 5,6 -> true

[90mstdout[2m | src/tests/Unit.test.js[2m > [22m[2mUnit Logic[2m > [22m[2mAdvanced Mechanics - Unit[2m > [22m[2mshould check heights during moveRandomly
[22m[39m[ActorDebug] Grid: 5,5 Target: 6,6 Diff: 1,1
[ActorDebug] Next: 5,6
[ActorDebug] Check Move 5,6 -> true

[90mstdout[2m | src/tests/SquadAi.test.js[2m > [22m[2mSquad AI & Region Logic[2m > [22m[2mRegression: Migration Stagnation Fix (Knight)
[22m[39mUnit 2 (knight) finished migrating. Resuming Idle.

 [32mç¬¨ãƒ»[39m src/tests/Unit.test.js [2m([22m[2m8 tests[22m[2m)[22m[32m 52[2mms[22m[39m
[90mstdout[2m | src/tests/SquadAi.test.js[2m > [22m[2mSquad AI & Region Logic[2m > [22m[2mRegression: Migration Stagnation Fix (Worker)
[22m[39mUnit 3 (Worker) migration target invalid for build. Searching nearby...

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

 [32mç¬¨ãƒ»[39m src/tests/SquadAi.test.js [2m([22m[2m5 tests[22m[2m)[22m[32m 39[2mms[22m[39m
[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

 [32mç¬¨ãƒ»[39m src/tests/SpatialSearch.test.js [2m([22m[2m4 tests[22m[2m)[22m[33m 3126[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should register and retrieve an entity [33m 837[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should move entity correctly between cells [33m 767[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should unregister entity [33m 729[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should find nearest entity using spatial search [33m 789[2mms[22m[39m
[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2}

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0
[Scene Audit] Objects: {"Unnamed_PlaneGeometry":2,"[Instanced] BoxGeometry (Active:50000/50000)":3,"[Instanced] ConeGeometry (Active:100000/100000)":1,"[Instanced] BoxGeometry (Active:100000/100000)":2,"[Instanced] CylinderGeometry (Active:50000/50000)":1}

 [32mç¬¨ãƒ»[39m src/tests/StartupCrash.test.js [2m([22m[2m3 tests[22m[2m)[22m[32m 134[2mms[22m[39m
[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

[90mstdout[2m | src/tests/SaveLoad.test.js[2m > [22m[2mSave/Load System[2m > [22m[2mshould load game data correctly
[22m[39m[Game] calling BR.update. BR exists: true, Buildings: 0

 [32mç¬¨ãƒ»[39m src/tests/SaveLoad.test.js [2m([22m[2m2 tests[22m[2m)[22m[33m 2607[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should save game data correctly [33m 1439[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should load game data correctly [33m 1165[2mms[22m[39m
[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould prioritize nearest request when cancelling
[22m[39mGame constructor called
[Mock] createElement called with tag: canvas
SheepManager Refactored: Initialized with Entity-based Sheep.
GoblinManager: Generation started...
[Terrain] addBuilding: cave at 138,29. Force:false
[Terrain] Building Added: cave at (138, 29) Size:1x1. Total: 1
GoblinManager: Cave registered at 138,29 
[GoblinManager] Clan clan_cave_138_29 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 30,144. Force:false
[Terrain] Building Added: cave at (30, 144) Size:1x1. Total: 2
GoblinManager: Cave registered at 30,144 
[GoblinManager] Clan clan_cave_30_144 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 74,114. Force:false
[Terrain] Building Added: cave at (74, 114) Size:1x1. Total: 3
GoblinManager: Cave registered at 74,114 
[GoblinManager] Clan clan_cave_74_114 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 17,91. Force:false
[Terrain] Building Added: cave at (17, 91) Size:1x1. Total: 4
GoblinManager: Cave registered at 17,91 
[GoblinManager] Clan clan_cave_17_91 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
[Terrain] addBuilding: cave at 38,33. Force:false
[Terrain] Building Added: cave at (38, 33) Size:1x1. Total: 5
GoblinManager: Cave registered at 38,33 
[GoblinManager] Clan clan_cave_38_33 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 15 attempts.
GoblinManager: Force spawning Debug Goblin
Spawned initial fish.
FishManager Refactored: Initialized with Entity-based Fish.
[Mock] createElement called with tag: div
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Geometry Initialized (Split Mode)
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
Tower Debug: Generated High-Res Tower Texture + Cap Material
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas
[Mock] createElement called with tag: canvas

[90mstdout[2m | src/tests/RequestLifecycle.test.js[2m > [22m[2mGame Request Lifecycle[2m > [22m[2mshould prioritize nearest request when cancelling
[22m[39m[Game] Request Added: raise at (10,10) ID:req_0
[Game] forceAssignRequest FAILED for Req req_0. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Added: raise at (12,12) ID:req_1
[Game] forceAssignRequest FAILED for Req req_1. Scanned:0 (RoleSkipped:0) Busy:0 Valid:0. TotalUnits:0
[Game] Request Canceled at 10,10 (Target: 10,11)

 [32mç¬¨ãƒ»[39m src/tests/RequestLifecycle.test.js [2m([22m[2m5 tests[22m[2m)[22m[33m 2758[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should tag new requests with createdAt timestamp [33m 641[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should cleanup expired pending requests [33m 474[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should NOT cleanup assigned requests even if old [33m 545[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should cancel request via Proximity Search [33m 591[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should prioritize nearest request when cancelling [33m 504[2mms[22m[39m
stderr | src/tests/Movement.test.js > Terrain Movement and Logic Tests > should set very long moveDuration for Unit on Rock
DEBUG: MoveDur=5.8
DEBUG: Heights Cur=10 Next=12

stderr | src/tests/Movement.test.js > Terrain Movement and Logic Tests > should set normal moveDuration on Flat
DEBUG: Normal MoveDur=0.8

[90mstdout[2m | src/tests/Movement.test.js[2m > [22m[2mTerrain Movement and Logic Tests[2m > [22m[2mshould increase Goblin Hut population and spawn goblin
[22m[39mGoblinManager: Generation started...
GoblinManager: Cave registered at 50,50 
[GoblinManager] Clan clan_cave_50_50 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin
Goblin born from Hut! Clan: test. Global Pop: 1

 [32mç¬¨ãƒ»[39m src/tests/Movement.test.js [2m([22m[2m4 tests[22m[2m)[22m[32m 44[2mms[22m[39m
[90mstdout[2m | src/tests/BuildingDefense.test.js[2m > [22m[2mBuilding Defense Logic[2m > [22m[2mGoblins deal population damage to player buildings
[22m[39mGoblin 0 attacking house. Pop: 9.00

[90mstdout[2m | src/tests/BuildingDefense.test.js[2m > [22m[2mBuilding Defense Logic[2m > [22m[2mGoblins deal structural damage to empty player buildings
[22m[39mGoblin 1 hitting Empty house. HP: 40

[90mstdout[2m | src/tests/BuildingDefense.test.js[2m > [22m[2mBuilding Defense Logic[2m > [22m[2mGoblins destroy player buildings when HP reaches 0
[22m[39mGoblin 2 hitting Empty house. HP: 0
Goblin 2 destroyed house!

[90mstdout[2m | src/tests/BuildingDefense.test.js[2m > [22m[2mBuilding Defense Logic[2m > [22m[2mBuildings retaliate against melee goblins
[22m[39mGoblin 3 attacking house. Pop: 9.92

[90mstdout[2m | src/tests/BuildingDefense.test.js[2m > [22m[2mBuilding Defense Logic[2m > [22m[2mTowers have massive retaliation
[22m[39mGoblin 4 attacking tower. Pop: 4.92

[90mstdout[2m | src/tests/BuildingDefense.test.js[2m > [22m[2mBuilding Defense Logic[2m > [22m[2mNo retaliation for distant attackers (Shamans)
[22m[39mGoblin 5 attacking house. Pop: 9.20

[90mstdout[2m | src/tests/BuildingDefense.test.js[2m > [22m[2mBuilding Defense Logic[2m > [22m[2mStandard HP logic for Goblin buildings
[22m[39mUnit 0 attacking cave. HP: 150

 [32mç¬¨ãƒ»[39m src/tests/BuildingDefense.test.js [2m([22m[2m8 tests[22m[2m)[22m[32m 50[2mms[22m[39m
[90mstdout[2m | src/tests/CombatBalance.test.js[2m > [22m[2mCombat Balance Simulation[2m > [22m[2mKnight vs Single Goblin (1v1) - AI Logic Check
[22m[39m[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=undefined
[Unit Debug] ATTACKING Goblin 0
Goblin (normal) died. ID:0
[AI CHECK] KnightAction: Idle GoblinHP: -64

[90mstdout[2m | src/tests/CombatBalance.test.js[2m > [22m[2mCombat Balance Simulation[2m > [22m[2mWizard vs Single Goblin (1v1) - Wizard should win
[22m[39m[Unit Debug] ATTACKING Goblin 1
Goblin (normal) died. ID:1

[90mstdout[2m | src/tests/CombatBalance.test.js[2m > [22m[2mCombat Balance Simulation[2m > [22m[2mKnight vs Swarm (1v5) - Knight should surviving
[22m[39m[Unit Debug] ATTACKING Goblin g0
Goblin (normal) died. ID:g0
[Unit Debug] ATTACKING Goblin g1
Goblin (normal) died. ID:g1
[Unit Debug] ATTACKING Goblin g2
Goblin (normal) died. ID:g2
[Unit Debug] ATTACKING Goblin g3
Goblin (normal) died. ID:g3
[Unit Debug] ATTACKING Goblin g4
Goblin (normal) died. ID:g4

[90mstdout[2m | src/tests/CombatBalance.test.js[2m > [22m[2mCombat Balance Simulation[2m > [22m[2mLoad Game Persistence - Should resume movement
[22m[39m[ActorDebug] Grid: 0,0 Target: 10,10 Diff: 10,10
[ActorDebug] Next: 0,1
[Unit 3] Moving onto Rock at 0,1 H:10 (Speed Penalty)
[ActorDebug] Check Move 0,1 -> true

 [32mç¬¨ãƒ»[39m src/tests/CombatBalance.test.js [2m([22m[2m4 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstdout[2m | src/tests/Lighting.test.js[2m > [22m[2mBuildingRenderer Lighting[2m > [22m[2mshould turn on barracks lights at night
[22m[39mTower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material
Tower Geometry Initialized (Split Mode)
Tower Debug: Generated High-Res Tower Texture + Cap Material

 [32mç¬¨ãƒ»[39m src/tests/Lighting.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 35[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinTypes.test.js[2m > [22m[2mGoblin Types & Stats[2m > [22m[2mshould correctly spawn types based on random probability
[22m[39mGoblinManager: Generation started...
GoblinManager: Cave registered at 50,50 
[GoblinManager] Clan clan_cave_50_50 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Cave registered at 50,50 
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin
îžè˜ Goblin King Spawned!

 [32mç¬¨ãƒ»[39m src/tests/GoblinTypes.test.js [2m([22m[2m4 tests[22m[2m)[22m[32m 41[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinSpawn.test.js[2m > [22m[2mGoblin Hut Spawning[2m > [22m[2mshould spawn goblin when hut population reaches 10
[22m[39mGoblinManager: Generation started...
GoblinManager: Cave registered at 80,79 
[GoblinManager] Clan clan_cave_80_79 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 63,73 
[GoblinManager] Clan clan_cave_63_73 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 81,20 
[GoblinManager] Clan clan_cave_81_20 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 53,14 
[GoblinManager] Clan clan_cave_53_14 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 14,19 
[GoblinManager] Clan clan_cave_14_19 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin

[90mstdout[2m | src/tests/GoblinSpawn.test.js[2m > [22m[2mGoblin Hut Spawning[2m > [22m[2mshould spawn goblin when hut population reaches 10
[22m[39mGoblin born from Hut! Clan: clan_hut_10_10. Global Pop: 0

[90mstdout[2m | src/tests/GoblinSpawn.test.js[2m > [22m[2mGoblin Hut Spawning[2m > [22m[2mshould NOT spawn if Global Cap is reached
[22m[39mGoblinManager: Generation started...
GoblinManager: Cave registered at 54,72 
[GoblinManager] Clan clan_cave_54_72 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 37,36 
[GoblinManager] Clan clan_cave_37_36 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 59,26 
[GoblinManager] Clan clan_cave_59_26 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 97,39 
[GoblinManager] Clan clan_cave_97_39 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Cave registered at 63,95 
[GoblinManager] Clan clan_cave_63_95 ACTIVATED! Wave 1 in 30s. Target: [1mnull[22m
GoblinManager: Generated 5 goblin caves after 5 attempts.
GoblinManager: Force spawning Debug Goblin

 [32mç¬¨ãƒ»[39m src/tests/GoblinSpawn.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 41[2mms[22m[39m
[90mstdout[2m | src/tests/CombatVerification.test.js[2m > [22m[2mCombat Logic Verification[2m > [22m[2mScenario A: Worker destroys Cave
[22m[39m[MockTerrain] Searching 1 buildings. Range:25 Center:10,10
  - Checking Building at 12,10. Dist:2
    -> Score: 2
Approach Point: 11,10
Unit 1 attacking cave. HP: 196
Cave HP: 196 (Was: 200)

[90mstdout[2m | src/tests/CombatVerification.test.js[2m > [22m[2mCombat Logic Verification[2m > [22m[2mScenario B: Goblin destroys House
[22m[39mGoblin 0 SPAWNED FOR RAIDING! Target: NaN,NaN
[Goblin 0] ENTER RaidState. Goal: NaN,NaN
[MockTerrain] Searching 1 buildings. Range:25 Center:20,20
  - Checking Building at 22,20. Dist:2
    -> Score: 2
[ActorDebug] Grid: 20,20 Target: 21,20 Diff: 1,0
[ActorDebug] Next: 21,20
[ActorDebug] Check Move 21,20 -> true
Goblin 0 attacking house. Pop: 1.92
Goblin 0 attacking house. Pop: 1.84
House Pop: 1.8399999999999999

[90mstdout[2m | src/tests/CombatVerification.test.js[2m > [22m[2mCombat Logic Verification[2m > [22m[2mScenario C: Goblin finds and destroys House
[22m[39m[MockTerrain] Searching 1 buildings. Range:12 Center:8,8
  - Checking Building at 10,10. Dist:2.8284271247461903
    -> Score: 2.8284271247461903
[ActorDebug] Grid: 9,9 Target: 9,9 Diff: 0,0
[ActorDebug] Next: 9,9
[ActorDebug] Check Move 9,9 -> true
Goblin 1 hitting Empty house. HP: 92
[ActorDebug] Grid: 10,9 Target: 10,9 Diff: 0,0
[ActorDebug] Next: 10,9
[ActorDebug] Check Move 10,9 -> true
Goblin 1 hitting Empty house. HP: 84
[Test] House HP reduced to 84

 [32mç¬¨ãƒ»[39m src/tests/CombatVerification.test.js [2m([22m[2m3 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | src/tests/AdvancedUnits.test.js[2m > [22m[2mAdvanced Units[2m > [22m[2mshould allow Wizard to attack from range
[22m[39m[Unit Debug] ATTACKING Goblin g1

 [32mç¬¨ãƒ»[39m src/tests/AdvancedUnits.test.js [2m([22m[2m3 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | src/tests/GoblinDestruction.test.js[2m > [22m[2mGoblin Building Destruction[2m > [22m[2mshould damage building population
[22m[39mGoblin 0 attacking house. Pop: 9.92

[90mstdout[2m | src/tests/GoblinDestruction.test.js[2m > [22m[2mGoblin Building Destruction[2m > [22m[2mshould destroy building when Population AND HP are depleted
[22m[39mGoblin 1 attacking house. Pop: 0.00
Goblin 1 hitting Empty house. HP: -5
Goblin 1 destroyed house!

[90mstdout[2m | src/tests/GoblinDestruction.test.js[2m > [22m[2mGoblin Building Destruction[2m > [22m[2mshould destroy building even if fractional population remains (e.g. 0.5)
[22m[39mGoblin 2 attacking house. Pop: 0.00
Goblin 2 hitting Empty house. HP: -5
Goblin 2 destroyed house!

[90mstdout[2m | src/tests/GoblinDestruction.test.js[2m > [22m[2mGoblin Building Destruction[2m > [22m[2mshould NOT destroy building if population remains >= 1.0
[22m[39mGoblin 3 attacking house. Pop: 6.92

[90mstdout[2m | src/tests/GoblinDestruction.test.js[2m > [22m[2mGoblin Building Destruction[2m > [22m[2mshould take retaliation damage
[22m[39mGoblin 4 attacking house. Pop: 19.92

 [32mç¬¨ãƒ»[39m src/tests/GoblinDestruction.test.js [2m([22m[2m5 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | src/tests/UnitMigration.test.js[2m > [22m[2mUnit Migration Logic[2m > [22m[2mshould migrate after 20 seconds of stagnation
[22m[39mUnit 1 migrating to 51,51 (Region 1)

[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mshould retry migration after 30 seconds timeout
[22m[39mUnit test-migrant migrating to 50,50 (Region undefined)
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true
Unit test-migrant migration timed out. Retrying.
Unit test-migrant migrating to 50,50 (Region undefined)
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true

[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mshould interrupt migration if enemy is found (Priority)
[22m[39mUnit test-migrant migrating to 50,50 (Region undefined)
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true
[Unit test-migrant] Self Defense Triggered! Target: Goblin

 [32mç¬¨ãƒ»[39m src/tests/UnitMigration.test.js [2m([22m[2m3 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mshould stop migrating if construction succeeds
[22m[39mUnit test-migrant migrating to 50,50 (Region undefined)
[ActorDebug] Grid: 50,50 Target: 50,50 Diff: 0,0
[ActorDebug] Next: 50,50
[ActorDebug] Check Move 50,50 -> true

[90mstdout[2m | src/tests/MigrationImprovement.test.js[2m > [22m[2mMigration Improvements[2m > [22m[2mDEBUG: should log blockage reasons correctly
[22m[39m[Unit test-migrant] Blocked by Slope at 21,20 H:2->6

 [32mç¬¨ãƒ»[39m src/tests/ShorelineLoop.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/MigrationImprovement.test.js [2m([22m[2m4 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstdout[2m | src/tests/ForceAssignment.test.js[2m > [22m[2mForce Assignment Integration[2m > [22m[2mshould successfully triggerMove without infinite loop
[22m[39mGame constructor called

[90mstdout[2m | src/tests/ForceAssignment.test.js[2m > [22m[2mForce Assignment Integration[2m > [22m[2mshould successfully triggerMove without infinite loop
[22m[39m[ActorDebug] Grid: 10,10 Target: 15,15 Diff: 5,5
[ActorDebug] Next: 10,11
[ActorDebug] Check Move 10,11 -> true

[90mstdout[2m | src/tests/ForceAssignment.test.js[2m > [22m[2mForce Assignment Integration[2m > [22m[2mshould handle Force Assignment logic block
[22m[39mGame constructor called

[90mstdout[2m | src/tests/ForceAssignment.test.js[2m > [22m[2mForce Assignment Integration[2m > [22m[2mshould handle Force Assignment logic block
[22m[39m[ActorDebug] Grid: 10,10 Target: 12,12 Diff: 2,2
[ActorDebug] Next: 10,11
[ActorDebug] Check Move 10,11 -> true

 [32mç¬¨ãƒ»[39m src/tests/ForceAssignment.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstdout[2m | src/tests/ManaSystem.test.js[2m > [22m[2mMana System[2m > [22m[2mInputManager Integration[2m > [22m[2mshould consume mana on raise terrain
[22m[39m[Input] Request Queued: Raise at 0,0

stderr | src/tests/ManaSystem.test.js > Mana System > InputManager Integration > should consume mana on raise terrain
THREE.Raycaster: Unsupported camera type: undefined
THREE.Raycaster: Unsupported camera type: undefined

stderr | src/tests/ManaSystem.test.js > Mana System > InputManager Integration > should block raise terrain if mana is negative
THREE.Raycaster: Unsupported camera type: undefined
Action Blocked: Not enough Mana (Negative)

 [32mç¬¨ãƒ»[39m src/tests/ManaSystem.test.js [2m([22m[2m5 tests[22m[2m)[22m[32m 20[2mms[22m[39m
[90mstdout[2m | src/tests/WorkerDiversity.test.js[2m > [22m[2mWorker Diversity Spawning[2m > [22m[2mshould spawn diverse roles (Worker/Hunter/Fisher) from a House
[22m[39mSpawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawned fisher linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned hunter linked to house at 10,10 SquadID:null
Spawned worker linked to house at 10,10 SquadID:null
Spawn Distribution (100 runs): { worker: [33m62[39m, hunter: [33m20[39m, fisher: [33m18[39m }

[90mstdout[2m | src/tests/WorkerDiversity.test.js[2m > [22m[2mWorker Diversity Spawning[2m > [22m[2mshould spawn Knights from Barracks
[22m[39mSpawned knight linked to barracks at 10,10 SquadID:null

[90mstdout[2m | src/tests/WorkerDiversity.test.js[2m > [22m[2mWorker Diversity Spawning[2m > [22m[2mshould spawn Wizards from Towers
[22m[39mSpawned wizard linked to tower at 10,10 SquadID:null

 [32mç¬¨ãƒ»[39m src/tests/WorkerDiversity.test.js [2m([22m[2m3 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/Terrain.test.js [2m([22m[2m9 tests[22m[2m)[22m[33m 6554[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should correctly sum housing population excluding farms [33m 853[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should handle massive population overflow loop correctly [33m 830[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should grow crops using simDeltaTime (Not raw deltaTime) [33m 796[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should preserve overflow when harvesting [33m 749[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should scale farm yield based on moisture [33m 630[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should reduce food consumption at night [33m 555[2mms[22m[39m
       [33m[2mç¬¨ãƒ»[22m[39m should consume normal amount during day [33m 759[2mms[22m[39m
         [33m[2mç¬¨ãƒ»[22m[39m should return different colors for seasons [33m 704[2mms[22m[39m
         [33m[2mç¬¨ãƒ»[22m[39m should keep rock color even if dry (desert override check) [33m 673[2mms[22m[39m
[90mstdout[2m | src/tests/NightLogic.test.js[2m > [22m[2mNight Logic - Shelter Entry[2m > [22m[2mWorker should engage pathfinding to House but is likely blocked
[22m[39m[SleepState] Entering Sleep. Night=true
[Unit Debug V3] Start Logic. Night=true, Sleep=true, Action=Sleeping
[Unit Debug V3] Start Logic. Night=true, Sleep=true, Action=Idle

 [32mç¬¨ãƒ»[39m src/tests/NightLogic.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 15[2mms[22m[39m
stderr | src/tests/CombatFixes.test.js > Combat and Logic Fixes > should find target goblin
DEBUG: Heights: 10 10
DEBUG: Distance: 10
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=undefined
[ActorDebug] Grid: 0,0 Target: 10,0 Diff: 10,0
[ActorDebug] Next: 1,0
[Unit 0] Moving onto Rock at 1,0 H:10 (Speed Penalty)
[ActorDebug] Check Move 1,0 -> true
DEBUG: Target Found: g1
DEBUG: Action: Chasing

 [32mç¬¨ãƒ»[39m src/tests/CombatFixes.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 16[2mms[22m[39m
[90mstdout[2m | src/tests/UnitWrapping.test.js[2m > [22m[2mUnit Movement Wrapping[2m > [22m[2mshould move normally for short distances
[22m[39m[ActorDebug] Grid: 10,10 Target: 15,10 Diff: 5,0
[ActorDebug] Next: 11,10
[ActorDebug] Check Move 11,10 -> true

 [32mç¬¨ãƒ»[39m src/tests/UnitWrapping.test.js [2m([22m[2m4 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/UnitLifecycle.test.js [2m([22m[2m5 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/UnitBehavior.test.js [2m([22m[2m8 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/JobAssignment.test.js [2m([22m[2m3 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/SquadMemory.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/WanderBehavior.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | src/tests/CavePersistence.test.js[2m > [22m[2mGoblinManager Cave Persistence[2m > [22m[2mshould update cave Y position when terrain height changes
[22m[39m[GoblinRenderer] Updating 0 goblins.

[90mstdout[2m | src/tests/CavePersistence.test.js[2m > [22m[2mGoblinManager Cave Persistence[2m > [22m[2mshould destroy cave if submerged (height <= 0)
[22m[39m[GoblinManager] Cave destroyed: SUBMERGED(H = -1)
[GoblinRenderer] Updating 0 goblins.

stderr | src/tests/CavePersistence.test.js > GoblinManager Cave Persistence > should destroy cave if submerged (height <= 0)
[GoblinManager] Removing invalid cave at 10,10

 [32mç¬¨ãƒ»[39m src/tests/CavePersistence.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/GoblinStats.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/MinimalUnit.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/Minimal.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 2[2mms[22m[39m
[90mstdout[2m | src/tests/UnitInit.test.js[2m > [22m[2mUnit Initialization and Movement Start[2m > [22m[2mshould NOT freeze if started at time 0
[22m[39m[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=Wandering
[ActorDebug] Grid: 10,10 Target: 5,5 Diff: -5,-5
[ActorDebug] Next: 10,9
[ActorDebug] Check Move 10,9 -> true
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=Moving
Debug Unit Action after 6s: Moving

[90mstdout[2m | src/tests/UnitInit.test.js[2m > [22m[2mUnit Initialization and Movement Start[2m > [22m[2mshould NOT freeze if started at time 0
[22m[39m[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=Moving
[Unit Debug V3] Start Logic. Night=false, Sleep=false, Action=Moving

 [32mç¬¨ãƒ»[39m src/tests/UnitInit.test.js [2m([22m[2m1 test[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mç¬¨ãƒ»[39m src/tests/WrapDistance.test.js [2m([22m[2m2 tests[22m[2m)[22m[32m 5[2mms[22m[39m

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ Failed Tests 7 ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯

 FAIL  src/tests/RubberBanding.test.js > Rubber-banding and Chaining Verification > should NOT snap back when arriving at a job during mid-move
AssertionError: expected 10 to be greater than 10
 ç¬¶ï½¯ src/tests/RubberBanding.test.js:74:28
     72| 
     73|         // Check if gridX was updated to the interpolated position (18)
     74|         expect(unit.gridX).toBeGreaterThan(10);
       |                            ^
     75|         expect(unit.gridX).toBeLessThan(20);
     76|         expect(unit.gridX).toBe(18);

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[1/7]ç«¡ï½¯

 FAIL  src/tests/RubberBanding.test.js > Rubber-banding and Chaining Verification > should use visual position for chaining the next job
AssertionError: expected "vi.fn()" to be called with arguments: [ Unit{ id: 1, çª¶ï½¦(58) }, çª¶ï½¦(1) ]

Number of calls: 0

 ç¬¶ï½¯ src/tests/RubberBanding.test.js:103:42
    101|         unit.state.update(8, 1);
    102| 
    103|         expect(mockGame.completeRequest).toHaveBeenCalledWith(unit, joçª¶ï½¦
       |                                          ^
    104|         expect(mockGame.claimRequest).toHaveBeenCalledWith(unit, job2);
    105|         expect(unit.targetRequest).toBe(job2);

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[2/7]ç«¡ï½¯

 FAIL  src/tests/TargetingPriority.test.js > Unit Targeting Priority > should NOT auto-target Huts without orders (Workers are passive)
AssertionError: expected { userData: { çª¶ï½¦(4) }, gridX: 2, çª¶ï½¦(2) } to be falsy

- Expected: 
false

+ Received: 
{
  "gridX": 2,
  "gridZ": 0,
  "id": "hut_2",
  "userData": {
    "gridX": 2,
    "gridZ": 0,
    "hp": 96,
    "type": "goblin_hut",
  },
}

 ç¬¶ï½¯ src/tests/TargetingPriority.test.js:159:41
    157|         testUnit.updateLogic(1000, 0.1, false, [], [], []);
    158| 
    159|         expect(testUnit.targetBuilding).toBeFalsy();
       |                                         ^
    160|     });
    161| });

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[3/7]ç«¡ï½¯

 FAIL  src/tests/UnitAISearch.test.js > Unit AI Search Optimization > should find Base using Spatial Search
AssertionError: expected "log" to be called with arguments: [ StringContaining{çª¶ï½¦} ]

Received: 

  1st log call:

  [
-   StringContaining "found Base via Spatial Search",
+   "Unit 999 found Goblin via Spatial Search!",
  ]

  2nd log call:

  [
-   StringContaining "found Base via Spatial Search",
+   "Unit 999 found Building via Spatial Search!",
  ]


Number of calls: 2

 ç¬¶ï½¯ src/tests/UnitAISearch.test.js:105:28
    103| 
    104|         // Expectation: Log found base (Unit.js prints "found Base viaçª¶ï½¦
    105|         expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaininçª¶ï½¦
       |                            ^
    106|     });
    107| });

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[4/7]ç«¡ï½¯

 FAIL  src/tests/UnitSnatch.test.js > Unit Snatching and Race Conditions > should stop and wander if another unit snatches its job
AssertionError: Action should be Wandering: expected 'Idle' to be 'Wandering' // Object.is equality

Expected: "Wandering"
Received: "Idle"

 ç¬¶ï½¯ src/tests/UnitSnatch.test.js:66:59
     64|         expect(unit.isMoving, 'Unit should stop moving').toBe(false);
     65|         expect(unit.state, 'State should be WanderState').toBeInstanceçª¶ï½¦
     66|         expect(unit.action, 'Action should be Wandering').toBe('Wanderçª¶ï½¦
       |                                                           ^
     67|         expect(unit.targetRequest, 'Target request should be null').toçª¶ï½¦
     68|     });

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[5/7]ç«¡ï½¯

 FAIL  src/tests/WorkerRequest.test.js > Worker Job Logic (Unit.js + States) > Unit moves to target request
AssertionError: expected 'Idle' to be 'Going to Work' // Object.is equality

Expected: "Going to Work"
Received: "Idle"

 ç¬¶ï½¯ src/tests/WorkerRequest.test.js:125:29
    123| 
    124|         // In JobState, action is set to 'Going to Work' when moving
    125|         expect(unit.action).toBe('Going to Work');
       |                             ^
    126|         expect(unit.smartMove).toHaveBeenCalled();
    127|     });

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[6/7]ç«¡ï½¯

 FAIL  src/tests/WorkerRequest.test.js > Worker Job Logic (Unit.js + States) > Unit completes request upon arrival
AssertionError: expected 'Idle' to be 'Wandering' // Object.is equality

Expected: "Wandering"
Received: "Idle"

 ç¬¶ï½¯ src/tests/WorkerRequest.test.js:148:29
    146|         expect(spyComplete).toHaveBeenCalled();
    147|         expect(unit.targetRequest).toBeNull();
    148|         expect(unit.action).toBe('Wandering');
       |                             ^
    149|         expect(mockTerrain.raise).toHaveBeenCalledWith(10, 10);
    150|     });

ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯ç«¡ï½¯[7/7]ç«¡ï½¯


[2m Test Files [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m48 passed[39m[22m[90m (53)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m155 passed[39m[22m[90m (162)[39m
[2m   Start at [22m 11:14:18
[2m   Duration [22m 9.51s[2m (transform 4.75s, setup 2.03s, import 10.67s, tests 22.31s, environment 66.01s)[22m

