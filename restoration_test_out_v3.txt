
 RUN  v4.0.15 C:/Users/mooya/develop/test

stdout | src/tests/SaveLoadRestoration.test.js > Save/Load Job Restoration > should restore unit ID and re-link to JobState correctly
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[Game] Request Added: raise at (12,12) ID:req_0
[Game] forceAssignRequest FOUND Unit 55 (DistSq:8). Scanned:1
[Game] Request req_0 assigned/switched to Unit 55
Saving Game Data: {
  slotId: [33m1[39m,
  timestamp: [33m1767623748197[39m,
  resources: { grain: [33m10[39m, fish: [33m10[39m, meat: [33m10[39m },
  gameTime: [33m8[39m,
  gameTotalTime: [33m0[39m,
  currentSeasonIndex: [90mundefined[39m,
  daysPassed: [90mundefined[39m,
  terrain: {
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m2[39m,
    h: [
      [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-4[39m, [33m-3[39m, [33m-2[39m, [33m-1[39m, [33m-1[39m,
       [33m0[39m,  [33m1[39m,  [33m1[39m,  [33m2[39m,  [33m2[39m,  [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,
       [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,  [33m7[39m,
       [33m7[39m,  [33m7[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,
       [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m5[39m,  [33m4[39m,  [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m3[39m,
       [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m4[39m,  [33m5[39m,  [33m5[39m,
       [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,
       [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,
       [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,
      ... 25500 more items
    ],
    n: [
       [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m,     [33m0[39m,  [33m0.01[39m, [33m-0.01[39m,
         [33m-0[39m,    [33m-0[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.01[39m,    [33m-0[39m,  [33m0.02[39m, [33m-0.01[39m,
      [33m-0.01[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m,     [33m0[39m,    [33m-0[39m, [33m-0.02[39m,    [33m-0[39m,  [33m0.02[39m,
         [33m-0[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m, [33m-0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m,     [33m0[39m,
         [33m-0[39m,  [33m0.02[39m,  [33m0.01[39m,    [33m-0[39m, [33m-0.01[39m,  [33m0.02[39m,    [33m-0[39m,  [33m0.01[39m,  [33m0.02[39m,
      [33m-0.02[39m,  [33m0.02[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.02[39m,
          [33m0[39m, [33m-0.02[39m, [33m-0.02[39m,    [33m-0[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m,
      [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,
      [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.01[39m,     [33m0[39m,  [33m0.02[39m,  [33m0.02[39m,
      [33m-0.02[39m,  [33m0.01[39m, [33m-0.02[39m,     [33m0[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m,
       [33m0.02[39m,  [33m0.02[39m,    [33m-0[39m, [33m-0.02[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.02[39m,
       [33m0.01[39m,
      ... 25500 more items
    ],
    b: [],
    m: [
      [33m0.13[39m, [33m0.15[39m, [33m0.19[39m, [33m0.24[39m, [33m0.29[39m, [33m0.34[39m, [33m0.39[39m, [33m0.43[39m, [33m0.47[39m,  [33m0.5[39m,
      [33m0.52[39m, [33m0.53[39m, [33m0.56[39m, [33m0.59[39m, [33m0.63[39m, [33m0.66[39m, [33m0.68[39m,  [33m0.7[39m, [33m0.71[39m, [33m0.71[39m,
      [33m0.71[39m, [33m0.71[39m, [33m0.73[39m, [33m0.75[39m, [33m0.77[39m, [33m0.78[39m, [33m0.79[39m,  [33m0.8[39m, [33m0.81[39m, [33m0.81[39m,
      [33m0.81[39m,  [33m0.8[39m,  [33m0.8[39m,  [33m0.8[39m, [33m0.81[39m, [33m0.81[39m,  [33m0.8[39m, [33m0.78[39m, [33m0.75[39m, [33m0.72[39m,
      [33m0.69[39m, [33m0.68[39m, [33m0.67[39m, [33m0.67[39m, [33m0.68[39m, [33m0.68[39m, [33m0.69[39m,  [33m0.7[39m, [33m0.71[39m, [33m0.71[39m,
      [33m0.71[39m, [33m0.71[39m, [33m0.71[39m,  [33m0.7[39m, [33m0.68[39m, [33m0.67[39m, [33m0.66[39m, [33m0.67[39m, [33m0.67[39m, [33m0.66[39m,
      [33m0.66[39m, [33m0.64[39m, [33m0.62[39m, [33m0.61[39m,  [33m0.6[39m, [33m0.61[39m, [33m0.61[39m, [33m0.62[39m, [33m0.63[39m, [33m0.63[39m,
      [33m0.64[39m, [33m0.63[39m, [33m0.62[39m, [33m0.61[39m, [33m0.59[39m, [33m0.57[39m, [33m0.55[39m, [33m0.51[39m, [33m0.46[39m, [33m0.42[39m,
      [33m0.38[39m, [33m0.37[39m, [33m0.38[39m, [33m0.38[39m, [33m0.39[39m, [33m0.38[39m, [33m0.37[39m, [33m0.37[39m, [33m0.37[39m, [33m0.37[39m,
      [33m0.37[39m, [33m0.38[39m, [33m0.39[39m,  [33m0.4[39m,  [33m0.4[39m,  [33m0.4[39m,  [33m0.4[39m, [33m0.41[39m, [33m0.43[39m, [33m0.45[39m,
      ... 25500 more items
    ]
  },
  units: [
    {
      id: [33m55[39m,
      gridX: [33m10[39m,
      gridZ: [33m10[39m,
      age: [33m20[39m,
      lifespan: [33m90.80929192369723[39m,
      isDead: [33mfalse[39m,
      isFinished: [90mundefined[39m,
      isMoving: [33mtrue[39m,
      targetX: [33m0[39m,
      targetZ: [33m0[39m,
      moveStartTime: [33m0[39m,
      moveDuration: [33m2.1313708498984765[39m,
      startGridX: [33m10[39m,
      startGridZ: [33m10[39m,
      targetGridX: [33m11[39m,
      targetGridZ: [33m11[39m,
      isSpecial: [33mfalse[39m,
      role: [32m'worker'[39m,
      hp: [33m45[39m,
      maxHp: [33m45[39m,
      damage: [33m4[39m,
      xp: [33m0[39m,
      level: [33m1[39m,
      name: [90mundefined[39m,
      homeBaseGridX: [90mundefined[39m,
      homeBaseGridZ: [90mundefined[39m,
      squadId: [1mnull[22m,
      targetRequestId: [32m'req_manual_1'[39m
    }
  ],
  goblinManager: {},
  camera: {
    position: { x: [33m20[39m, y: [33m20[39m, z: [33m20[39m },
    zoom: [33m1[39m,
    target: { x: [90mundefined[39m, y: [90mundefined[39m, z: [90mundefined[39m }
  },
  requests: [
    {
      id: [32m'req_manual_1'[39m,
      type: [32m'raise'[39m,
      x: [33m12[39m,
      z: [33m12[39m,
      status: [32m'assigned'[39m,
      assignedTo: [33m55[39m,
      createdAt: [33m0[39m,
      isManual: [33mtrue[39m
    }
  ]
}
Saved to slot 1 (Compressed). Size: 24600 chars (Original: 308087)
Load Started...

stdout | src/tests/SaveLoadRestoration.test.js > Save/Load Job Restoration > should restore unit ID and re-link to JobState correctly
Loading slot 1, Raw length: 24600
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1767623748218[39m,
  data: {
    slotId: [33m1[39m,
    timestamp: [33m1767623748197[39m,
    resources: { grain: [33m10[39m, fish: [33m10[39m, meat: [33m10[39m },
    gameTime: [33m8[39m,
    gameTotalTime: [33m0[39m,
    terrain: {
      logicalWidth: [33m160[39m,
      logicalDepth: [33m160[39m,
      version: [33m2[39m,
      h: [36m[Array][39m,
      n: [36m[Array][39m,
      b: [],
      m: [36m[Array][39m
    },
    units: [ [36m[Object][39m ],
    goblinManager: {},
    camera: { position: [36m[Object][39m, zoom: [33m1[39m, target: {} },
    requests: [ [36m[Object][39m ]
  }
}
Load Game: Data found {
  slotId: [33m1[39m,
  timestamp: [33m1767623748197[39m,
  resources: { grain: [33m10[39m, fish: [33m10[39m, meat: [33m10[39m },
  gameTime: [33m8[39m,
  gameTotalTime: [33m0[39m,
  terrain: {
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m2[39m,
    h: [
      [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-4[39m, [33m-3[39m, [33m-2[39m, [33m-1[39m, [33m-1[39m,
       [33m0[39m,  [33m1[39m,  [33m1[39m,  [33m2[39m,  [33m2[39m,  [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,
       [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,  [33m7[39m,
       [33m7[39m,  [33m7[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,
       [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m5[39m,  [33m4[39m,  [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m3[39m,
       [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m3[39m,  [33m4[39m,  [33m4[39m,  [33m4[39m,  [33m5[39m,  [33m5[39m,
       [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m5[39m,  [33m5[39m,  [33m5[39m,  [33m6[39m,  [33m6[39m,
       [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,
       [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,
      ... 25500 more items
    ],
    n: [
       [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m,     [33m0[39m,  [33m0.01[39m, [33m-0.01[39m,
          [33m0[39m,     [33m0[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.01[39m,     [33m0[39m,  [33m0.02[39m, [33m-0.01[39m,
      [33m-0.01[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m,     [33m0[39m,     [33m0[39m, [33m-0.02[39m,     [33m0[39m,  [33m0.02[39m,
          [33m0[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m, [33m-0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m,     [33m0[39m,
          [33m0[39m,  [33m0.02[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.01[39m,  [33m0.02[39m,     [33m0[39m,  [33m0.01[39m,  [33m0.02[39m,
      [33m-0.02[39m,  [33m0.02[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.02[39m,
          [33m0[39m, [33m-0.02[39m, [33m-0.02[39m,     [33m0[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m,
      [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,
      [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.01[39m,     [33m0[39m,  [33m0.02[39m,  [33m0.02[39m,
      [33m-0.02[39m,  [33m0.01[39m, [33m-0.02[39m,     [33m0[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m,
       [33m0.02[39m,  [33m0.02[39m,     [33m0[39m, [33m-0.02[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.02[39m,
       [33m0.01[39m,
      ... 25500 more items
    ],
    b: [],
    m: [
      [33m0.13[39m, [33m0.15[39m, [33m0.19[39m, [33m0.24[39m, [33m0.29[39m, [33m0.34[39m, [33m0.39[39m, [33m0.43[39m, [33m0.47[39m,  [33m0.5[39m,
      [33m0.52[39m, [33m0.53[39m, [33m0.56[39m, [33m0.59[39m, [33m0.63[39m, [33m0.66[39m, [33m0.68[39m,  [33m0.7[39m, [33m0.71[39m, [33m0.71[39m,
      [33m0.71[39m, [33m0.71[39m, [33m0.73[39m, [33m0.75[39m, [33m0.77[39m, [33m0.78[39m, [33m0.79[39m,  [33m0.8[39m, [33m0.81[39m, [33m0.81[39m,
      [33m0.81[39m,  [33m0.8[39m,  [33m0.8[39m,  [33m0.8[39m, [33m0.81[39m, [33m0.81[39m,  [33m0.8[39m, [33m0.78[39m, [33m0.75[39m, [33m0.72[39m,
      [33m0.69[39m, [33m0.68[39m, [33m0.67[39m, [33m0.67[39m, [33m0.68[39m, [33m0.68[39m, [33m0.69[39m,  [33m0.7[39m, [33m0.71[39m, [33m0.71[39m,
      [33m0.71[39m, [33m0.71[39m, [33m0.71[39m,  [33m0.7[39m, [33m0.68[39m, [33m0.67[39m, [33m0.66[39m, [33m0.67[39m, [33m0.67[39m, [33m0.66[39m,
      [33m0.66[39m, [33m0.64[39m, [33m0.62[39m, [33m0.61[39m,  [33m0.6[39m, [33m0.61[39m, [33m0.61[39m, [33m0.62[39m, [33m0.63[39m, [33m0.63[39m,
      [33m0.64[39m, [33m0.63[39m, [33m0.62[39m, [33m0.61[39m, [33m0.59[39m, [33m0.57[39m, [33m0.55[39m, [33m0.51[39m, [33m0.46[39m, [33m0.42[39m,
      [33m0.38[39m, [33m0.37[39m, [33m0.38[39m, [33m0.38[39m, [33m0.39[39m, [33m0.38[39m, [33m0.37[39m, [33m0.37[39m, [33m0.37[39m, [33m0.37[39m,
      [33m0.37[39m, [33m0.38[39m, [33m0.39[39m,  [33m0.4[39m,  [33m0.4[39m,  [33m0.4[39m,  [33m0.4[39m, [33m0.41[39m, [33m0.43[39m, [33m0.45[39m,
      ... 25500 more items
    ]
  },
  units: [
    {
      id: [33m55[39m,
      gridX: [33m10[39m,
      gridZ: [33m10[39m,
      age: [33m20[39m,
      lifespan: [33m90.80929192369723[39m,
      isDead: [33mfalse[39m,
      isMoving: [33mtrue[39m,
      targetX: [33m0[39m,
      targetZ: [33m0[39m,
      moveStartTime: [33m0[39m,
      moveDuration: [33m2.1313708498984765[39m,
      startGridX: [33m10[39m,
      startGridZ: [33m10[39m,
      targetGridX: [33m11[39m,
      targetGridZ: [33m11[39m,
      isSpecial: [33mfalse[39m,
      role: [32m'worker'[39m,
      hp: [33m45[39m,
      maxHp: [33m45[39m,
      damage: [33m4[39m,
      xp: [33m0[39m,
      level: [33m1[39m,
      squadId: [1mnull[22m,
      targetRequestId: [32m'req_manual_1'[39m
    }
  ],
  goblinManager: {},
  camera: { position: { x: [33m20[39m, y: [33m20[39m, z: [33m20[39m }, zoom: [33m1[39m, target: {} },
  requests: [
    {
      id: [32m'req_manual_1'[39m,
      type: [32m'raise'[39m,
      x: [33m12[39m,
      z: [33m12[39m,
      status: [32m'assigned'[39m,
      assignedTo: [33m55[39m,
      createdAt: [33m0[39m,
      isManual: [33mtrue[39m
    }
  ]
}
Clearing 0 projectiles...

stdout | src/tests/SaveLoadRestoration.test.js > Save/Load Job Restoration > should restore unit ID and re-link to JobState correctly
[DEBUG] Terrain.setSeason: Changing from undefined to Spring
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[Game] Restoring 1 requests...
[Game] Re-linked Unit 55 to Request req_manual_1
[Game] Restored Camera Zoom: 1

 ç¬¨ãƒ»src/tests/SaveLoadRestoration.test.js > Save/Load Job Restoration > should restore unit ID and re-link to JobState correctly 1200ms
stdout | src/tests/SaveLoadRestoration.test.js > Save/Load Job Restoration > should reset ghost-assigned requests during load
Load Started...

stdout | src/tests/SaveLoadRestoration.test.js > Save/Load Job Restoration > should reset ghost-assigned requests during load
Loading slot 1, Raw length: 114
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1767623749381[39m,
  data: {
    resources: {},
    gameTime: [33m12[39m,
    terrain: { logicalWidth: [33m80[39m, logicalDepth: [33m80[39m, grid: [], buildings: [] },
    units: [],
    requests: [ [36m[Object][39m ]
  }
}
Load Game: Data found {
  resources: {},
  gameTime: [33m12[39m,
  terrain: { logicalWidth: [33m80[39m, logicalDepth: [33m80[39m, grid: [], buildings: [] },
  units: [],
  requests: [
    {
      id: [32m'req_ghost'[39m,
      type: [32m'raise'[39m,
      x: [33m5[39m,
      z: [33m5[39m,
      status: [32m'assigned'[39m,
      assignedTo: [33m99[39m,
      isManual: [33mtrue[39m
    }
  ]
}
Clearing 0 projectiles...

stdout | src/tests/SaveLoadRestoration.test.js > Save/Load Job Restoration > should reset ghost-assigned requests during load
[Terrain] Deserializing Legacy Format...

 ï¾ƒãƒ»src/tests/SaveLoadRestoration.test.js > Save/Load Job Restoration > should reset ghost-assigned requests during load 732ms
   ç«Šãƒ»Cannot read properties of undefined (reading '0')

 Test Files  1 failed (1)
      Tests  1 failed | 1 passed (2)
   Start at  23:35:46
   Duration  3.40s (transform 339ms, setup 42ms, import 450ms, tests 1.93s, environment 625ms)

