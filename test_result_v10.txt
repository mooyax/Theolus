
[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/mooya/develop/test[39m

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Building.ts loaded

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Terrain.ts top-level load

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Actor.ts loaded

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Goblin.ts loaded

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[Import Debug] Raid: function, Combat: function, Wander: function

[90mstdout[2m | src/tests/FactionPersistence.test.js
[22m[39m[DEBUG] Game.ts top-level load

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Terrain] Constructor. updatePopulation type: function
[Game] Init SphereGeometry
[Game] Minimal/Override Init Start
[Game] Minimal: Init Clock
[Game FORCE CONST 1] Assigning terrainOverride to this.terrain
[Game] Minimal: Init Managers
[Game] Minimal: Init GoblinManager
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=0
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.168054, 0.728400) -> Grid(26, 116) rngState=0
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.825038, 0.969766) -> Grid(132, 155) rngState=0
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.426504, 0.961506) -> Grid(68, 153) rngState=0
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)
[Game] Minimal: Init EnemyAI
[Game] Minimal: Done. Returning.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39mStarting persistence test...
[Entity 0] CONSTRUCTOR START: type=unit at 10,10
[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[DIAG] Actor Created ID: 0
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0
[Entity 1] CONSTRUCTOR START: type=unit at 20,20
[Entity 1] Calling registerEntity...
[Entity 1] registerEntity returned.
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[DIAG] Actor Created ID: 1
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:1 Role:knight Pos:20,20 Special:false
[UnitCore.js] Unit Created ID:1 Role:knight Pos:20,20
[UnitCore.js] Unit Construction Finished ID:1
[Entity 2] CONSTRUCTOR START: type=building at 30,30
[Entity 2] Calling registerEntity...
[Entity 2] registerEntity returned.
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[BuildingDiag] Created farm at 30,30 ID:2 Faction:player
[Entity 3] CONSTRUCTOR START: type=building at 40,40
[Entity 3] Calling registerEntity...
[Entity 3] registerEntity returned.
[Entity 3] Calling updatePosition...
[Entity 3] updatePosition returned.
[BuildingDiag] Created farm at 40,40 ID:3 Faction:player
Units: PlayerID=0 EnemyID=1
Farms: PlayerFaction=player EnemyFaction=enemy
Saving game...
[Game] Saving Game: Level=0, Seed=0
Saved to slot 1 (Compressed). Size: 7577 chars (Original: 176226)
LocalStorage setItem calls: [33m1[39m
Decompressed faction data check:
Unit 0 faction: player
Unit 1 faction: enemy
Building 0 faction: player
Building 1 faction: enemy
Loading game...
Load Started...

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39mLoading slot 1, Raw length: 7577
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1771561804089[39m,
  data: {
    slotId: [33m1[39m,
    timestamp: [33m1771561804086[39m,
    resources: { grain: [33m0[39m, fish: [33m0[39m, meat: [33m0[39m },
    gameTime: [33m6[39m,
    gameTotalTime: [33m0[39m,
    currentSeasonIndex: [33m0[39m,
    daysPassed: [33m0[39m,
    terrain: {
      logicalWidth: [33m160[39m,
      logicalDepth: [33m160[39m,
      version: [33m2[39m,
      h: [36m[Array][39m,
      n: [36m[Array][39m,
      b: [36m[Array][39m,
      seed: [33m0[39m,
      trees: []
    },
    units: [ [36m[Object][39m, [36m[Object][39m ],
    requests: [],
    goblinManager: { plunderCount: [33m0[39m, goblins: [], clans: [], caves: [] },
    camera: { position: [36m[Object][39m, target: [36m[Object][39m },
    currentLevelIndex: [33m0[39m,
    currentSeed: [33m0[39m
  }
}
Load Game: Data found {
  slotId: [33m1[39m,
  timestamp: [33m1771561804086[39m,
  resources: { grain: [33m0[39m, fish: [33m0[39m, meat: [33m0[39m },
  gameTime: [33m6[39m,
  gameTotalTime: [33m0[39m,
  currentSeasonIndex: [33m0[39m,
  daysPassed: [33m0[39m,
  terrain: {
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m2[39m,
    h: [
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      [33m0[39m, [33m0[39m, [33m0[39m, [33m0[39m,
      ... 25500 more items
    ],
    n: [
      [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m,  [33m0.01[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.02[39m,
          [33m0[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.02[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m, [33m-0.01[39m,
      [33m-0.02[39m, [33m-0.01[39m, [33m-0.02[39m,  [33m0.02[39m,     [33m0[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.02[39m,  [33m0.01[39m,
      [33m-0.02[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.02[39m,
       [33m0.01[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.02[39m,  [33m0.02[39m,     [33m0[39m,  [33m0.01[39m,
       [33m0.02[39m,  [33m0.01[39m, [33m-0.02[39m,  [33m0.02[39m, [33m-0.02[39m,  [33m0.02[39m,     [33m0[39m,  [33m0.02[39m, [33m-0.02[39m,
       [33m0.02[39m,  [33m0.01[39m, [33m-0.02[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m,
       [33m0.02[39m, [33m-0.02[39m,  [33m0.01[39m, [33m-0.02[39m,     [33m0[39m,     [33m0[39m, [33m-0.01[39m,     [33m0[39m,  [33m0.02[39m,
          [33m0[39m, [33m-0.02[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.01[39m,
      [33m-0.01[39m, [33m-0.02[39m,  [33m0.02[39m,     [33m0[39m, [33m-0.02[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.02[39m,     [33m0[39m,
          [33m0[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m,  [33m0.01[39m,
       [33m0.02[39m,
      ... 25500 more items
    ],
    b: [ [36m[Object][39m, [36m[Object][39m ],
    seed: [33m0[39m,
    trees: []
  },
  units: [
    {
      id: [33m0[39m,
      gridX: [33m10[39m,
      gridZ: [33m10[39m,
      age: [33m20[39m,
      raidTargetX: [1mnull[22m,
      raidTargetY: [1mnull[22m,
      raidTargetZ: [1mnull[22m,
      raidTargetTS: [1mnull[22m,
      lifespan: [33m85.55996977922032[39m,
      isDead: [33mfalse[39m,
      isFinished: [33mfalse[39m,
      isMoving: [33mfalse[39m,
      targetX: [33m0[39m,
      targetZ: [33m0[39m,
      moveStartTime: [33m0[39m,
      moveDuration: [33m0.8[39m,
      startGridX: [33m0[39m,
      startGridZ: [33m0[39m,
      targetGridX: [33m0[39m,
      targetGridZ: [33m0[39m,
      isSpecial: [33mfalse[39m,
      role: [32m'worker'[39m,
      type: [32m'worker'[39m,
      hp: [33m52[39m,
      maxHp: [33m52[39m,
      damage: [33m12[39m,
      xp: [33m0[39m,
      level: [33m1[39m,
      name: [32m'Unit'[39m,
      faction: [32m'player'[39m,
      squadId: [1mnull[22m,
      targetRequestId: [1mnull[22m,
      action: [32m'Idle'[39m,
      ignoredTargets: []
    },
    {
      id: [33m1[39m,
      gridX: [33m20[39m,
      gridZ: [33m20[39m,
      age: [33m20[39m,
      raidTargetX: [1mnull[22m,
      raidTargetY: [1mnull[22m,
      raidTargetZ: [1mnull[22m,
      raidTargetTS: [1mnull[22m,
      lifespan: [33m90.91215945272248[39m,
      isDead: [33mfalse[39m,
      isFinished: [33mfalse[39m,
      isMoving: [33mfalse[39m,
      targetX: [33m0[39m,
      targetZ: [33m0[39m,
      moveStartTime: [33m0[39m,
      moveDuration: [33m0.8[39m,
      startGridX: [33m0[39m,
      startGridZ: [33m0[39m,
      targetGridX: [33m0[39m,
      targetGridZ: [33m0[39m,
      isSpecial: [33mfalse[39m,
      role: [32m'knight'[39m,
      type: [32m'knight'[39m,
      hp: [33m1013[39m,
      maxHp: [33m1013[39m,
      damage: [33m300[39m,
      xp: [33m0[39m,
      level: [33m1[39m,
      name: [32m'Unit'[39m,
      faction: [32m'enemy'[39m,
      squadId: [1mnull[22m,
      targetRequestId: [1mnull[22m,
      action: [32m'Idle'[39m,
      ignoredTargets: []
    }
  ],
  requests: [],
  goblinManager: { plunderCount: [33m0[39m, goblins: [], clans: [], caves: [] },
  camera: { position: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m }, target: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m } },
  currentLevelIndex: [33m0[39m,
  currentSeed: [33m0[39m
}
[Game] Load Game: Restored Level=0, Seed=0

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39mResetting GoblinManager...
Clearing 0 projectiles...
[Game] Deserializing terrain...
[Terrain] deserialize: Start
[Terrain] deserialize: Clearing Buildings...
[Terrain] deserialize: Clearing Grid...

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Terrain] deserialize: Restoring Grid Data...

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Terrain] deserialize: Restoring 2 Buildings...

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Terrain] Restoring building 1/2: Type=farm, Pos=(30,30), Faction=player
[Entity 4] CONSTRUCTOR START: type=building at 30,30
[Entity 4] Calling registerEntity...
[Entity 4] registerEntity returned.
[Entity 4] Calling updatePosition...
[Entity 4] updatePosition returned.
[BuildingDiag] Created farm at 30,30 ID:4 Faction:player

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Terrain] Restoring building 2/2: Type=farm, Pos=(40,40), Faction=enemy
[Entity 5] CONSTRUCTOR START: type=building at 40,40
[Entity 5] Calling registerEntity...
[Entity 5] registerEntity returned.
[Entity 5] Calling updatePosition...
[Entity 5] updatePosition returned.
[BuildingDiag] Created farm at 40,40 ID:5 Faction:player

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Game] Terrain deserialized.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Game] Loading resources/time...
[Game] Updating environment...

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Terrain] Season set to: Spring

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Game] Restoring 2 units...

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Entity 6] CONSTRUCTOR START: type=unit at 10,10
[Entity 6] Calling registerEntity...
[Entity 6] registerEntity returned.
[Entity 6] Calling updatePosition...
[Entity 6] updatePosition returned.
[DIAG] Actor Created ID: 6
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:2
[Unit 0] State Change: Wander -> Wander

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39m[Entity 7] CONSTRUCTOR START: type=unit at 20,20
[Entity 7] Calling registerEntity...
[Entity 7] registerEntity returned.
[Entity 7] Calling updatePosition...
[Entity 7] updatePosition returned.
[DIAG] Actor Created ID: 7
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:3 Role:knight Pos:20,20 Special:false
[UnitCore.js] Unit Created ID:3 Role:knight Pos:20,20
[UnitCore.js] Unit Construction Finished ID:3
[Game] Successfully restored 2 units.
GoblinManager: Deserializing...
[Terrain] Validated / Cleared 0 entities of type 'goblin'.
GoblinManager: Restored 0 goblins.
[Game] Restoring 0 requests...
[Game] Checking unit 0 for targetRequestId: null
[Game] Checking unit 1 for targetRequestId: null
[Game] Restored Camera Zoom: 1

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould persist unit and building faction across save/load
[22m[39mLoad result: [33mtrue[39m
Verifying restored entities...
Persistence test PASSED

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould only add food to player pool from player farms
[22m[39mDisposing detached game instance
[Game] Dispose called for Game Instance.
[Terrain] Dispose called.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould only add food to player pool from player farms
[22m[39m[Terrain] Constructor. updatePopulation type: function
[Game] Init SphereGeometry
[Game] Minimal/Override Init Start
[Game] Minimal: Init Clock
[Game FORCE CONST 2] Assigning terrainOverride to this.terrain
[Game] Minimal: Init Managers
[Game] Minimal: Init GoblinManager
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=0
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.643070, 0.628454) -> Grid(102, 100) rngState=0
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.434071, 0.473032) -> Grid(69, 75) rngState=0
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.156751, 0.117923) -> Grid(25, 18) rngState=0
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)
[Game] Minimal: Init EnemyAI
[Game] Minimal: Done. Returning.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould only add food to player pool from player farms
[22m[39mStarting resource test...
[Entity 8] CONSTRUCTOR START: type=building at 10,10
[Entity 8] Calling registerEntity...
[Entity 8] registerEntity returned.
[Entity 8] Calling updatePosition...
[Entity 8] updatePosition returned.
[BuildingDiag] Created farm at 10,10 ID:8 Faction:player
[Entity 9] CONSTRUCTOR START: type=building at 20,20
[Entity 9] Calling registerEntity...
[Entity 9] registerEntity returned.
[Entity 9] Calling updatePosition...
[Entity 9] updatePosition returned.
[BuildingDiag] Created farm at 20,20 ID:9 Faction:player
Initial resources: grain=0
[Terrain DIAG FRAME] Frame:1 Stagger:1 Units:0
[Terrain DIAG] Type:farm Frame:0/1 GrowthVal:0.5 Multiplier:0.5 Rate:0.25 HasFood:true Pop:0
[ResourceDiag] Farm at 10,10 added 4 grain. Total grain: 4
[Terrain DIAG] Type:farm Frame:0/1 GrowthVal:0.5 Multiplier:0.5 Rate:0.25 HasFood:true Pop:0
[ResourceDiag] Farm at 20,20 SKIPPED (faction: enemy)
Resources after update: grain=4
[Terrain DIAG FRAME] Frame:2 Stagger:1 Units:0
[Terrain DIAG] Type:farm Frame:0/1 GrowthVal:0.5 Multiplier:0.5 Rate:0.25 HasFood:true Pop:0
[Terrain DIAG] Type:farm Frame:0/1 GrowthVal:0.5 Multiplier:0.5 Rate:0.25 HasFood:true Pop:0
[ResourceDiag] Farm at 20,20 SKIPPED (faction: enemy)
Resources after 2nd update (enemy only): grain=0
Resource test PASSED

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould allow workers and knights to target enemy human buildings
[22m[39mDisposing detached game instance
[Game] Dispose called for Game Instance.
[Terrain] Dispose called.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould allow workers and knights to target enemy human buildings
[22m[39m[Terrain] Constructor. updatePopulation type: function
[Game] Init SphereGeometry
[Game] Minimal/Override Init Start
[Game] Minimal: Init Clock
[Game FORCE CONST 3] Assigning terrainOverride to this.terrain
[Game] Minimal: Init Managers
[Game] Minimal: Init GoblinManager
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=0
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.004226, 0.544258) -> Grid(0, 87) rngState=0
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.374818, 0.826596) -> Grid(59, 132) rngState=0
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.274284, 0.053605) -> Grid(43, 8) rngState=0
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)
[Game] Minimal: Init EnemyAI
[Game] Minimal: Done. Returning.

[90mstdout[2m | src/tests/FactionPersistence.test.js[2m > [22m[2mFaction Persistence and Logic[2m > [22m[2mshould allow workers and knights to target enemy human buildings
[22m[39mStarting enemy building targeting test...
[Entity 10] CONSTRUCTOR START: type=unit at 10,10
[Entity 10] Calling registerEntity...
[Entity 10] registerEntity returned.
[Entity 10] Calling updatePosition...
[Entity 10] updatePosition returned.
[DIAG] Actor Created ID: 10
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:2 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:2
[Entity 11] CONSTRUCTOR START: type=building at 12,10
[Entity 11] Calling registerEntity...
[Entity 11] registerEntity returned.
[Entity 11] Calling updatePosition...
[Entity 11] updatePosition returned.
[BuildingDiag] Created tower at 12,10 ID:11 Faction:player
Worker Faction: player, Tower Faction: enemy
[TargetDiag] Worker at 10,10 evaluating Building ID:11 Type:tower Faction:enemy Dist:2 isEnemyFaction:true
Worker current target: tower
[Entity 12] CONSTRUCTOR START: type=unit at 20,20
[Entity 12] Calling registerEntity...
[Entity 12] registerEntity returned.
[Entity 12] Calling updatePosition...
[Entity 12] updatePosition returned.
[DIAG] Actor Created ID: 12
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:3 Role:knight Pos:20,20 Special:false
[UnitCore.js] Unit Created ID:3 Role:knight Pos:20,20
[UnitCore.js] Unit Construction Finished ID:3
[Entity 13] CONSTRUCTOR START: type=building at 22,20
[Entity 13] Calling registerEntity...
[Entity 13] registerEntity returned.
[Entity 13] Calling updatePosition...
[Entity 13] updatePosition returned.
[BuildingDiag] Created house at 22,20 ID:13 Faction:player
Knight current target: house
Targeting test PASSED

 [32mç¬¨ãƒ»[39m src/tests/FactionPersistence.test.js [2m([22m[2m3 tests[22m[2m)[22m[33m 698[2mms[22m[39m
     [33m[2mç¬¨ãƒ»[22m[39m should persist unit and building faction across save/load [33m 475[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m3 passed[39m[22m[90m (3)[39m
[2m   Start at [22m 13:30:02
[2m   Duration [22m 1.93s[2m (transform 494ms, setup 89ms, import 544ms, tests 698ms, environment 430ms)[22m

