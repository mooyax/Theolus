
 RUN  v4.0.15 C:/Users/mooya/develop/test

stdout | src/tests/LoadUpdateLoop.test.js > Load Update Loop Integration > should maintain JobState after first update loop post-load
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[Game] Request Added: raise at (15,15) ID:req_0
[Game] forceAssignRequest FOUND Unit 100 (DistSq:50). Scanned:1
[Unit 100] Blocked by Water at 11,11 H:-5
[Game] Request req_0 assigned/switched to Unit 100
Saving Game Data: {
  slotId: [33m1[39m,
  timestamp: [33m1767624124658[39m,
  resources: { grain: [33m10[39m, fish: [33m10[39m, meat: [33m10[39m },
  gameTime: [33m8[39m,
  gameTotalTime: [33m0[39m,
  currentSeasonIndex: [90mundefined[39m,
  daysPassed: [90mundefined[39m,
  terrain: {
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m2[39m,
    h: [
      [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-4[39m, [33m-3[39m, [33m-2[39m, [33m-1[39m, [33m-0[39m,  [33m1[39m,  [33m1[39m,
       [33m2[39m,  [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m4[39m,  [33m5[39m,  [33m6[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m8[39m,  [33m8[39m,
       [33m8[39m,  [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,
       [33m7[39m,  [33m7[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m6[39m,  [33m5[39m,  [33m5[39m,  [33m4[39m,
       [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m2[39m,  [33m2[39m,  [33m1[39m, [33m-0[39m, [33m-2[39m, [33m-3[39m, [33m-3[39m, [33m-3[39m, [33m-3[39m,
      [33m-3[39m, [33m-3[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-3[39m, [33m-3[39m, [33m-2[39m, [33m-1[39m,
      [33m-1[39m, [33m-0[39m, [33m-0[39m,  [33m0[39m,  [33m1[39m,  [33m1[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m3[39m,  [33m3[39m,
       [33m3[39m,  [33m3[39m,  [33m2[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m0[39m,  [33m0[39m,  [33m0[39m, [33m-0[39m,  [33m0[39m,  [33m1[39m,
       [33m1[39m,  [33m1[39m,  [33m0[39m, [33m-0[39m,
      ... 25500 more items
    ],
    n: [
      [33m-0.01[39m,    [33m-0[39m,    [33m-0[39m, [33m-0.01[39m,    [33m-0[39m,  [33m0.01[39m,     [33m0[39m,     [33m0[39m, [33m-0.02[39m,
       [33m0.01[39m,     [33m0[39m,     [33m0[39m,     [33m0[39m,     [33m0[39m,    [33m-0[39m,  [33m0.02[39m,    [33m-0[39m,  [33m0.02[39m,
      [33m-0.01[39m,  [33m0.02[39m, [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m,
      [33m-0.01[39m, [33m-0.02[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.02[39m, [33m-0.02[39m,     [33m0[39m,     [33m0[39m,  [33m0.01[39m,
         [33m-0[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.01[39m,
          [33m0[39m,     [33m0[39m, [33m-0.02[39m,     [33m0[39m, [33m-0.02[39m,     [33m0[39m,    [33m-0[39m,  [33m0.01[39m, [33m-0.01[39m,
          [33m0[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,  [33m0.01[39m,  [33m0.01[39m,
       [33m0.01[39m, [33m-0.01[39m,    [33m-0[39m, [33m-0.02[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m,  [33m0.01[39m, [33m-0.02[39m,
      [33m-0.02[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m, [33m-0.02[39m,
         [33m-0[39m, [33m-0.02[39m,  [33m0.01[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.02[39m,  [33m0.02[39m, [33m-0.02[39m,
      [33m-0.01[39m,  [33m0.01[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.01[39m,  [33m0.01[39m,
      [33m-0.02[39m,
      ... 25500 more items
    ],
    b: [],
    m: [
       [33m0.3[39m,  [33m0.3[39m, [33m0.31[39m, [33m0.33[39m, [33m0.34[39m, [33m0.35[39m, [33m0.35[39m, [33m0.36[39m, [33m0.36[39m, [33m0.38[39m,
      [33m0.39[39m,  [33m0.4[39m, [33m0.41[39m, [33m0.41[39m, [33m0.42[39m, [33m0.43[39m, [33m0.44[39m, [33m0.43[39m, [33m0.42[39m, [33m0.41[39m,
      [33m0.41[39m, [33m0.43[39m, [33m0.46[39m, [33m0.48[39m, [33m0.49[39m, [33m0.49[39m, [33m0.49[39m,  [33m0.5[39m,  [33m0.5[39m,  [33m0.5[39m,
       [33m0.5[39m, [33m0.49[39m, [33m0.49[39m, [33m0.48[39m, [33m0.47[39m, [33m0.45[39m, [33m0.43[39m, [33m0.41[39m, [33m0.39[39m, [33m0.38[39m,
      [33m0.37[39m, [33m0.39[39m, [33m0.41[39m, [33m0.44[39m, [33m0.47[39m, [33m0.49[39m, [33m0.51[39m, [33m0.52[39m, [33m0.52[39m, [33m0.52[39m,
      [33m0.53[39m, [33m0.53[39m, [33m0.54[39m, [33m0.54[39m, [33m0.54[39m, [33m0.55[39m, [33m0.55[39m, [33m0.55[39m, [33m0.54[39m, [33m0.53[39m,
      [33m0.52[39m, [33m0.51[39m, [33m0.49[39m, [33m0.47[39m, [33m0.46[39m, [33m0.46[39m, [33m0.44[39m, [33m0.43[39m, [33m0.41[39m,  [33m0.4[39m,
       [33m0.4[39m,  [33m0.4[39m, [33m0.39[39m, [33m0.37[39m, [33m0.35[39m, [33m0.32[39m,  [33m0.3[39m, [33m0.29[39m,  [33m0.3[39m, [33m0.31[39m,
      [33m0.32[39m, [33m0.32[39m, [33m0.33[39m, [33m0.34[39m, [33m0.36[39m,  [33m0.4[39m, [33m0.45[39m,  [33m0.5[39m, [33m0.54[39m, [33m0.56[39m,
      [33m0.59[39m, [33m0.61[39m, [33m0.63[39m, [33m0.65[39m, [33m0.66[39m, [33m0.66[39m, [33m0.66[39m, [33m0.67[39m, [33m0.68[39m,  [33m0.7[39m,
      ... 25500 more items
    ]
  },
  units: [
    {
      id: [33m100[39m,
      gridX: [33m10[39m,
      gridZ: [33m10[39m,
      age: [33m20[39m,
      lifespan: [33m95.26103032294314[39m,
      isDead: [33mfalse[39m,
      isFinished: [90mundefined[39m,
      isMoving: [33mfalse[39m,
      targetX: [33m0[39m,
      targetZ: [33m0[39m,
      moveStartTime: [33m0[39m,
      moveDuration: [33m1000[39m,
      startGridX: [33m0[39m,
      startGridZ: [33m0[39m,
      targetGridX: [33m0[39m,
      targetGridZ: [33m0[39m,
      isSpecial: [33mfalse[39m,
      role: [32m'worker'[39m,
      hp: [33m44[39m,
      maxHp: [33m44[39m,
      damage: [33m4[39m,
      xp: [33m0[39m,
      level: [33m1[39m,
      name: [90mundefined[39m,
      homeBaseGridX: [90mundefined[39m,
      homeBaseGridZ: [90mundefined[39m,
      squadId: [1mnull[22m,
      targetRequestId: [32m'req_manual_persistent'[39m
    }
  ],
  goblinManager: {},
  camera: {
    position: { x: [33m20[39m, y: [33m20[39m, z: [33m20[39m },
    zoom: [33m1[39m,
    target: { x: [90mundefined[39m, y: [90mundefined[39m, z: [90mundefined[39m }
  },
  requests: [
    {
      id: [32m'req_manual_persistent'[39m,
      type: [32m'raise'[39m,
      x: [33m15[39m,
      z: [33m15[39m,
      status: [32m'assigned'[39m,
      assignedTo: [33m100[39m,
      createdAt: [33m0[39m,
      isManual: [33mtrue[39m
    }
  ]
}
Saved to slot 1 (Compressed). Size: 25120 chars (Original: 309636)
Load Started...

stdout | src/tests/LoadUpdateLoop.test.js > Load Update Loop Integration > should maintain JobState after first update loop post-load
Loading slot 1, Raw length: 25120
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1767624124666[39m,
  data: {
    slotId: [33m1[39m,
    timestamp: [33m1767624124658[39m,
    resources: { grain: [33m10[39m, fish: [33m10[39m, meat: [33m10[39m },
    gameTime: [33m8[39m,
    gameTotalTime: [33m0[39m,
    terrain: {
      logicalWidth: [33m160[39m,
      logicalDepth: [33m160[39m,
      version: [33m2[39m,
      h: [36m[Array][39m,
      n: [36m[Array][39m,
      b: [],
      m: [36m[Array][39m
    },
    units: [ [36m[Object][39m ],
    goblinManager: {},
    camera: { position: [36m[Object][39m, zoom: [33m1[39m, target: {} },
    requests: [ [36m[Object][39m ]
  }
}
Load Game: Data found {
  slotId: [33m1[39m,
  timestamp: [33m1767624124658[39m,
  resources: { grain: [33m10[39m, fish: [33m10[39m, meat: [33m10[39m },
  gameTime: [33m8[39m,
  gameTotalTime: [33m0[39m,
  terrain: {
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m2[39m,
    h: [
      [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-5[39m, [33m-4[39m, [33m-3[39m, [33m-2[39m, [33m-1[39m,  [33m0[39m,  [33m1[39m,  [33m1[39m,
       [33m2[39m,  [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m4[39m,  [33m5[39m,  [33m6[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m8[39m,  [33m8[39m,
       [33m8[39m,  [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,  [33m6[39m,
       [33m7[39m,  [33m7[39m,  [33m8[39m,  [33m8[39m,  [33m8[39m,  [33m7[39m,  [33m7[39m,  [33m6[39m,  [33m6[39m,  [33m5[39m,  [33m5[39m,  [33m4[39m,
       [33m3[39m,  [33m3[39m,  [33m3[39m,  [33m2[39m,  [33m2[39m,  [33m1[39m,  [33m0[39m, [33m-2[39m, [33m-3[39m, [33m-3[39m, [33m-3[39m, [33m-3[39m,
      [33m-3[39m, [33m-3[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-4[39m, [33m-3[39m, [33m-3[39m, [33m-2[39m, [33m-1[39m,
      [33m-1[39m,  [33m0[39m,  [33m0[39m,  [33m0[39m,  [33m1[39m,  [33m1[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m2[39m,  [33m3[39m,  [33m3[39m,
       [33m3[39m,  [33m3[39m,  [33m2[39m,  [33m1[39m,  [33m1[39m,  [33m1[39m,  [33m0[39m,  [33m0[39m,  [33m0[39m,  [33m0[39m,  [33m0[39m,  [33m1[39m,
       [33m1[39m,  [33m1[39m,  [33m0[39m,  [33m0[39m,
      ... 25500 more items
    ],
    n: [
      [33m-0.01[39m,     [33m0[39m,     [33m0[39m, [33m-0.01[39m,     [33m0[39m,  [33m0.01[39m,     [33m0[39m,     [33m0[39m, [33m-0.02[39m,
       [33m0.01[39m,     [33m0[39m,     [33m0[39m,     [33m0[39m,     [33m0[39m,     [33m0[39m,  [33m0.02[39m,     [33m0[39m,  [33m0.02[39m,
      [33m-0.01[39m,  [33m0.02[39m, [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.01[39m, [33m-0.01[39m,
      [33m-0.01[39m, [33m-0.02[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.02[39m, [33m-0.02[39m,     [33m0[39m,     [33m0[39m,  [33m0.01[39m,
          [33m0[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.02[39m,  [33m0.01[39m,  [33m0.01[39m,     [33m0[39m, [33m-0.01[39m,
          [33m0[39m,     [33m0[39m, [33m-0.02[39m,     [33m0[39m, [33m-0.02[39m,     [33m0[39m,     [33m0[39m,  [33m0.01[39m, [33m-0.01[39m,
          [33m0[39m, [33m-0.01[39m, [33m-0.01[39m, [33m-0.01[39m,  [33m0.02[39m, [33m-0.02[39m, [33m-0.01[39m,  [33m0.01[39m,  [33m0.01[39m,
       [33m0.01[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.02[39m,  [33m0.01[39m, [33m-0.01[39m,  [33m0.01[39m,  [33m0.01[39m, [33m-0.02[39m,
      [33m-0.02[39m,  [33m0.02[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.01[39m,  [33m0.01[39m, [33m-0.01[39m, [33m-0.02[39m, [33m-0.02[39m,
          [33m0[39m, [33m-0.02[39m,  [33m0.01[39m,  [33m0.01[39m,  [33m0.02[39m,  [33m0.02[39m, [33m-0.02[39m,  [33m0.02[39m, [33m-0.02[39m,
      [33m-0.01[39m,  [33m0.01[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.02[39m, [33m-0.01[39m,     [33m0[39m, [33m-0.01[39m,  [33m0.01[39m,
      [33m-0.02[39m,
      ... 25500 more items
    ],
    b: [],
    m: [
       [33m0.3[39m,  [33m0.3[39m, [33m0.31[39m, [33m0.33[39m, [33m0.34[39m, [33m0.35[39m, [33m0.35[39m, [33m0.36[39m, [33m0.36[39m, [33m0.38[39m,
      [33m0.39[39m,  [33m0.4[39m, [33m0.41[39m, [33m0.41[39m, [33m0.42[39m, [33m0.43[39m, [33m0.44[39m, [33m0.43[39m, [33m0.42[39m, [33m0.41[39m,
      [33m0.41[39m, [33m0.43[39m, [33m0.46[39m, [33m0.48[39m, [33m0.49[39m, [33m0.49[39m, [33m0.49[39m,  [33m0.5[39m,  [33m0.5[39m,  [33m0.5[39m,
       [33m0.5[39m, [33m0.49[39m, [33m0.49[39m, [33m0.48[39m, [33m0.47[39m, [33m0.45[39m, [33m0.43[39m, [33m0.41[39m, [33m0.39[39m, [33m0.38[39m,
      [33m0.37[39m, [33m0.39[39m, [33m0.41[39m, [33m0.44[39m, [33m0.47[39m, [33m0.49[39m, [33m0.51[39m, [33m0.52[39m, [33m0.52[39m, [33m0.52[39m,
      [33m0.53[39m, [33m0.53[39m, [33m0.54[39m, [33m0.54[39m, [33m0.54[39m, [33m0.55[39m, [33m0.55[39m, [33m0.55[39m, [33m0.54[39m, [33m0.53[39m,
      [33m0.52[39m, [33m0.51[39m, [33m0.49[39m, [33m0.47[39m, [33m0.46[39m, [33m0.46[39m, [33m0.44[39m, [33m0.43[39m, [33m0.41[39m,  [33m0.4[39m,
       [33m0.4[39m,  [33m0.4[39m, [33m0.39[39m, [33m0.37[39m, [33m0.35[39m, [33m0.32[39m,  [33m0.3[39m, [33m0.29[39m,  [33m0.3[39m, [33m0.31[39m,
      [33m0.32[39m, [33m0.32[39m, [33m0.33[39m, [33m0.34[39m, [33m0.36[39m,  [33m0.4[39m, [33m0.45[39m,  [33m0.5[39m, [33m0.54[39m, [33m0.56[39m,
      [33m0.59[39m, [33m0.61[39m, [33m0.63[39m, [33m0.65[39m, [33m0.66[39m, [33m0.66[39m, [33m0.66[39m, [33m0.67[39m, [33m0.68[39m,  [33m0.7[39m,
      ... 25500 more items
    ]
  },
  units: [
    {
      id: [33m100[39m,
      gridX: [33m10[39m,
      gridZ: [33m10[39m,
      age: [33m20[39m,
      lifespan: [33m95.26103032294314[39m,
      isDead: [33mfalse[39m,
      isMoving: [33mfalse[39m,
      targetX: [33m0[39m,
      targetZ: [33m0[39m,
      moveStartTime: [33m0[39m,
      moveDuration: [33m1000[39m,
      startGridX: [33m0[39m,
      startGridZ: [33m0[39m,
      targetGridX: [33m0[39m,
      targetGridZ: [33m0[39m,
      isSpecial: [33mfalse[39m,
      role: [32m'worker'[39m,
      hp: [33m44[39m,
      maxHp: [33m44[39m,
      damage: [33m4[39m,
      xp: [33m0[39m,
      level: [33m1[39m,
      squadId: [1mnull[22m,
      targetRequestId: [32m'req_manual_persistent'[39m
    }
  ],
  goblinManager: {},
  camera: { position: { x: [33m20[39m, y: [33m20[39m, z: [33m20[39m }, zoom: [33m1[39m, target: {} },
  requests: [
    {
      id: [32m'req_manual_persistent'[39m,
      type: [32m'raise'[39m,
      x: [33m15[39m,
      z: [33m15[39m,
      status: [32m'assigned'[39m,
      assignedTo: [33m100[39m,
      createdAt: [33m0[39m,
      isManual: [33mtrue[39m
    }
  ]
}
Clearing 0 projectiles...

stdout | src/tests/LoadUpdateLoop.test.js > Load Update Loop Integration > should maintain JobState after first update loop post-load
[DEBUG] Terrain.setSeason: Changing from undefined to Spring
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10
[Game] Restoring 1 requests...
[Game] Re-linked Unit 100 to Request req_manual_persistent
[Unit 100] Blocked by Water at 11,11 H:-5
[Game] Restored Camera Zoom: 1

stdout | src/tests/LoadUpdateLoop.test.js > Load Update Loop Integration > should maintain JobState after first update loop post-load
Restored Unit Keys: [
  [32m'id'[39m,                     [32m'scene'[39m,                [32m'terrain'[39m,
  [32m'gridX'[39m,                  [32m'gridZ'[39m,                [32m'type'[39m,
  [32m'spatialType'[39m,            [32m'position'[39m,             [32m'rotationY'[39m,
  [32m'isMoving'[39m,               [32m'moveTimer'[39m,            [32m'moveDuration'[39m,
  [32m'moveStartTime'[39m,          [32m'startGridX'[39m,           [32m'startGridZ'[39m,
  [32m'targetGridX'[39m,            [32m'targetGridZ'[39m,          [32m'walkAnimTimer'[39m,
  [32m'_spatial'[39m,               [32m'path'[39m,                 [32m'pathIndex'[39m,
  [32m'stuckCount'[39m,             [32m'pathFailCount'[39m,        [32m'lastPathTime'[39m,
  [32m'minDistToTarget'[39m,        [32m'pathStagnation'[39m,       [32m'state'[39m,
  [32m'simTime'[39m,                [32m'role'[39m,                 [32m'isSpecial'[39m,
  [32m'squadId'[39m,                [32m'lastGridX'[39m,            [32m'lastGridZ'[39m,
  [32m'stagnationTimer'[39m,        [32m'buildStagnationCount'[39m, [32m'lastTime'[39m,
  [32m'lastGatherTime'[39m,         [32m'limbs'[39m,                [32m'lifespan'[39m,
  [32m'age'[39m,                    [32m'isSleeping'[39m,           [32m'isNight'[39m,
  [32m'isDead'[39m,                 [32m'debugFrame'[39m,           [32m'hp'[39m,
  [32m'maxHp'[39m,                  [32m'attackCooldown'[39m,       [32m'attackRate'[39m,
  [32m'damage'[39m,                 [32m'targetGoblin'[39m,         [32m'ignoredTargets'[39m,
  [32m'moveInterval'[39m,           [32m'huntingCooldown'[39m,      [32m'target'[39m,
  [32m'targetX'[39m,                [32m'targetZ'[39m,              [32m'action'[39m,
  [32m'wanderCount'[39m,            [32m'migrationTarget'[39m,      [32m'isFinished'[39m,
  [32m'xp'[39m,                     [32m'level'[39m,                [32m'savedTargetRequestId'[39m,
  [32m'targetRequest'[39m,          [32m'targetBuilding'[39m,       [32m'lastWaterLogTime'[39m,
  [32m'isPathfindingThrottled'[39m
]

 ï¾ƒãƒ»src/tests/LoadUpdateLoop.test.js > Load Update Loop Integration > should maintain JobState after first update loop post-load 955ms
   ç«Šãƒ»restoredUnit.update is not a function

 Test Files  1 failed (1)
      Tests  1 failed (1)
   Start at  23:42:02
   Duration  2.28s (transform 339ms, setup 42ms, import 450ms, tests 957ms, environment 543ms)

