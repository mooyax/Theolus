
 RUN  v4.0.15 C:/Users/mooya/develop/test

stdout | src/tests/WorkerOscillation.test.js > Worker Oscillation Debug > should blacklist unreachable jobs and NOT pick them up immediately
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[DIAG] Actor Created ID: 0
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0

stdout | src/tests/WorkerOscillation.test.js > Worker Oscillation Debug > should blacklist unreachable jobs and NOT pick them up immediately
[TestDebug] State:Wander Unreach:false Wait:false

stdout | src/tests/WorkerOscillation.test.js > Worker Oscillation Debug > should NOT oscillate (Ping Pong) between Job and Idle
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[DIAG] Actor Created ID: 1
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:1

 ç¬¨ãƒ»src/tests/WorkerOscillation.test.js (2 tests) 14ms
stdout | src/tests/ComplexAI.test.js
[Import Debug] Raid: function, Combat: function, Wander: function

stdout | src/tests/LoadJitabata.test.js
[Import Debug] Raid: function, Combat: function, Wander: function

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should drop job gracefully if target building is destroyed
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.442372, 0.155281) -> Grid(70, 24) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.979435, 0.873771) -> Grid(156, 139) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.989276, 0.472265) -> Grid(158, 75) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)

stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.974673, 0.294920) -> Grid(155, 47) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.990306, 0.030680) -> Grid(158, 4) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.999657, 0.562103) -> Grid(159, 89) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should drop job gracefully if target building is destroyed
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[DIAG] Actor Created ID: 0
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0
[Game] Request Added: cultivate at (20,20) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job
[Unit 0] State Change: Job -> Wander
[Actor 0] SmartMove Depth:1 Node:20,20 My:10,10 d:10,10 
[Unit 0] canMoveTo(20,20) OK
[Unit 0] canMoveTo(20,20) checking grid...
[DIAG] executeMove Actor:0 calling startMove.Current isMoving:false 
[Entity 0] startMove -> isMoving:true. Target:20,20 StartTime:0.0000
[DIAG] executeMove Actor:0 finished startMove.New isMoving:true 

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear
[Game] Dispose called for Game Instance.
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.617996, 0.214459) -> Grid(98, 34) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.216375, 0.513890) -> Grid(34, 82) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.633011, 0.797408) -> Grid(101, 127) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)

stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
[Entity 0] Calling registerEntity...
[Entity 0] registerEntity returned.
[Entity 0] Calling updatePosition...
[Entity 0] updatePosition returned.
[DIAG] Actor Created ID: 0
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0
[Game] Request Added: raise at (20,20) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job
Saved to slot 1 (Compressed). Size: 366 chars (Original: 1075)
[Game] Dispose called for Game Instance.
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.234957, 0.417624) -> Grid(37, 66) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.585402, 0.299122) -> Grid(93, 47) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.092962, 0.423985) -> Grid(14, 67) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)
Load Started...
[Actor 0] SmartMove Depth:1 Node:20,20 My:10,10 d:10,10 
[Unit 0] Moving onto Rock at 20,20 H:10 (Speed Penalty)
[Unit 0] canMoveTo(20,20) OK
[Unit 0] canMoveTo(20,20) checking grid...
[DIAG] executeMove Actor:0 calling startMove.Current isMoving:false 
[Entity 0] startMove -> isMoving:true. Target:20,20 StartTime:0.0000
[DIAG] executeMove Actor:0 finished startMove.New isMoving:true 

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[DIAG] Actor Created ID: 1
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0
[Game] Request Added: raise at (50,50) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job
[Game] Request Added: raise at (11,11) ID:req_1
[Actor 0] SmartMove Depth:1 Node:50,50 My:10,10 d:40,40 
[Unit 0] canMoveTo(50,50) OK
[Unit 0] canMoveTo(50,50) checking grid...
[DIAG] executeMove Actor:0 calling startMove.Current isMoving:false 
[Entity 0] startMove -> isMoving:true. Target:50,50 StartTime:0.0000
[DIAG] executeMove Actor:0 finished startMove.New isMoving:true 

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should prioritize manual jobs even when closer auto jobs appear
[Actor 0] SmartMove Depth:0 Node:50,50 My:10,10 d:40,40 
[Unit 0] canMoveTo(50,50) OK
[Unit 0] canMoveTo(50,50) checking grid...

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night
[Game] Dispose called for Game Instance.
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.530862, 0.296478) -> Grid(84, 47) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.982108, 0.741720) -> Grid(157, 118) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.417387, 0.264484) -> Grid(66, 42) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night
[Entity 2] Calling updatePosition...
[Entity 2] updatePosition returned.
[DIAG] Actor Created ID: 2
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0
[Game] Request Added: raise at (50,50) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should NOT drop manual job when switching to Sleep at night
[Actor 0] SmartMove Depth:1 Node:50,50 My:10,10 d:40,40 
[Unit 0] canMoveTo(50,50) OK
[Unit 0] canMoveTo(50,50) checking grid...
[DIAG] executeMove Actor:0 calling startMove.Current isMoving:false 
[Entity 0] startMove -> isMoving:true. Target:50,50 StartTime:0.0000
[DIAG] executeMove Actor:0 finished startMove.New isMoving:true 

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should abandon unreachable job (Abandonment Test)
[Game] Dispose called for Game Instance.
[GoblinManager] 5è›Ÿä¹ãƒ»è±¢æ¨’ï½ªæº˜ï½’é€•æ»“ãƒ»è³ï½­...
[GoblinManager] DETERMINISM: generateCaves start. rngState=undefined
[GoblinManager] DETERMINISM: Attempt 1: Rnd(0.483277, 0.873380) -> Grid(77, 139) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 2: Rnd(0.442223, 0.849088) -> Grid(70, 135) rngState=undefined
[GoblinManager] DETERMINISM: Attempt 3: Rnd(0.186005, 0.207171) -> Grid(29, 33) rngState=undefined
[GoblinManager] è±¢æ¨’ï½ªæº½å‡½è¬Œä»™ï½®å¾¡ï½ºãƒ» 0/5 (éš§ï½¦é™¦æ‚Ÿå±“è¬¨ï½°: 5000)

stdout | src/tests/ComplexAI.test.js > Complex AI Scenarios > should abandon unreachable job (Abandonment Test)
[Entity 3] Calling updatePosition...
[Entity 3] updatePosition returned.
[DIAG] Actor Created ID: 3
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10 Special:false
[Unit 0] State Change: None -> Wander
[UnitCore.js] Unit Created ID:0 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:0
[Game] Request Added: raise at (90,90) ID:req_0
[Game] No worker in radius 80 for Manual Req req_0. Trying Global Scan...
[Unit 0] State Change: Wander -> Job

 ç¬¶ï½¯ src/tests/ComplexAI.test.js (4 tests | 1 failed) 59ms
     ç¬¨ãƒ»should drop job gracefully if target building is destroyed 18ms
     ç¬¨ãƒ»should prioritize manual jobs even when closer auto jobs appear 15ms
     ç¬¨ãƒ»should NOT drop manual job when switching to Sleep at night 8ms
     ï¾ƒãƒ»should abandon unreachable job (Abandonment Test) 17ms
stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
Loading slot 1, Raw length: 364
Load: Decompressed successfully.
Parsed Data for slot 1: {
  timestamp: [33m1770020102397[39m,
  data: {
    slotId: [33m1[39m,
    timestamp: [33m1770020102397[39m,
    resources: { grain: [33m0[39m, fish: [33m0[39m, meat: [33m0[39m },
    gameTime: [33m6[39m,
    gameTotalTime: [33m0[39m,
    currentSeasonIndex: [33m0[39m,
    daysPassed: [33m0[39m,
    terrain: {
      h: [],
      n: [],
      b: [],
      logicalWidth: [33m160[39m,
      logicalDepth: [33m160[39m,
      version: [33m1[39m
    },
    units: [ [36m[Object][39m ],
    requests: [ [36m[Object][39m ],
    goblinManager: { plunderCount: [33m0[39m, goblins: [], clans: [], caves: [] },
    camera: { position: [36m[Object][39m, target: [36m[Object][39m }
  }
}
Load Game: Data found {
  slotId: [33m1[39m,
  timestamp: [33m1770020102397[39m,
  resources: { grain: [33m0[39m, fish: [33m0[39m, meat: [33m0[39m },
  gameTime: [33m6[39m,
  gameTotalTime: [33m0[39m,
  currentSeasonIndex: [33m0[39m,
  daysPassed: [33m0[39m,
  terrain: {
    h: [],
    n: [],
    b: [],
    logicalWidth: [33m160[39m,
    logicalDepth: [33m160[39m,
    version: [33m1[39m
  },
  units: [
    {
      id: [33m0[39m,
      gridX: [33m10[39m,
      gridZ: [33m10[39m,
      age: [33m20[39m,
      raidTargetX: [1mnull[22m,
      raidTargetY: [1mnull[22m,
      raidTargetZ: [1mnull[22m,
      raidTargetTS: [1mnull[22m,
      lifespan: [33m89.75161052694597[39m,
      isDead: [33mfalse[39m,
      isFinished: [33mfalse[39m,
      isMoving: [33mfalse[39m,
      targetX: [33m0[39m,
      targetZ: [33m0[39m,
      moveStartTime: [33m0[39m,
      moveDuration: [33m0.8[39m,
      startGridX: [33m0[39m,
      startGridZ: [33m0[39m,
      targetGridX: [33m0[39m,
      targetGridZ: [33m0[39m,
      isSpecial: [33mfalse[39m,
      role: [32m'worker'[39m,
      type: [32m'worker'[39m,
      hp: [33m56[39m,
      maxHp: [33m56[39m,
      damage: [33m12[39m,
      xp: [33m0[39m,
      level: [33m1[39m,
      name: [32m'Unit'[39m,
      squadId: [1mnull[22m,
      targetRequestId: [32m'req_0'[39m,
      action: [32m'Approaching Job'[39m,
      ignoredTargets: []
    }
  ],
  requests: [
    {
      id: [32m'req_0'[39m,
      type: [32m'raise'[39m,
      x: [33m20[39m,
      z: [33m20[39m,
      status: [32m'assigned'[39m,
      assignedTo: [33m0[39m,
      createdAt: [33m0[39m,
      isManual: [33mtrue[39m
    }
  ],
  goblinManager: { plunderCount: [33m0[39m, goblins: [], clans: [], caves: [] },
  camera: { position: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m }, target: { x: [33m0[39m, y: [33m0[39m, z: [33m0[39m } }
}

stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
Resetting GoblinManager...
Clearing 0 projectiles...
[Game] Deserializing terrain...

stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
[Game] Terrain deserialized.

stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
[Game] Loading resources/time...
[Game] Updating environment...

stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
[Game] Restoring 1 units...

stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
[Entity 1] Calling registerEntity...
[Entity 1] registerEntity returned.
[Entity 1] Calling updatePosition...
[Entity 1] updatePosition returned.
[DIAG] Actor Created ID: 1
[DIAG] Actor smartMove type: function
[DIAG] Actor smartMove body snapshot: smartMove(tx, tz, time, depth = 0) {
    if (isNaN(tx) || isNaN(tz)) {
      console.error(`[Actor $
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10 Special:false
[UnitCore.js] Unit Created ID:1 Role:worker Pos:10,10
[UnitCore.js] Unit Construction Finished ID:1
[Unit 0] State Change: Wander -> Wander
[Game] Successfully restored 1 units.
GoblinManager: Deserializing...
GoblinManager: Restored 0 goblins.
[Game] Restoring 1 requests...

stdout | src/tests/LoadJitabata.test.js > Post-Load Jitabata Reproduction > should NOT flap between Job and Wander after load
[Game] Checking unit 0 for targetRequestId: req_0
[Game] Re-linked Unit 0 to Request req_0
[Unit 0] State Change: Wander -> Job
[Game] Restored Camera Zoom: 1

 ç¬¨ãƒ»src/tests/LoadJitabata.test.js (1 test) 302ms
     ç¬¨ãƒ»should NOT flap between Job and Wander after load  301ms

 Test Files  1 failed | 2 passed (3)
      Tests  1 failed | 6 passed (7)
   Start at  17:15:01
   Duration  1.43s (transform 954ms, setup 184ms, import 1.21s, tests 375ms, environment 1.35s)

